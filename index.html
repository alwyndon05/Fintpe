<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Currency Rates - INR Exchange Rates</title>
    <meta name="description" content="Real-time currency exchange rates against Indian Rupee (INR) with historical change percentages.">
    <meta property="og:title" content="Live Currency Rates vs INR">
    <meta property="og:description" content="Top 20 currencies with 1D, 5D, 10D, 1M, 6M, 1Y, 5Y change percentages against Indian Rupee.">
    <meta property="og:type" content="website">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #dbeafe;
            --success: #10b981;
            --success-light: #d1fae5;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --dark: #0f172a;
            --gray-700: #374151;
            --gray-600: #4b5563;
            --gray-500: #6b7280;
            --gray-400: #9ca3af;
            --gray-300: #d1d5db;
            --gray-200: #e5e7eb;
            --gray-100: #f3f4f6;
            --gray-50: #f9fafb;
            --white: #ffffff;
            --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.08), 0 4px 6px -2px rgba(0,0,0,0.04);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            /* Theme colors */
            --bg-body: var(--gray-50);
            --bg-card: var(--white);
            --bg-header: var(--white);
            --text-primary: var(--gray-700);
            --text-secondary: var(--gray-600);
            --text-muted: var(--gray-500);
            --border-color: var(--gray-200);
            --table-stripe: var(--gray-50);
            --input-bg: var(--white);
            --input-border: var(--gray-300);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-header: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --table-stripe: #1e293b;
            --input-bg: #1e293b;
            --input-border: #475569;
            --gray-50: #1e293b;
            --gray-100: #334155;
            --gray-200: #475569;
            --gray-700: #f1f5f9;
            --gray-600: #cbd5e1;
            --gray-500: #94a3b8;
            --white: #1e293b;
            --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.4), 0 4px 6px -2px rgba(0,0,0,0.2);
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font);
            color: var(--text-primary);
            line-height: 1.6;
            background: var(--bg-body);
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Theme Toggle Button */
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        .theme-toggle:hover {
            background: var(--gray-100);
            color: var(--primary);
        }
        .theme-toggle svg {
            width: 20px;
            height: 20px;
        }
        .theme-toggle .sun-icon { display: none; }
        .theme-toggle .moon-icon { display: block; }
        [data-theme="dark"] .theme-toggle .sun-icon { display: block; }
        [data-theme="dark"] .theme-toggle .moon-icon { display: none; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Navbar */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--gray-200);
        }

        .navbar-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .logo {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
            text-decoration: none;
        }

        .logo span { color: var(--primary); }

        .nav-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .last-updated {
            font-size: 12px;
            color: var(--gray-400);
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition);
        }

        .refresh-btn:hover {
            background: var(--primary-dark);
        }

        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .refresh-btn.loading svg {
            animation: spin 1s linear infinite;
        }

        .refresh-btn .countdown {
            font-size: 11px;
            opacity: 0.8;
            font-family: 'SF Mono', 'Consolas', monospace;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Header */
        .header {
            padding: 100px 0 40px;
            background: linear-gradient(180deg, var(--gray-50) 0%, var(--white) 100%);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 100%;
            background: radial-gradient(ellipse at 70% 20%, rgba(37, 99, 235, 0.08) 0%, transparent 60%);
            pointer-events: none;
        }

        .header-content {
            text-align: center;
            position: relative;
        }

        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .header-badge .india-flag {
            font-size: 16px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .header h1 {
            font-size: clamp(32px, 6vw, 42px);
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -1px;
            background: linear-gradient(135deg, var(--dark) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        #animatedText {
            display: inline-block;
            background: linear-gradient(135deg, #D4AF37 0%, #F4D03F 30%, #D4AF37 50%, #B8860B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .text-fade-out {
            animation: textFadeOut 0.3s ease-out forwards, shimmer 3s ease-in-out infinite;
        }

        .text-fade-in {
            animation: textFadeIn 0.3s ease-out forwards, shimmer 3s ease-in-out infinite;
        }

        @keyframes textFadeOut {
            0% {
                opacity: 1;
                transform: translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-30px);
            }
        }

        @keyframes textFadeIn {
            0% {
                opacity: 0;
                transform: translateX(30px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .header p {
            font-size: 16px;
            color: var(--gray-500);
            max-width: 500px;
            margin: 0 auto;
        }

        /* Menu Tabs */
        .menu-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 32px;
        }

        .menu-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition);
            text-decoration: none;
        }

        .menu-tab:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .menu-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--white);
        }

        .menu-tab svg {
            width: 18px;
            height: 18px;
        }

        .menu-tab.active svg {
            color: var(--white);
        }

        /* Main Content */
        main {
            padding: 40px 0 80px;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            background: var(--white);
            border-radius: var(--radius) var(--radius) 0 0;
            border-bottom: 1px solid var(--gray-200);
            flex-wrap: wrap;
        }

        .toolbar-title {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-right: auto;
        }

        .toolbar-title h2 {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
        }

        .toolbar-title span {
            font-size: 13px;
            color: var(--gray-400);
        }

        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: var(--gray-200);
        }

        .search-box {
            position: relative;
            width: 220px;
        }

        .search-box input {
            width: 100%;
            padding: 8px 32px 8px 36px;
            font-family: var(--font);
            font-size: 13px;
            color: var(--dark);
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 100px;
            transition: all var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-box input::placeholder {
            color: var(--gray-400);
        }

        .search-box svg {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            width: 16px;
            height: 16px;
        }

        .search-clear {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--gray-300);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            transition: all var(--transition);
        }

        .search-clear:hover {
            background: var(--gray-400);
        }

        .search-clear.visible {
            display: flex;
        }

        .search-clear svg {
            width: 12px;
            height: 12px;
        }

        .share-container {
            position: relative;
        }

        .toggle-group {
            display: flex;
            background: var(--gray-100);
            border-radius: 100px;
            padding: 3px;
            border: 1px solid var(--gray-200);
        }

        .toggle-btn {
            padding: 6px 14px;
            background: none;
            border: none;
            border-radius: 100px;
            font-family: var(--font);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
            cursor: pointer;
            transition: all var(--transition);
            white-space: nowrap;
        }

        .toggle-btn:hover {
            color: var(--gray-700);
        }

        .toggle-btn.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            border-radius: 100px;
            font-family: var(--font);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition);
        }

        .share-btn:hover {
            background: var(--gray-200);
            color: var(--dark);
        }

        .share-btn svg {
            width: 14px;
            height: 14px;
        }

        .share-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 8px;
            display: none;
            z-index: 100;
            min-width: 200px;
        }

        .share-dropdown.open {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 12px 16px;
            background: none;
            border: none;
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            color: var(--gray-700);
            cursor: pointer;
            transition: background var(--transition);
            text-decoration: none;
        }

        .share-option:hover {
            background: var(--gray-100);
        }

        .share-option svg {
            flex-shrink: 0;
        }

        .share-option.twitter svg { color: #1DA1F2; }
        .share-option.facebook svg { color: #1877F2; }
        .share-option.linkedin svg { color: #0A66C2; }
        .share-option.whatsapp svg { color: #25D366; }
        .share-option.telegram svg { color: #0088cc; }
        .share-option.copy svg { color: var(--gray-500); }

        .share-divider {
            height: 1px;
            background: var(--gray-200);
            margin: 8px 0;
        }

        .copied-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--dark);
            color: white;
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .copied-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Loading State */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 20px;
            gap: 20px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading-text {
            font-size: 15px;
            color: var(--gray-500);
        }

        /* Error State */
        .error-container {
            text-align: center;
            padding: 60px 20px;
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .error-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            background: var(--danger-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--danger);
        }

        .error-container h3 {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .error-container p {
            color: var(--gray-500);
            margin-bottom: 20px;
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-500);
        }

        .no-results svg {
            margin-bottom: 16px;
            color: var(--gray-300);
        }

        /* Table Container */
        .table-container {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .section-panel {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Metals & Fuel Grid */
        .metals-grid, .fuel-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            padding: 24px;
        }

        .metal-card, .fuel-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--gray-50);
            border-radius: var(--radius);
            transition: all var(--transition);
        }

        .metal-card:hover, .fuel-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .metal-card.gold { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .metal-card.silver { background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); }
        .metal-card.platinum { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); }

        .fuel-card.petrol { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .fuel-card.diesel { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); }
        .fuel-card.cng { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .fuel-card.lpg { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }

        .metal-icon, .fuel-icon {
            font-size: 32px;
        }

        .metal-info, .fuel-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .metal-name, .fuel-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .metal-price, .fuel-price {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
        }

        .metal-change {
            font-size: 12px;
            font-weight: 600;
        }

        .metal-change.positive { color: var(--success); }
        .metal-change.negative { color: var(--danger); }

        .fuel-unit {
            font-size: 12px;
            color: var(--gray-500);
        }

        .fuel-price-cell.highlight {
            color: var(--success);
            font-weight: 700;
        }

        .banking-subtable {
            animation: fadeIn 0.2s ease-out;
        }

        .section-note {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px 24px;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            font-size: 13px;
            color: var(--gray-500);
        }

        .section-note svg {
            flex-shrink: 0;
            color: var(--gray-400);
        }

        .section-note a {
            color: var(--primary);
            text-decoration: none;
        }

        .section-note a:hover {
            text-decoration: underline;
        }

        /* Fuel Table */
        .fuel-table th {
            cursor: default;
        }

        .fuel-table th:hover {
            background: var(--gray-50);
        }

        .city-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .city-name {
            font-weight: 600;
            color: var(--dark);
        }

        .state-name {
            font-size: 12px;
            color: var(--gray-500);
        }

        .fuel-price-cell {
            font-weight: 600;
            color: var(--dark);
            font-family: 'SF Mono', 'Consolas', monospace;
        }

        .converter-box {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: linear-gradient(135deg, var(--success-light) 0%, #ecfdf5 100%);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(16, 185, 129, 0.2);
            transition: all var(--transition);
            box-shadow: 0 1px 2px rgba(16, 185, 129, 0.08);
        }

        .converter-box:focus-within {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15), 0 2px 4px rgba(16, 185, 129, 0.1);
            background: linear-gradient(135deg, #ecfdf5 0%, var(--white) 100%);
        }

        .converter-box .rupee-symbol {
            font-size: 15px;
            font-weight: 700;
            color: var(--success);
        }

        .converter-box input {
            width: 100px;
            padding: 4px 0;
            font-family: var(--font);
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            background: transparent;
            border: none;
            outline: none;
        }

        .converter-box input::placeholder {
            color: var(--gray-400);
            font-weight: 400;
        }

        .converter-label {
            font-size: 11px;
            color: var(--gray-500);
            margin-right: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .converted-value {
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 12px;
            color: var(--success);
            font-weight: 600;
        }

        /* Currency Table */
        .table-scroll {
            overflow-x: auto;
        }

        .currency-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .currency-table th {
            padding: 14px 16px;
            text-align: right;
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
            transition: background var(--transition);
        }

        .currency-table th:hover {
            background: var(--gray-100);
        }

        .currency-table th:first-child {
            text-align: left;
            padding-left: 24px;
        }

        .currency-table th:last-child {
            padding-right: 24px;
        }

        .th-content {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .sort-icon {
            opacity: 0.3;
            transition: opacity var(--transition);
        }

        .currency-table th:hover .sort-icon {
            opacity: 0.6;
        }

        .currency-table th.sorted .sort-icon {
            opacity: 1;
            color: var(--primary);
        }

        .currency-table th.sorted {
            color: var(--primary);
        }

        .currency-table td {
            padding: 16px;
            text-align: right;
            font-size: 14px;
            border-bottom: 1px solid var(--gray-100);
        }

        .currency-table td:first-child {
            text-align: left;
            padding-left: 24px;
        }

        .currency-table td:last-child {
            padding-right: 24px;
        }

        .currency-table tbody tr {
            transition: background var(--transition);
        }

        .currency-table tbody tr:hover {
            background: var(--gray-50);
        }

        .currency-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Currency Cell */
        .currency-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .currency-flag {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .currency-info {
            display: flex;
            flex-direction: column;
        }

        .currency-code {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .currency-name {
            font-size: 12px;
            color: var(--gray-500);
        }

        /* Rate Cell */
        .rate-cell {
            font-weight: 600;
            color: var(--dark);
            font-family: 'SF Mono', 'Consolas', monospace;
        }

        /* Change Cell */
        .change-cell {
            font-weight: 500;
            font-family: 'SF Mono', 'Consolas', monospace;
            font-size: 13px;
        }

        .change-cell.positive {
            color: var(--success);
        }

        .change-cell.negative {
            color: var(--danger);
        }

        .change-cell.neutral {
            color: var(--gray-400);
        }

        /* Market row background based on change */
        .market-row.positive {
            background-color: rgba(16, 185, 129, 0.08);
        }

        .market-row.negative {
            background-color: rgba(239, 68, 68, 0.08);
        }

        .market-row.positive:hover {
            background-color: rgba(16, 185, 129, 0.15);
        }

        .market-row.negative:hover {
            background-color: rgba(239, 68, 68, 0.15);
        }

        /* Market Overview Section */
        .market-overview {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .market-breadth-card, .market-stats-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .market-breadth-card {
            flex: 1;
        }

        .market-breadth-card h3 {
            margin: 0 0 12px 0;
            font-size: 14px;
            color: var(--gray-400);
            font-weight: 500;
        }

        .breadth-bar {
            display: flex;
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .breadth-advances {
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.5s ease;
        }

        .breadth-declines {
            background: linear-gradient(90deg, #f87171, #ef4444);
            transition: width 0.5s ease;
        }

        .breadth-labels {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .advances-label { color: var(--success); font-weight: 600; }
        .declines-label { color: var(--danger); font-weight: 600; }

        .market-stats-card {
            display: flex;
            gap: 30px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray-400);
            font-weight: 500;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
            font-family: 'SF Mono', monospace;
        }

        .stat-change {
            font-size: 13px;
            font-weight: 500;
            font-family: 'SF Mono', monospace;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Market Tabs */
        .market-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .market-tab {
            padding: 10px 20px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-400);
            cursor: pointer;
            transition: all 0.2s;
        }

        .market-tab:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .market-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .market-tab-content {
            display: none;
        }

        .market-tab-content.active {
            display: block;
        }

        /* Sectors List (Row-wise) */
        .sectors-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 10px 0;
        }

        .sector-row {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .sector-row:hover {
            border-color: var(--primary);
        }

        .sector-row.positive {
            border-left: 4px solid var(--success);
        }

        .sector-row.negative {
            border-left: 4px solid var(--danger);
        }

        .sector-header {
            display: flex;
            align-items: center;
            padding: 16px;
            cursor: pointer;
            gap: 20px;
        }

        .sector-header:hover {
            background: var(--bg);
        }

        .sector-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
        }

        .sector-info {
            flex: 1;
            min-width: 0;
        }

        .sector-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
        }

        .sector-full-name {
            font-size: 12px;
            color: var(--gray-400);
        }

        .sector-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            font-family: 'SF Mono', monospace;
            min-width: 120px;
            text-align: right;
        }

        .sector-change-container {
            min-width: 100px;
            text-align: right;
        }

        .sector-change {
            font-size: 15px;
            font-weight: 600;
            font-family: 'SF Mono', monospace;
        }

        .sector-change.positive { color: var(--success); }
        .sector-change.negative { color: var(--danger); }

        .sector-bar-container {
            width: 100px;
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .sector-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .sector-bar.positive {
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        .sector-bar.negative {
            background: linear-gradient(90deg, #ef4444, #f87171);
        }

        .sector-toggle {
            color: var(--gray-400);
            transition: transform 0.2s;
        }

        .sector-row.expanded .sector-toggle {
            transform: rotate(180deg);
        }

        .sector-stocks {
            display: none;
            padding: 0 16px 16px;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        .sector-row.expanded .sector-stocks {
            display: block;
        }

        .sector-stocks-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 12px;
        }

        .sector-stock-row {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: var(--card-bg);
            border-radius: 6px;
            gap: 16px;
        }

        .sector-stock-row.positive {
            border-left: 3px solid var(--success);
        }

        .sector-stock-row.negative {
            border-left: 3px solid var(--danger);
        }

        .sector-stock-symbol {
            font-weight: 600;
            color: var(--text);
            min-width: 100px;
        }

        .sector-stock-name {
            flex: 1;
            font-size: 12px;
            color: var(--gray-400);
        }

        .sector-stock-ltp {
            font-family: 'SF Mono', monospace;
            font-weight: 600;
            min-width: 100px;
            text-align: right;
        }

        .sector-stock-change {
            font-family: 'SF Mono', monospace;
            font-weight: 500;
            min-width: 80px;
            text-align: right;
        }

        .sector-stock-pct {
            font-family: 'SF Mono', monospace;
            font-weight: 600;
            min-width: 70px;
            text-align: right;
        }

        .sector-stock-change.positive, .sector-stock-pct.positive { color: var(--success); }
        .sector-stock-change.negative, .sector-stock-pct.negative { color: var(--danger); }

        /* Stock Search */
        .stock-search {
            padding: 8px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-size: 13px;
            width: 200px;
        }

        .stock-search:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Action buttons */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn.add {
            background: var(--success);
            color: white;
        }

        .action-btn.add:hover {
            background: #059669;
        }

        .action-btn.remove {
            background: var(--danger);
            color: white;
        }

        .action-btn.remove:hover {
            background: #dc2626;
        }

        .action-btn.in-watchlist {
            background: var(--gray-200);
            color: var(--gray-500);
        }

        /* Volume formatting */
        .volume-cell {
            font-family: 'SF Mono', monospace;
            font-size: 12px;
            color: var(--gray-400);
        }

        /* Responsive market tabs */
        @media (max-width: 768px) {
            .market-overview {
                flex-direction: column;
            }

            .market-stats-card {
                justify-content: space-around;
            }

            .market-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 10px;
            }

            .market-tab {
                white-space: nowrap;
                flex-shrink: 0;
            }

            .sectors-grid {
                grid-template-columns: 1fr;
            }

            .stock-search {
                width: 100%;
                margin-top: 10px;
            }
        }

        /* Footer */
        .footer {
            padding: 40px 0;
            border-top: 1px solid var(--gray-200);
            margin-top: 40px;
        }

        .footer-content {
            text-align: center;
        }

        .footer-disclaimer {
            background: var(--white);
            border-radius: var(--radius-sm);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto 16px;
        }

        .footer-disclaimer strong {
            display: block;
            font-size: 11px;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .footer-disclaimer p {
            font-size: 13px;
            color: var(--gray-500);
            line-height: 1.6;
        }

        .footer-credit {
            font-size: 12px;
            color: var(--gray-400);
        }

        .footer-credit a {
            color: var(--primary);
            text-decoration: none;
        }

        /* Settings Button */
        .settings-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition);
            color: var(--gray-600);
        }

        .settings-btn:hover {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .settings-btn.has-keys {
            background: var(--success-light);
            border-color: var(--success);
            color: var(--success);
        }

        /* Settings Modal */
        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .settings-overlay.open {
            display: flex;
        }

        .settings-modal {
            background: var(--white);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .settings-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: var(--gray-500);
            transition: all var(--transition);
        }

        .settings-close:hover {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .settings-body {
            padding: 24px;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .settings-section-title .badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 500;
        }

        .settings-section-title .badge.configured {
            background: var(--success-light);
            color: var(--success);
        }

        .settings-section-title .badge.not-configured {
            background: var(--gray-100);
            color: var(--gray-500);
        }

        .settings-input-group {
            margin-bottom: 12px;
        }

        .settings-input-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-600);
            margin-bottom: 6px;
        }

        .settings-input-group input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            transition: all var(--transition);
        }

        .settings-input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .settings-input-group input::placeholder {
            color: var(--gray-400);
        }

        .settings-input-group .input-hint {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: 4px;
        }

        .settings-input-group .input-hint a {
            color: var(--primary);
            text-decoration: none;
        }

        .settings-input-group .input-hint a:hover {
            text-decoration: underline;
        }

        .settings-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 16px 24px;
            border-top: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .settings-btn-secondary {
            padding: 10px 20px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition);
        }

        .settings-btn-secondary:hover {
            background: var(--gray-100);
        }

        .settings-btn-primary {
            padding: 10px 20px;
            background: var(--primary);
            border: none;
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all var(--transition);
        }

        .settings-btn-primary:hover {
            background: var(--primary-dark);
        }

        .settings-divider {
            height: 1px;
            background: var(--gray-200);
            margin: 20px 0;
        }

        .settings-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--gray-600);
        }

        .settings-status.success {
            background: var(--success-light);
            color: var(--success);
        }

        .settings-status.error {
            background: var(--danger-light);
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 900px) {
            .metals-grid, .fuel-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .menu-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
                padding-bottom: 8px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .menu-tabs::-webkit-scrollbar {
                display: none;
            }

            .menu-tab {
                flex-shrink: 0;
                padding: 10px 14px;
                font-size: 13px;
            }

            .menu-tab svg {
                width: 16px;
                height: 16px;
            }
        }

        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                padding: 12px;
            }

            .toolbar-title {
                margin-right: 0;
            }

            .toolbar-title h2 {
                font-size: 16px;
            }

            .toolbar-divider {
                display: none;
            }

            .search-box {
                width: 100%;
                max-width: none;
            }

            .toggle-group {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                border-radius: 8px;
            }

            .toggle-btn {
                flex: 1;
                min-width: 80px;
                padding: 8px 10px;
                font-size: 12px;
                text-align: center;
            }

            .share-container {
                align-self: flex-end;
            }

            .metals-grid, .fuel-grid {
                grid-template-columns: 1fr;
            }

            .currency-table {
                min-width: 600px;
            }

            .currency-table th,
            .currency-table td {
                padding: 10px 8px;
                font-size: 13px;
            }

            .currency-flag {
                width: 28px;
                height: 28px;
                font-size: 14px;
            }

            .currency-code {
                font-size: 13px;
            }

            .currency-name {
                font-size: 11px;
            }
        }

        @media (max-width: 640px) {
            .navbar-inner {
                height: 56px;
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-info {
                gap: 8px;
            }

            .timer-badge, .last-updated {
                display: none;
            }

            .header {
                padding: 75px 0 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 13px;
                padding: 0 10px;
            }

            .header-badge {
                padding: 6px 12px;
                font-size: 12px;
                margin-bottom: 16px;
            }

            main {
                padding: 16px 0 60px;
            }

            .container {
                padding: 0 12px;
            }

            .table-container {
                border-radius: 8px;
            }

            .share-dropdown {
                right: 0;
                left: auto;
                min-width: 180px;
            }

            .section-note {
                font-size: 11px;
                padding: 10px 12px;
            }

            /* Mobile menu tabs */
            .menu-tabs {
                margin-top: 20px;
                gap: 6px;
            }

            .menu-tab {
                padding: 8px 12px;
                font-size: 12px;
                gap: 4px;
            }

            .menu-tab svg {
                width: 14px;
                height: 14px;
            }

            /* Mobile toggle buttons */
            .toggle-group {
                gap: 2px;
                padding: 2px;
            }

            .toggle-btn {
                padding: 6px 8px;
                font-size: 11px;
                min-width: 70px;
            }

            /* Mobile tables */
            .currency-table {
                min-width: 500px;
            }

            .currency-table th,
            .currency-table td {
                padding: 8px 6px;
                font-size: 12px;
            }

            .fuel-price-cell {
                font-size: 13px;
            }

            .change-cell {
                font-size: 11px;
            }

            .currency-cell {
                gap: 8px;
            }

            .currency-flag {
                width: 24px;
                height: 24px;
                font-size: 12px;
            }

            .currency-info {
                gap: 1px;
            }

            .currency-code {
                font-size: 12px;
            }

            .currency-name {
                font-size: 10px;
            }

            /* Mobile converter */
            .converter-box {
                padding: 12px;
            }

            .converter-box input {
                padding: 10px 12px;
                font-size: 14px;
            }

            .converter-box label {
                font-size: 12px;
            }

            /* Mobile metals/fuel cards */
            .metal-card, .fuel-card {
                padding: 16px;
            }

            .metal-name, .fuel-name {
                font-size: 14px;
            }

            .metal-price, .fuel-price {
                font-size: 20px;
            }

            .metal-unit, .fuel-unit {
                font-size: 11px;
            }

            /* Search box mobile */
            .search-box {
                height: 38px;
            }

            .search-box input {
                font-size: 14px;
            }

            /* Share button mobile */
            .share-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .share-btn svg {
                width: 14px;
                height: 14px;
            }

            /* Refresh button mobile */
            .refresh-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .refresh-btn svg {
                width: 14px;
                height: 14px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 8px;
            }

            .header h1 {
                font-size: 22px;
            }

            .menu-tab {
                padding: 6px 10px;
                font-size: 11px;
            }

            .menu-tab svg {
                display: none;
            }

            .toggle-btn {
                font-size: 10px;
                padding: 5px 6px;
                min-width: 60px;
            }

            .toolbar {
                padding: 10px;
            }

            .toolbar-title h2 {
                font-size: 14px;
            }

            .currency-table {
                min-width: 450px;
            }

            .currency-table th,
            .currency-table td {
                padding: 6px 4px;
                font-size: 11px;
            }

            .currency-flag {
                width: 20px;
                height: 20px;
                font-size: 10px;
            }

            .currency-code {
                font-size: 11px;
            }

            .currency-name {
                font-size: 9px;
            }

            .fuel-price-cell {
                font-size: 12px;
            }

            .change-cell {
                font-size: 10px;
            }

            .state-name {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-inner">
                <a href="#" class="logo">Rate<span>Chart</span></a>
                <div class="nav-info">
                    <span class="last-updated" id="lastUpdated">Loading...</span>
                    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <circle cx="12" cy="12" r="5"/>
                            <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                            <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                    </button>
                    <button class="settings-btn" id="settingsBtn" onclick="openSettings()" title="API Settings">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                    </button>
                    <button class="refresh-btn" id="refreshBtn" onclick="manualRefresh()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <path d="M23 4v6h-6M1 20v-6h6"/>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                        </svg>
                        <span id="countdown" class="countdown">5:00</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Settings Modal -->
    <div class="settings-overlay" id="settingsOverlay" onclick="closeSettingsOnOverlay(event)">
        <div class="settings-modal" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    API Settings
                </h2>
                <button class="settings-close" onclick="closeSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="settings-body">
                <!-- Kite Connect Section -->
                <div class="settings-section">
                    <div class="settings-section-title">
                         Zerodha Kite Connect (Markets)
                        <span class="badge not-configured" id="kiteStatusBadge">Not Configured</span>
                    </div>
                    <div class="settings-input-group">
                        <label for="kiteApiKey">API Key</label>
                        <input type="text" id="kiteApiKey" placeholder="Enter your Kite API key">
                        <div class="input-hint">Get from <a href="https://developers.kite.trade/" target="_blank">developers.kite.trade</a></div>
                    </div>
                    <div class="settings-input-group">
                        <label for="kiteApiSecret">API Secret</label>
                        <input type="password" id="kiteApiSecret" placeholder="Enter your API secret">
                        <div class="input-hint">Required for generating access token</div>
                    </div>
                    <button class="settings-btn-primary" onclick="loginWithKite()" style="margin-top: 12px; width: 100%; background: #387ed1;">
                         Login with Zerodha
                    </button>
                    <div style="text-align: center; margin: 12px 0; color: var(--gray-400); font-size: 12px;"> or enter token manually </div>
                    <div class="settings-input-group">
                        <label for="kiteAccessToken">Access Token</label>
                        <input type="text" id="kiteAccessToken" placeholder="Paste access token here (if you have one)">
                        <div class="input-hint">Auto-generated after login, or paste manually</div>
                    </div>
                    <div class="settings-input-group">
                        <label for="proxyUrl">Server URL (optional)</label>
                        <input type="text" id="proxyUrl" placeholder="Leave empty for cloud deployment" value="">
                        <div class="input-hint">Leave empty for Cloudflare. Use <code>http://localhost:3001</code> for local dev.</div>
                    </div>
                    <button class="settings-btn-secondary" onclick="testKiteConnection()" style="margin-top: 8px; width: 100%;">
                         Test Connection
                    </button>
                    <div id="kiteTestResult" style="margin-top: 8px; font-size: 12px; display: none;"></div>
                </div>

                <div class="settings-divider"></div>

                <!-- Metals.dev Section -->
                <div class="settings-section">
                    <div class="settings-section-title">
                         Metals.dev (Gold & Silver)
                        <span class="badge not-configured" id="metalsStatusBadge">Not Configured</span>
                    </div>
                    <div class="settings-input-group">
                        <label for="metalsApiKey">API Key</label>
                        <input type="text" id="metalsApiKey" placeholder="Enter your Metals.dev API key">
                        <div class="input-hint">Get free key from <a href="https://metals.dev/" target="_blank">metals.dev</a> (100 req/month)</div>
                    </div>
                </div>

                <div class="settings-divider"></div>

                <!-- Status -->
                <div class="settings-status" id="settingsStatus">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <span>Settings are saved in your browser's local storage.</span>
                </div>
            </div>
            <div class="settings-footer">
                <button class="settings-btn-secondary" onclick="clearSettings()">Clear All</button>
                <button class="settings-btn-primary" onclick="saveSettings()">Save & Apply</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-badge">
                    <span class="india-flag"></span>
                    <span class="live-dot"></span>
                    Live Rates for India
                </div>
                <h1><span id="animatedText">Currency</span> Prices</h1>
                <p>Real-time exchange rates, precious metals, and fuel prices. Auto-refreshes every 5 minutes.</p>

                <!-- Menu Tabs -->
                <div class="menu-tabs">
                    <button class="menu-tab active" onclick="showSection('markets')" id="tabMarkets">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Markets
                    </button>
                    <button class="menu-tab" onclick="showSection('currency')" id="tabCurrency">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v12M9 9h6M9 15h4"/>
                        </svg>
                        Currency
                    </button>
                    <button class="menu-tab" onclick="showSection('metals')" id="tabMetals">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                        </svg>
                        Gold / Silver
                    </button>
                    <button class="menu-tab" onclick="showSection('fuel')" id="tabFuel">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 22V7a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v15"/>
                            <path d="M13 10h4a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2h0a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 4"/>
                            <path d="M3 22h10"/>
                            <path d="M7 9v3"/>
                        </svg>
                        Fuel Prices
                    </button>
                    <button class="menu-tab" onclick="showSection('banking')" id="tabBanking">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="8" width="18" height="12" rx="2"/>
                            <path d="M3 12h18"/>
                            <path d="M12 3v5"/>
                            <path d="M7 8V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Banking
                    </button>
                    <button class="menu-tab" onclick="showSection('crypto')" id="tabCrypto">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.5 9.5c.5-1 1.5-1.5 2.5-1.5 1.5 0 2.5 1 2.5 2.5 0 1-1 2-2 2.5v1"/>
                            <circle cx="12" cy="17" r="0.5" fill="currentColor"/>
                        </svg>
                        Crypto
                    </button>
                    <button class="menu-tab" onclick="showSection('economy')" id="tabEconomy">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18 9l-5 5-4-4-6 6"/>
                        </svg>
                        RBI & Economy
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Currency Section -->
            <div id="sectionCurrency" class="section-panel" style="display: none;">
            <div class="table-container">
                <!-- Unified Toolbar -->
                <div class="toolbar">
                    <div class="toolbar-title">
                        <h2>Exchange Rates</h2>
                        <span>1 unit = X INR</span>
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="converter-box">
                        <span class="converter-label">Convert</span>
                        <span class="rupee-symbol"></span>
                        <input type="number" id="converterInput" placeholder="10,000" oninput="updateConversion()">
                    </div>
                    <div class="toolbar-divider"></div>
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search...">
                        <button class="search-clear" id="searchClear" onclick="clearSearch()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    </div>
                    <div class="toggle-group">
                        <button class="toggle-btn active" id="togglePercent" onclick="setDisplayMode('percent')">%</button>
                        <button class="toggle-btn" id="toggleAbsolute" onclick="setDisplayMode('absolute')">Abs</button>
                    </div>
                    <div class="share-container">
                        <button class="share-btn" onclick="toggleShareDropdown()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                            Share
                        </button>
                        <div class="share-dropdown" id="shareDropdown">
                        <a href="#" class="share-option twitter" onclick="shareTwitter(event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                            Twitter / X
                        </a>
                        <a href="#" class="share-option facebook" onclick="shareFacebook(event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                            Facebook
                        </a>
                        <a href="#" class="share-option linkedin" onclick="shareLinkedIn(event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                            LinkedIn
                        </a>
                        <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                            </svg>
                            WhatsApp
                        </a>
                        <a href="#" class="share-option telegram" onclick="shareTelegram(event)">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                            </svg>
                            Telegram
                        </a>
                        <div class="share-divider"></div>
                        <button class="share-option copy" onclick="copyLink()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                            </svg>
                            Copy Link
                        </button>
                    </div>
                </div>
                </div>

                <div id="content">
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <span class="loading-text">Fetching latest exchange rates...</span>
                    </div>
                </div>
            </div>
            </div>

            <!-- Metals Section -->
            <div id="sectionMetals" class="section-panel" style="display: none;">
                <div class="table-container">
                    <div class="toolbar">
                        <div class="toolbar-title">
                            <h2>Precious Metals</h2>
                            <span>19 Dec 2025</span>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="converter-box">
                            <span class="converter-label">Buy with</span>
                            <span class="rupee-symbol"></span>
                            <input type="number" id="metalsConverterInput" placeholder="1,00,000" oninput="updateMetalsConversion()">
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="search-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <input type="text" id="metalsSearchInput" placeholder="Search..." oninput="filterMetals()">
                            <button class="search-clear" id="metalsClearBtn" onclick="clearMetalsSearch()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="share-container">
                            <button class="share-btn" onclick="toggleMetalsShare()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/>
                                    <circle cx="6" cy="12" r="3"/>
                                    <circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="metalsShareDropdown">
                                <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                    WhatsApp
                                </a>
                                <a href="#" class="share-option twitter" onclick="shareTwitter(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    Twitter / X
                                </a>
                                <div class="share-divider"></div>
                                <button class="share-option copy" onclick="copyLink()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table class="currency-table metals-table" id="metalsTable">
                            <thead>
                                <tr>
                                    <th style="text-align: left;" onclick="sortMetals('name')"><span class="th-content">Metal <span class="sort-icon"></span></span></th>
                                    <th onclick="sortMetals('price')"><span class="th-content">Today's Price <span class="sort-icon"></span></span></th>
                                    <th onclick="sortMetals('week')"><span class="th-content">1W Change <span class="sort-icon"></span></span></th>
                                    <th onclick="sortMetals('unit')"><span class="th-content">Unit <span class="sort-icon"></span></span></th>
                                    <th id="metalsYouGetHeader" style="display:none;"><span class="th-content">You Get</span></th>
                                </tr>
                            </thead>
                            <tbody id="metalsTableBody">
                                <tr data-name="gold 24k" data-price="13484" data-week="-0.85" data-unit="g">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Gold (24K)</span><span class="currency-name">Pure Gold</span></div></div></td>
                                    <td class="fuel-price-cell">1,34,840</td>
                                    <td class="change-cell negative">-0.85%</td>
                                    <td class="state-name">per 10g</td>
                                    <td class="converted-value metals-converted" style="display:none;"></td>
                                </tr>
                                <tr data-name="gold 22k" data-price="12360" data-week="-0.82" data-unit="g">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Gold (22K)</span><span class="currency-name">Jewellery Gold</span></div></div></td>
                                    <td class="fuel-price-cell">1,23,600</td>
                                    <td class="change-cell negative">-0.82%</td>
                                    <td class="state-name">per 10g</td>
                                    <td class="converted-value metals-converted" style="display:none;"></td>
                                </tr>
                                <tr data-name="gold 18k" data-price="10113" data-week="-0.80" data-unit="g">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Gold (18K)</span><span class="currency-name">18 Karat Gold</span></div></div></td>
                                    <td class="fuel-price-cell">1,01,130</td>
                                    <td class="change-cell negative">-0.80%</td>
                                    <td class="state-name">per 10g</td>
                                    <td class="converted-value metals-converted" style="display:none;"></td>
                                </tr>
                                <tr data-name="silver" data-price="95.5" data-week="-2.15" data-unit="g">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Silver</span><span class="currency-name">Pure Silver</span></div></div></td>
                                    <td class="fuel-price-cell">95,500</td>
                                    <td class="change-cell negative">-2.15%</td>
                                    <td class="state-name">per 1kg</td>
                                    <td class="converted-value metals-converted" style="display:none;"></td>
                                </tr>
                                <tr data-name="platinum" data-price="3145" data-week="+1.20" data-unit="g">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Platinum</span><span class="currency-name">Pure Platinum</span></div></div></td>
                                    <td class="fuel-price-cell">31,450</td>
                                    <td class="change-cell positive">+1.20%</td>
                                    <td class="state-name">per 10g</td>
                                    <td class="converted-value metals-converted" style="display:none;"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Prices updated manually. Last update: 19 Dec 2025. Source: <a href="https://www.goodreturns.in/gold-rates/" target="_blank">GoodReturns</a></span>
                    </div>
                </div>
            </div>

            <!-- Fuel Section -->
            <div id="sectionFuel" class="section-panel" style="display: none;">
                <div class="table-container">
                    <div class="toolbar">
                        <div class="toolbar-title">
                            <h2>Fuel Prices</h2>
                            <span>19 Dec 2025</span>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="search-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <input type="text" id="fuelSearchInput" placeholder="Search city..." oninput="filterFuel()">
                            <button class="search-clear" id="fuelClearBtn" onclick="clearFuelSearch()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="share-container">
                            <button class="share-btn" onclick="toggleFuelShare()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/>
                                    <circle cx="6" cy="12" r="3"/>
                                    <circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="fuelShareDropdown">
                                <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                    WhatsApp
                                </a>
                                <a href="#" class="share-option twitter" onclick="shareTwitter(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    Twitter / X
                                </a>
                                <div class="share-divider"></div>
                                <button class="share-option copy" onclick="copyLink()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table class="currency-table fuel-table" id="fuelTable">
                            <thead>
                                <tr>
                                    <th style="text-align: left;" onclick="sortFuel('city')"><span class="th-content">City <span class="sort-icon"></span></span></th>
                                    <th onclick="sortFuel('petrol')"><span class="th-content"> Petrol/L <span class="sort-icon"></span></span></th>
                                    <th onclick="sortFuel('diesel')"><span class="th-content"> Diesel/L <span class="sort-icon"></span></span></th>
                                    <th onclick="sortFuel('cng')"><span class="th-content"> CNG/kg <span class="sort-icon"></span></span></th>
                                    <th onclick="sortFuel('lpg')"><span class="th-content"> LPG 14.2kg <span class="sort-icon"></span></span></th>
                                    <th><span class="th-content">1W Change</span></th>
                                </tr>
                            </thead>
                            <tbody id="fuelTableBody">
                                <tr data-city="new delhi" data-petrol="94.77" data-diesel="87.67" data-cng="77.09" data-lpg="853">
                                    <td><div class="city-cell"><span class="city-name">New Delhi</span><span class="state-name">Delhi</span></div></td>
                                    <td class="fuel-price-cell">94.77</td>
                                    <td class="fuel-price-cell">87.67</td>
                                    <td class="fuel-price-cell">77.09</td>
                                    <td class="fuel-price-cell">853.00</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="mumbai" data-petrol="103.54" data-diesel="90.03" data-cng="77.00" data-lpg="852.50">
                                    <td><div class="city-cell"><span class="city-name">Mumbai</span><span class="state-name">Maharashtra</span></div></td>
                                    <td class="fuel-price-cell">103.54</td>
                                    <td class="fuel-price-cell">90.03</td>
                                    <td class="fuel-price-cell">77.00</td>
                                    <td class="fuel-price-cell">852.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="bangalore" data-petrol="102.92" data-diesel="90.99" data-cng="89.95" data-lpg="855.50">
                                    <td><div class="city-cell"><span class="city-name">Bangalore</span><span class="state-name">Karnataka</span></div></td>
                                    <td class="fuel-price-cell">102.92</td>
                                    <td class="fuel-price-cell">90.99</td>
                                    <td class="fuel-price-cell">89.95</td>
                                    <td class="fuel-price-cell">855.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="chennai" data-petrol="101.03" data-diesel="92.61" data-cng="91.50" data-lpg="818.50">
                                    <td><div class="city-cell"><span class="city-name">Chennai</span><span class="state-name">Tamil Nadu</span></div></td>
                                    <td class="fuel-price-cell">101.03</td>
                                    <td class="fuel-price-cell">92.61</td>
                                    <td class="fuel-price-cell">91.50</td>
                                    <td class="fuel-price-cell">818.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="kolkata" data-petrol="105.41" data-diesel="92.02" data-cng="85.00" data-lpg="885.50">
                                    <td><div class="city-cell"><span class="city-name">Kolkata</span><span class="state-name">West Bengal</span></div></td>
                                    <td class="fuel-price-cell">105.41</td>
                                    <td class="fuel-price-cell">92.02</td>
                                    <td class="fuel-price-cell">85.00</td>
                                    <td class="fuel-price-cell">885.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="hyderabad" data-petrol="107.46" data-diesel="95.70" data-cng="96.00" data-lpg="905.00">
                                    <td><div class="city-cell"><span class="city-name">Hyderabad</span><span class="state-name">Telangana</span></div></td>
                                    <td class="fuel-price-cell">107.46</td>
                                    <td class="fuel-price-cell">95.70</td>
                                    <td class="fuel-price-cell">96.00</td>
                                    <td class="fuel-price-cell">905.00</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="ahmedabad" data-petrol="94.49" data-diesel="90.16" data-cng="82.38" data-lpg="860.00">
                                    <td><div class="city-cell"><span class="city-name">Ahmedabad</span><span class="state-name">Gujarat</span></div></td>
                                    <td class="fuel-price-cell">94.49</td>
                                    <td class="fuel-price-cell">90.16</td>
                                    <td class="fuel-price-cell">82.38</td>
                                    <td class="fuel-price-cell">860.00</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="pune" data-petrol="103.54" data-diesel="90.03" data-cng="77.00" data-lpg="852.50">
                                    <td><div class="city-cell"><span class="city-name">Pune</span><span class="state-name">Maharashtra</span></div></td>
                                    <td class="fuel-price-cell">103.54</td>
                                    <td class="fuel-price-cell">90.03</td>
                                    <td class="fuel-price-cell">77.00</td>
                                    <td class="fuel-price-cell">852.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="jaipur" data-petrol="104.88" data-diesel="90.36" data-cng="88.50" data-lpg="870.00">
                                    <td><div class="city-cell"><span class="city-name">Jaipur</span><span class="state-name">Rajasthan</span></div></td>
                                    <td class="fuel-price-cell">104.88</td>
                                    <td class="fuel-price-cell">90.36</td>
                                    <td class="fuel-price-cell">88.50</td>
                                    <td class="fuel-price-cell">870.00</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                                <tr data-city="lucknow" data-petrol="94.65" data-diesel="87.76" data-cng="93.00" data-lpg="890.50">
                                    <td><div class="city-cell"><span class="city-name">Lucknow</span><span class="state-name">Uttar Pradesh</span></div></td>
                                    <td class="fuel-price-cell">94.65</td>
                                    <td class="fuel-price-cell">87.76</td>
                                    <td class="fuel-price-cell">93.00</td>
                                    <td class="fuel-price-cell">890.50</td>
                                    <td class="change-cell neutral">No change</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Prices updated manually. Last update: 19 Dec 2025. Fuel prices have been stable for the past week. Sources: <a href="https://www.cardekho.com/cng-price" target="_blank">CarDekho</a>, <a href="https://www.goodreturns.in/lpg-price.html" target="_blank">GoodReturns</a></span>
                    </div>
                </div>
            </div>

            <!-- Banking Rates Section -->
            <div id="sectionBanking" class="section-panel" style="display: none;">
                <div class="table-container">
                    <div class="toolbar">
                        <div class="toolbar-title">
                            <h2>Banking Rates</h2>
                            <span>December 2025</span>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toggle-group">
                            <button class="toggle-btn active" id="toggleFD" onclick="setBankingTab('fd')">FD Rates</button>
                            <button class="toggle-btn" id="toggleHomeLoan" onclick="setBankingTab('homeloan')">Home Loan</button>
                            <button class="toggle-btn" id="toggleCarLoan" onclick="setBankingTab('carloan')">Car Loan</button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="search-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <input type="text" id="bankingSearchInput" placeholder="Search bank..." oninput="filterBanking()">
                            <button class="search-clear" id="bankingClearBtn" onclick="clearBankingSearch()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="share-container">
                            <button class="share-btn" onclick="toggleBankingShare()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/>
                                    <circle cx="6" cy="12" r="3"/>
                                    <circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="bankingShareDropdown">
                                <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                                    WhatsApp
                                </a>
                                <a href="#" class="share-option twitter" onclick="shareTwitter(event)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                    Twitter / X
                                </a>
                                <div class="share-divider"></div>
                                <button class="share-option copy" onclick="copyLink()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    Copy Link
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- FD Rates Table -->
                    <div id="fdRatesTable" class="banking-subtable">
                        <div class="table-scroll">
                            <table class="currency-table" id="fdTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;" onclick="sortBanking('fd', 'bank')"><span class="th-content">Bank <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('fd', 'rate1y')"><span class="th-content">1 Year <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('fd', 'rate3y')"><span class="th-content">3 Years <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('fd', 'rate5y')"><span class="th-content">5 Years <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('fd', 'senior')"><span class="th-content">Senior Citizen <span class="sort-icon"></span></span></th>
                                    </tr>
                                </thead>
                                <tbody id="fdTableBody">
                                    <tr data-bank="sbi" data-rate1y="6.80" data-rate3y="6.75" data-rate5y="6.50" data-senior="7.30">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SBI</span><span class="currency-name">State Bank of India</span></div></div></td>
                                        <td class="fuel-price-cell">6.80%</td>
                                        <td class="fuel-price-cell">6.75%</td>
                                        <td class="fuel-price-cell">6.50%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="hdfc" data-rate1y="6.60" data-rate3y="7.00" data-rate5y="7.00" data-senior="7.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">HDFC Bank</span><span class="currency-name">Housing Development Finance</span></div></div></td>
                                        <td class="fuel-price-cell">6.60%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="icici" data-rate1y="6.70" data-rate3y="7.00" data-rate5y="7.00" data-senior="7.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ICICI Bank</span><span class="currency-name">Industrial Credit</span></div></div></td>
                                        <td class="fuel-price-cell">6.70%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="axis" data-rate1y="6.70" data-rate3y="7.00" data-rate5y="7.00" data-senior="7.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Axis Bank</span><span class="currency-name">Axis Bank Limited</span></div></div></td>
                                        <td class="fuel-price-cell">6.70%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="fuel-price-cell">7.00%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="kotak" data-rate1y="6.65" data-rate3y="6.30" data-rate5y="6.30" data-senior="6.80">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Kotak Bank</span><span class="currency-name">Kotak Mahindra Bank</span></div></div></td>
                                        <td class="fuel-price-cell">6.65%</td>
                                        <td class="fuel-price-cell">6.30%</td>
                                        <td class="fuel-price-cell">6.30%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="pnb" data-rate1y="6.80" data-rate3y="6.50" data-rate5y="6.50" data-senior="7.30">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">PNB</span><span class="currency-name">Punjab National Bank</span></div></div></td>
                                        <td class="fuel-price-cell">6.80%</td>
                                        <td class="fuel-price-cell">6.50%</td>
                                        <td class="fuel-price-cell">6.50%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="bob" data-rate1y="6.85" data-rate3y="6.50" data-rate5y="6.50" data-senior="7.35">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Bank of Baroda</span><span class="currency-name">Bank of Baroda</span></div></div></td>
                                        <td class="fuel-price-cell">6.85%</td>
                                        <td class="fuel-price-cell">6.50%</td>
                                        <td class="fuel-price-cell">6.50%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                    <tr data-bank="canara" data-rate1y="6.85" data-rate3y="6.70" data-rate5y="6.70" data-senior="7.35">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Canara Bank</span><span class="currency-name">Canara Bank</span></div></div></td>
                                        <td class="fuel-price-cell">6.85%</td>
                                        <td class="fuel-price-cell">6.70%</td>
                                        <td class="fuel-price-cell">6.70%</td>
                                        <td class="change-cell positive">+0.50%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Home Loan Rates Table -->
                    <div id="homeLoanTable" class="banking-subtable" style="display: none;">
                        <div class="table-scroll">
                            <table class="currency-table" id="hlTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;" onclick="sortBanking('hl', 'bank')"><span class="th-content">Bank <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('hl', 'rate')"><span class="th-content">Interest Rate <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('hl', 'processing')"><span class="th-content">Processing Fee <span class="sort-icon"></span></span></th>
                                        <th><span class="th-content">Max Tenure</span></th>
                                    </tr>
                                </thead>
                                <tbody id="hlTableBody">
                                    <tr data-bank="sbi" data-rate="8.50" data-processing="0.35">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SBI</span><span class="currency-name">State Bank of India</span></div></div></td>
                                        <td class="fuel-price-cell">8.50% - 9.65%</td>
                                        <td class="state-name">0.35% + GST</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                    <tr data-bank="hdfc" data-rate="8.75" data-processing="0.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">HDFC Bank</span><span class="currency-name">Housing Development Finance</span></div></div></td>
                                        <td class="fuel-price-cell">8.75% onwards</td>
                                        <td class="state-name">0.50% or 3,000</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                    <tr data-bank="icici" data-rate="8.75" data-processing="0.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ICICI Bank</span><span class="currency-name">Industrial Credit</span></div></div></td>
                                        <td class="fuel-price-cell">8.75% onwards</td>
                                        <td class="state-name">0.50% + GST</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                    <tr data-bank="axis" data-rate="8.75" data-processing="1.00">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Axis Bank</span><span class="currency-name">Axis Bank Limited</span></div></div></td>
                                        <td class="fuel-price-cell">8.75% - 9.15%</td>
                                        <td class="state-name">Up to 1%</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                    <tr data-bank="kotak" data-rate="8.70" data-processing="0.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Kotak Bank</span><span class="currency-name">Kotak Mahindra Bank</span></div></div></td>
                                        <td class="fuel-price-cell">8.70% onwards</td>
                                        <td class="state-name">0.50%</td>
                                        <td class="state-name">20 years</td>
                                    </tr>
                                    <tr data-bank="boi" data-rate="8.40" data-processing="0.25">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Bank of India</span><span class="currency-name">Lowest Rate</span></div></div></td>
                                        <td class="fuel-price-cell highlight">8.40% onwards</td>
                                        <td class="state-name">0.25%</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                    <tr data-bank="ubi" data-rate="8.35" data-processing="0.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Union Bank</span><span class="currency-name">Lowest Rate</span></div></div></td>
                                        <td class="fuel-price-cell highlight">8.35% onwards</td>
                                        <td class="state-name">0.50%</td>
                                        <td class="state-name">30 years</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Car Loan Rates Table -->
                    <div id="carLoanTable" class="banking-subtable" style="display: none;">
                        <div class="table-scroll">
                            <table class="currency-table" id="clTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;" onclick="sortBanking('cl', 'bank')"><span class="th-content">Bank <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('cl', 'newcar')"><span class="th-content">New Car <span class="sort-icon"></span></span></th>
                                        <th onclick="sortBanking('cl', 'usedcar')"><span class="th-content">Used Car <span class="sort-icon"></span></span></th>
                                        <th><span class="th-content">Max Tenure</span></th>
                                    </tr>
                                </thead>
                                <tbody id="clTableBody">
                                    <tr data-bank="sbi" data-newcar="8.65" data-usedcar="9.80">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SBI</span><span class="currency-name">State Bank of India</span></div></div></td>
                                        <td class="fuel-price-cell">8.65% - 9.30%</td>
                                        <td class="fuel-price-cell">9.80% - 10.50%</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                    <tr data-bank="hdfc" data-newcar="8.80" data-usedcar="11.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">HDFC Bank</span><span class="currency-name">Housing Development Finance</span></div></div></td>
                                        <td class="fuel-price-cell">8.80% - 9.50%</td>
                                        <td class="fuel-price-cell">11.50% - 13.00%</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                    <tr data-bank="icici" data-newcar="8.80" data-usedcar="11.00">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ICICI Bank</span><span class="currency-name">Industrial Credit</span></div></div></td>
                                        <td class="fuel-price-cell">8.80% - 12.25%</td>
                                        <td class="fuel-price-cell">11.00% - 14.00%</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                    <tr data-bank="axis" data-newcar="8.99" data-usedcar="14.00">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Axis Bank</span><span class="currency-name">Axis Bank Limited</span></div></div></td>
                                        <td class="fuel-price-cell">8.99% - 10.48%</td>
                                        <td class="fuel-price-cell">14.00% - 17.00%</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                    <tr data-bank="kotak" data-newcar="8.50" data-usedcar="10.50">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Kotak Bank</span><span class="currency-name">Kotak Mahindra Bank</span></div></div></td>
                                        <td class="fuel-price-cell highlight">8.50% onwards</td>
                                        <td class="fuel-price-cell">10.50% onwards</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                    <tr data-bank="bob" data-newcar="8.70" data-usedcar="10.00">
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Bank of Baroda</span><span class="currency-name">Bank of Baroda</span></div></div></td>
                                        <td class="fuel-price-cell">8.70% onwards</td>
                                        <td class="fuel-price-cell">10.00% onwards</td>
                                        <td class="state-name">7 years</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="section-note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Rates vary based on credit score, loan amount, and tenure. Last update: Dec 2025. Sources: <a href="https://www.bankbazaar.com" target="_blank">BankBazaar</a>, <a href="https://www.paisabazaar.com" target="_blank">Paisabazaar</a></span>
                    </div>
                </div>
            </div>

            <!-- Markets Section -->
            <div id="sectionMarkets" class="section-panel">
                <!-- Market Breadth & Quick Stats -->
                <div class="market-overview">
                    <div class="market-breadth-card">
                        <h3>Market Breadth</h3>
                        <div class="breadth-bar">
                            <div class="breadth-advances" id="breadthAdvances" style="width: 50%"></div>
                            <div class="breadth-declines" id="breadthDeclines" style="width: 50%"></div>
                        </div>
                        <div class="breadth-labels">
                            <span class="advances-label"><span id="advancesCount">25</span> Advances</span>
                            <span class="declines-label"><span id="declinesCount">25</span> Declines</span>
                        </div>
                    </div>
                    <div class="market-stats-card">
                        <div class="stat-item">
                            <span class="stat-label">NIFTY 50</span>
                            <span class="stat-value" id="niftyQuickValue">--</span>
                            <span class="stat-change" id="niftyQuickChange">--</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">BANK NIFTY</span>
                            <span class="stat-value" id="bankNiftyQuickValue">--</span>
                            <span class="stat-change" id="bankNiftyQuickChange">--</span>
                        </div>
                    </div>
                </div>

                <!-- Sub-navigation tabs -->
                <div class="market-tabs">
                    <button class="market-tab active" onclick="showMarketTab('indices')">Indices</button>
                    <button class="market-tab" onclick="showMarketTab('sectors')">Sectors</button>
                    <button class="market-tab" onclick="showMarketTab('gainers')">Top Gainers</button>
                    <button class="market-tab" onclick="showMarketTab('losers')">Top Losers</button>
                    <button class="market-tab" onclick="showMarketTab('nifty50')">Nifty 50</button>
                    <button class="market-tab" onclick="showMarketTab('watchlist')">Watchlist</button>
                </div>

                <!-- Indices Tab -->
                <div id="marketTabIndices" class="market-tab-content active">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>Stock Market Indices</h2>
                                <span id="marketsDateSpan">19 Dec 2025</span>
                            </div>
                            <div class="toolbar-divider"></div>
                            <button class="refresh-btn" onclick="refreshMarketData()" style="padding: 8px 14px; font-size: 13px;">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                    <path d="M23 4v6h-6M1 20v-6h6"/>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                                </svg>
                                Refresh
                            </button>
                        </div>
                        <div class="table-scroll">
                            <table class="currency-table" id="marketsTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Index</th>
                                        <th>Value</th>
                                        <th>Change</th>
                                        <th>% Change</th>
                                        <th>High</th>
                                        <th>Low</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Sectors Tab -->
                <div id="marketTabSectors" class="market-tab-content">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>Sectoral Performance</h2>
                                <span>Click on a sector to see underlying stocks</span>
                            </div>
                        </div>
                        <div class="sectors-list" id="sectorsList">
                            <!-- Sectors will be populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Top Gainers Tab -->
                <div id="marketTabGainers" class="market-tab-content">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>Top 10 Gainers</h2>
                                <span>Nifty 50 stocks with highest gains today</span>
                            </div>
                        </div>
                        <div class="table-scroll">
                            <table class="currency-table" id="gainersTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Stock</th>
                                        <th>LTP</th>
                                        <th>Change</th>
                                        <th>% Change</th>
                                        <th>Volume</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Top Losers Tab -->
                <div id="marketTabLosers" class="market-tab-content">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>Top 10 Losers</h2>
                                <span>Nifty 50 stocks with highest losses today</span>
                            </div>
                        </div>
                        <div class="table-scroll">
                            <table class="currency-table" id="losersTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Stock</th>
                                        <th>LTP</th>
                                        <th>Change</th>
                                        <th>% Change</th>
                                        <th>Volume</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Nifty 50 Tab -->
                <div id="marketTabNifty50" class="market-tab-content">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>Nifty 50 Stocks</h2>
                                <span>All 50 constituents</span>
                            </div>
                            <div class="toolbar-divider"></div>
                            <input type="text" id="nifty50Search" placeholder="Search stocks..." class="stock-search" oninput="filterNifty50Stocks()">
                        </div>
                        <div class="table-scroll">
                            <table class="currency-table" id="nifty50Table">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;" onclick="sortNifty50('symbol')">Stock</th>
                                        <th onclick="sortNifty50('ltp')">LTP</th>
                                        <th onclick="sortNifty50('change')">Change</th>
                                        <th onclick="sortNifty50('changePercent')">% Change</th>
                                        <th onclick="sortNifty50('volume')">Volume</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Watchlist Tab -->
                <div id="marketTabWatchlist" class="market-tab-content">
                    <div class="table-container">
                        <div class="toolbar">
                            <div class="toolbar-title">
                                <h2>My Watchlist</h2>
                                <span id="watchlistCount">0 stocks</span>
                            </div>
                            <div class="toolbar-divider"></div>
                            <button class="refresh-btn" onclick="clearWatchlist()" style="padding: 8px 14px; font-size: 13px; background: var(--danger);">
                                Clear All
                            </button>
                        </div>
                        <div class="table-scroll">
                            <table class="currency-table" id="watchlistTable">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Stock</th>
                                        <th>LTP</th>
                                        <th>Change</th>
                                        <th>% Change</th>
                                        <th>Volume</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-watchlist">
                                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-400);">
                                            No stocks in watchlist. Add stocks from Nifty 50 tab.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="section-note">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <span>Market data is indicative. Source: <a href="https://www.nseindia.com" target="_blank">NSE India</a> via Kite Connect</span>
                </div>
            </div>

            <!-- Crypto Section -->
            <div id="sectionCrypto" class="section-panel" style="display: none;">
                <div class="table-container">
                    <div class="toolbar">
                        <div class="toolbar-title">
                            <h2>Cryptocurrency Prices</h2>
                            <span>in INR</span>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="search-box">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                            </svg>
                            <input type="text" id="cryptoSearchInput" placeholder="Search..." oninput="filterCrypto()">
                            <button class="search-clear" id="cryptoClearBtn" onclick="clearCryptoSearch()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="share-container">
                            <button class="share-btn" onclick="toggleCryptoShare()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="cryptoShareDropdown">
                                <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>WhatsApp</a>
                                <a href="#" class="share-option twitter" onclick="shareTwitter(event)"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Twitter / X</a>
                                <div class="share-divider"></div>
                                <button class="share-option copy" onclick="copyLink()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Link</button>
                            </div>
                        </div>
                    </div>
                    <div class="table-scroll">
                        <table class="currency-table" id="cryptoTable">
                            <thead>
                                <tr>
                                    <th style="text-align: left;">Coin</th>
                                    <th>Price (INR)</th>
                                    <th>24h Change</th>
                                    <th>7d Change</th>
                                    <th>Market Cap</th>
                                </tr>
                            </thead>
                            <tbody id="cryptoTableBody">
                                <tr data-coin="bitcoin">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">BTC</span><span class="currency-name">Bitcoin</span></div></div></td>
                                    <td class="fuel-price-cell">78,30,819</td>
                                    <td class="change-cell negative">-0.5%</td>
                                    <td class="change-cell negative">-5.9%</td>
                                    <td class="state-name">155L Cr</td>
                                </tr>
                                <tr data-coin="ethereum">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ETH</span><span class="currency-name">Ethereum</span></div></div></td>
                                    <td class="fuel-price-cell">2,82,196</td>
                                    <td class="change-cell negative">-4.05%</td>
                                    <td class="change-cell negative">-12.05%</td>
                                    <td class="state-name">34L Cr</td>
                                </tr>
                                <tr data-coin="tether">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">USDT</span><span class="currency-name">Tether</span></div></div></td>
                                    <td class="fuel-price-cell">84.50</td>
                                    <td class="change-cell neutral">0.0%</td>
                                    <td class="change-cell neutral">0.0%</td>
                                    <td class="state-name">11.5L Cr</td>
                                </tr>
                                <tr data-coin="bnb">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">BNB</span><span class="currency-name">Binance Coin</span></div></div></td>
                                    <td class="fuel-price-cell">58,450</td>
                                    <td class="change-cell negative">-2.3%</td>
                                    <td class="change-cell negative">-8.1%</td>
                                    <td class="state-name">8.5L Cr</td>
                                </tr>
                                <tr data-coin="solana">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SOL</span><span class="currency-name">Solana</span></div></div></td>
                                    <td class="fuel-price-cell">15,820</td>
                                    <td class="change-cell negative">-3.8%</td>
                                    <td class="change-cell negative">-15.2%</td>
                                    <td class="state-name">7.5L Cr</td>
                                </tr>
                                <tr data-coin="xrp">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">XRP</span><span class="currency-name">Ripple</span></div></div></td>
                                    <td class="fuel-price-cell">195.40</td>
                                    <td class="change-cell negative">-1.2%</td>
                                    <td class="change-cell positive">+2.5%</td>
                                    <td class="state-name">9.2L Cr</td>
                                </tr>
                                <tr data-coin="cardano">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ADA</span><span class="currency-name">Cardano</span></div></div></td>
                                    <td class="fuel-price-cell">76.85</td>
                                    <td class="change-cell negative">-2.8%</td>
                                    <td class="change-cell negative">-10.5%</td>
                                    <td class="state-name">2.7L Cr</td>
                                </tr>
                                <tr data-coin="dogecoin">
                                    <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">DOGE</span><span class="currency-name">Dogecoin</span></div></div></td>
                                    <td class="fuel-price-cell">26.50</td>
                                    <td class="change-cell negative">-4.5%</td>
                                    <td class="change-cell negative">-18.2%</td>
                                    <td class="state-name">3.9L Cr</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="section-note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Crypto prices are highly volatile. Last update: 19 Dec 2025. Source: <a href="https://www.coingecko.com" target="_blank">CoinGecko</a></span>
                    </div>
                </div>
            </div>

            <!-- Economy Section (RBI & Economy) -->
            <div id="sectionEconomy" class="section-panel" style="display: none;">
                <div class="table-container">
                    <div class="toolbar">
                        <div class="toolbar-title">
                            <h2>RBI & Economy</h2>
                            <span>December 2025</span>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="toggle-group">
                            <button class="toggle-btn active" id="toggleRBI" onclick="setEconomyTab('rbi')">RBI Rates</button>
                            <button class="toggle-btn" id="toggleInflation" onclick="setEconomyTab('inflation')">Inflation & Bonds</button>
                            <button class="toggle-btn" id="toggleSavings" onclick="setEconomyTab('savings')">Savings A/c</button>
                        </div>
                        <div class="toolbar-divider"></div>
                        <div class="share-container">
                            <button class="share-btn" onclick="toggleEconomyShare()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                                </svg>
                                Share
                            </button>
                            <div class="share-dropdown" id="economyShareDropdown">
                                <a href="#" class="share-option whatsapp" onclick="shareWhatsApp(event)"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>WhatsApp</a>
                                <a href="#" class="share-option twitter" onclick="shareTwitter(event)"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Twitter / X</a>
                                <div class="share-divider"></div>
                                <button class="share-option copy" onclick="copyLink()"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Link</button>
                            </div>
                        </div>
                    </div>

                    <!-- RBI Rates Table -->
                    <div id="rbiRatesTable" class="banking-subtable">
                        <div class="table-scroll">
                            <table class="currency-table">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Rate Type</th>
                                        <th>Current Rate</th>
                                        <th>Previous</th>
                                        <th>Last Changed</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Repo Rate</span><span class="currency-name">Policy Rate</span></div></div></td>
                                        <td class="fuel-price-cell highlight">5.25%</td>
                                        <td class="state-name">5.50%</td>
                                        <td class="change-cell negative">5 Dec 2025 (-25 bps)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Reverse Repo</span><span class="currency-name">Liquidity Absorption</span></div></div></td>
                                        <td class="fuel-price-cell">3.35%</td>
                                        <td class="state-name">3.35%</td>
                                        <td class="state-name">Unchanged</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">CRR</span><span class="currency-name">Cash Reserve Ratio</span></div></div></td>
                                        <td class="fuel-price-cell highlight">3.00%</td>
                                        <td class="state-name">4.00%</td>
                                        <td class="change-cell negative">Dec 2025 (-100 bps)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SLR</span><span class="currency-name">Statutory Liquidity Ratio</span></div></div></td>
                                        <td class="fuel-price-cell">18.00%</td>
                                        <td class="state-name">18.00%</td>
                                        <td class="state-name">Unchanged</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">MSF Rate</span><span class="currency-name">Marginal Standing Facility</span></div></div></td>
                                        <td class="fuel-price-cell">5.50%</td>
                                        <td class="state-name">5.75%</td>
                                        <td class="state-name">5 Dec 2025</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Bank Rate</span><span class="currency-name">Lending to Banks</span></div></div></td>
                                        <td class="fuel-price-cell">5.50%</td>
                                        <td class="state-name">5.75%</td>
                                        <td class="state-name">5 Dec 2025</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Inflation & Bonds Table -->
                    <div id="inflationTable" class="banking-subtable" style="display: none;">
                        <div class="table-scroll">
                            <table class="currency-table">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Indicator</th>
                                        <th>Current</th>
                                        <th>Previous</th>
                                        <th>YoY Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">CPI Inflation</span><span class="currency-name">Consumer Price Index</span></div></div></td>
                                        <td class="fuel-price-cell highlight">0.71%</td>
                                        <td class="state-name">0.25% (Oct)</td>
                                        <td class="change-cell positive">Below RBI target</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Food Inflation</span><span class="currency-name">CFPI</span></div></div></td>
                                        <td class="fuel-price-cell highlight">-3.91%</td>
                                        <td class="state-name">-5.02% (Oct)</td>
                                        <td class="change-cell positive">Deflationary</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">WPI Inflation</span><span class="currency-name">Wholesale Price Index</span></div></div></td>
                                        <td class="fuel-price-cell">1.89%</td>
                                        <td class="state-name">1.84% (Oct)</td>
                                        <td class="state-name">Stable</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">10Y G-Sec Yield</span><span class="currency-name">Government Bond</span></div></div></td>
                                        <td class="fuel-price-cell">6.61%</td>
                                        <td class="state-name">6.59%</td>
                                        <td class="change-cell negative">+0.02%</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">GDP Growth</span><span class="currency-name">FY25 Estimate</span></div></div></td>
                                        <td class="fuel-price-cell">6.5%</td>
                                        <td class="state-name">7.0% (FY24)</td>
                                        <td class="state-name">RBI Forecast</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Savings Account Rates Table -->
                    <div id="savingsTable" class="banking-subtable" style="display: none;">
                        <div class="table-scroll">
                            <table class="currency-table">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Bank</th>
                                        <th>Savings Rate</th>
                                        <th>Min Balance</th>
                                        <th>Special Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">SBI</span><span class="currency-name">State Bank of India</span></div></div></td>
                                        <td class="fuel-price-cell">2.70%</td>
                                        <td class="state-name">3,000</td>
                                        <td class="state-name">-</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">HDFC Bank</span><span class="currency-name">HDFC Bank Ltd</span></div></div></td>
                                        <td class="fuel-price-cell">3.00%</td>
                                        <td class="state-name">10,000</td>
                                        <td class="state-name">3.50% (>50L)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">ICICI Bank</span><span class="currency-name">ICICI Bank Ltd</span></div></div></td>
                                        <td class="fuel-price-cell">3.00%</td>
                                        <td class="state-name">10,000</td>
                                        <td class="state-name">3.50% (>50L)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Kotak Bank</span><span class="currency-name">Kotak Mahindra</span></div></div></td>
                                        <td class="fuel-price-cell">3.50%</td>
                                        <td class="state-name">10,000</td>
                                        <td class="state-name">4.00% (>1Cr)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">Yes Bank</span><span class="currency-name">Yes Bank Ltd</span></div></div></td>
                                        <td class="fuel-price-cell highlight">4.00%</td>
                                        <td class="state-name">10,000</td>
                                        <td class="state-name">5.00% (>1Cr)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">IndusInd Bank</span><span class="currency-name">IndusInd Bank Ltd</span></div></div></td>
                                        <td class="fuel-price-cell highlight">4.00%</td>
                                        <td class="state-name">10,000</td>
                                        <td class="state-name">5.00% (>2Cr)</td>
                                    </tr>
                                    <tr>
                                        <td><div class="currency-cell"><div class="currency-flag"></div><div class="currency-info"><span class="currency-code">AU Small Finance</span><span class="currency-name">AU Small Finance Bank</span></div></div></td>
                                        <td class="fuel-price-cell highlight">7.00%</td>
                                        <td class="state-name">2,500</td>
                                        <td class="state-name">Best Rate!</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="section-note">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <span>Data from RBI & official sources. Last update: Dec 2025. Source: <a href="https://www.rbi.org.in" target="_blank">RBI</a></span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Copied Toast -->
    <div class="copied-toast" id="copiedToast">Link copied to clipboard!</div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-disclaimer">
                    <strong>Disclaimer</strong>
                    <p>Exchange rates are provided by the European Central Bank (ECB) via Frankfurter API. Rates are indicative and may differ from actual market rates. For trading purposes, please consult your bank or forex dealer.</p>
                </div>
                <p class="footer-credit">Data source: <a href="https://www.ecb.europa.eu" target="_blank">European Central Bank</a> | API: <a href="https://www.frankfurter.app" target="_blank">Frankfurter</a></p>
            </div>
        </div>
    </footer>

    <script>
        // ===========================================
        // THEME MANAGEMENT
        // ===========================================
        const THEME_KEY = 'rateChartTheme';

        function initTheme() {
            const savedTheme = localStorage.getItem(THEME_KEY);
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem(THEME_KEY, newTheme);
        }

        // Initialize theme immediately
        initTheme();

        // ===========================================
        // SETTINGS MANAGEMENT (localStorage)
        // ===========================================
        const SETTINGS_KEY = 'rateChartSettings';

        // Load settings from localStorage
        function loadSettings() {
            try {
                const saved = localStorage.getItem(SETTINGS_KEY);
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
            return {
                kiteApiKey: '',
                kiteApiSecret: '',
                kiteAccessToken: '',
                metalsApiKey: '',
                proxyUrl: ''
            };
        }

        function getProxyUrl() {
            // For Cloudflare deployment, use relative paths (empty string)
            // For local dev with server.js, use 'http://localhost:3001'
            return appSettings.proxyUrl || '';
        }

        // Save settings to localStorage
        function saveSettingsToStorage(settings) {
            try {
                localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
                return true;
            } catch (e) {
                console.error('Error saving settings:', e);
                return false;
            }
        }

        // Get current settings
        let appSettings = loadSettings();

        // Dynamic API configuration (loaded from localStorage)
        function getMetalsApiKey() {
            return appSettings.metalsApiKey || '';
        }

        function getKiteApiKey() {
            return appSettings.kiteApiKey || '';
        }

        function getKiteAccessToken() {
            return appSettings.kiteAccessToken || '';
        }

        function isMetalsApiEnabled() {
            return getMetalsApiKey().length > 0;
        }

        function isKiteApiEnabled() {
            return getKiteApiKey().length > 0 && getKiteAccessToken().length > 0;
        }

        // Settings Modal Functions
        function openSettings() {
            const overlay = document.getElementById('settingsOverlay');
            overlay.classList.add('open');

            // Populate inputs with current values
            document.getElementById('kiteApiKey').value = appSettings.kiteApiKey || '';
            document.getElementById('kiteApiSecret').value = appSettings.kiteApiSecret || '';
            document.getElementById('kiteAccessToken').value = appSettings.kiteAccessToken || '';
            document.getElementById('proxyUrl').value = appSettings.proxyUrl || '';
            document.getElementById('metalsApiKey').value = appSettings.metalsApiKey || '';

            // Reset test result
            document.getElementById('kiteTestResult').style.display = 'none';

            // Update status badges
            updateSettingsBadges();
        }

        function closeSettings() {
            document.getElementById('settingsOverlay').classList.remove('open');
        }

        function closeSettingsOnOverlay(event) {
            if (event.target.id === 'settingsOverlay') {
                closeSettings();
            }
        }

        function updateSettingsBadges() {
            // Kite badge
            const kiteBadge = document.getElementById('kiteStatusBadge');
            if (isKiteApiEnabled()) {
                kiteBadge.textContent = 'Configured';
                kiteBadge.classList.remove('not-configured');
                kiteBadge.classList.add('configured');
            } else {
                kiteBadge.textContent = 'Not Configured';
                kiteBadge.classList.add('not-configured');
                kiteBadge.classList.remove('configured');
            }

            // Metals badge
            const metalsBadge = document.getElementById('metalsStatusBadge');
            if (isMetalsApiEnabled()) {
                metalsBadge.textContent = 'Configured';
                metalsBadge.classList.remove('not-configured');
                metalsBadge.classList.add('configured');
            } else {
                metalsBadge.textContent = 'Not Configured';
                metalsBadge.classList.add('not-configured');
                metalsBadge.classList.remove('configured');
            }

            // Update settings button appearance
            const settingsBtn = document.getElementById('settingsBtn');
            if (isKiteApiEnabled() || isMetalsApiEnabled()) {
                settingsBtn.classList.add('has-keys');
            } else {
                settingsBtn.classList.remove('has-keys');
            }
        }

        function saveSettings() {
            const newSettings = {
                kiteApiKey: document.getElementById('kiteApiKey').value.trim(),
                kiteApiSecret: document.getElementById('kiteApiSecret').value.trim(),
                kiteAccessToken: document.getElementById('kiteAccessToken').value.trim(),
                proxyUrl: document.getElementById('proxyUrl').value.trim(),
                metalsApiKey: document.getElementById('metalsApiKey').value.trim()
            };

            if (saveSettingsToStorage(newSettings)) {
                appSettings = newSettings;
                updateSettingsBadges();

                // Show success message
                const statusEl = document.getElementById('settingsStatus');
                statusEl.classList.add('success');
                statusEl.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                        <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    <span>Settings saved! Refreshing data...</span>
                `;

                // Refresh data with new API keys
                setTimeout(() => {
                    closeSettings();
                    // Refresh market data if Kite is configured
                    if (isKiteApiEnabled()) {
                        refreshMarketData();
                    }
                    // Refresh metal prices if Metals.dev is configured
                    if (isMetalsApiEnabled()) {
                        updateMetalPricesFromAPI();
                    }

                    // Reset status message
                    setTimeout(() => {
                        statusEl.classList.remove('success');
                        statusEl.innerHTML = `
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                            </svg>
                            <span>Settings are saved in your browser's local storage.</span>
                        `;
                    }, 2000);
                }, 500);
            }
        }

        function clearSettings() {
            if (confirm('Are you sure you want to clear all API settings?')) {
                document.getElementById('kiteApiKey').value = '';
                document.getElementById('kiteAccessToken').value = '';
                document.getElementById('proxyUrl').value = '';
                document.getElementById('metalsApiKey').value = '';

                appSettings = { kiteApiKey: '', kiteAccessToken: '', proxyUrl: '', metalsApiKey: '' };
                saveSettingsToStorage(appSettings);
                updateSettingsBadges();

                const statusEl = document.getElementById('settingsStatus');
                statusEl.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <span>All settings cleared.</span>
                `;
            }
        }

        // Login with Kite (OAuth flow)
        function loginWithKite() {
            // For cloud deployment: API credentials are stored in server environment variables
            // For local dev: use the API key from settings
            const apiKey = document.getElementById('kiteApiKey')?.value.trim() || appSettings.kiteApiKey;

            if (!apiKey) {
                alert('For cloud deployment, API credentials are configured server-side.\nFor local development, please enter your API Key.');
                return;
            }

            // Callback URL - API secret is stored server-side (secure)
            const callbackUrl = `${window.location.origin}/api/kite-callback`;
            const encodedCallback = encodeURIComponent(callbackUrl);

            // Redirect to Kite login
            window.location.href = `https://kite.zerodha.com/connect/login?v=3&api_key=${apiKey}&redirect_uri=${encodedCallback}`;
        }

        // Test Kite Connect API connection
        async function testKiteConnection() {
            const resultEl = document.getElementById('kiteTestResult');
            resultEl.style.display = 'block';
            resultEl.style.color = 'var(--gray-600)';
            resultEl.innerHTML = ' Testing connection...';

            const apiKey = document.getElementById('kiteApiKey').value.trim();
            const accessToken = document.getElementById('kiteAccessToken').value.trim();
            const proxyUrl = document.getElementById('proxyUrl').value.trim();

            if (!apiKey || !accessToken) {
                resultEl.style.color = 'var(--danger)';
                resultEl.innerHTML = ' Please enter API Key and Access Token first.';
                return;
            }

            if (!proxyUrl) {
                resultEl.style.color = 'var(--danger)';
                resultEl.innerHTML = ' Please enter Proxy URL. Run the proxy server first.';
                return;
            }

            try {
                // Test via proxy
                const testUrl = `${proxyUrl}/api/quote?i=NSE:NIFTY 50`;
                const response = await fetch(testUrl, {
                    headers: {
                        'X-Kite-Version': '3',
                        'Authorization': `token ${apiKey}:${accessToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.data && data.data['NSE:NIFTY 50']) {
                        const nifty = data.data['NSE:NIFTY 50'];
                        resultEl.style.color = 'var(--success)';
                        resultEl.innerHTML = ` Connected! NIFTY 50: ${nifty.last_price?.toLocaleString('en-IN')}`;
                    } else {
                        resultEl.style.color = 'var(--danger)';
                        resultEl.innerHTML = ' Invalid response from API. Check your credentials.';
                    }
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    resultEl.style.color = 'var(--danger)';
                    resultEl.innerHTML = ` API Error: ${errorData.message || response.statusText}`;
                }
            } catch (error) {
                resultEl.style.color = 'var(--danger)';
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    resultEl.innerHTML = ` Cannot reach proxy server. Make sure it's running at ${proxyUrl}`;
                } else {
                    resultEl.innerHTML = ` Error: ${error.message}`;
                }
            }
        }

        // Legacy compatibility - these will use localStorage values
        const METALS_API_KEY = getMetalsApiKey();
        const METALS_API_ENABLED = isMetalsApiEnabled();

        // ===========================================
        // Metals.dev API Integration
        // ===========================================
        async function fetchMetalPrices() {
            if (!isMetalsApiEnabled()) {
                console.log('Metals API not configured. Using static prices.');
                return null;
            }

            try {
                const response = await fetch(`https://api.metals.dev/v1/latest?api_key=${getMetalsApiKey()}&currency=INR&unit=gram`);
                if (!response.ok) throw new Error('Metals API error');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching metal prices:', error);
                return null;
            }
        }

        async function updateMetalPricesFromAPI() {
            const data = await fetchMetalPrices();
            if (!data || !data.metals) return;

            // Gold price per gram in INR (API returns per gram)
            const gold24kPerGram = data.metals.gold || 0;
            const silverPerGram = data.metals.silver || 0;
            const platinumPerGram = data.metals.platinum || 0;

            // Calculate 22K and 18K from 24K
            const gold22kPerGram = gold24kPerGram * (22/24);
            const gold18kPerGram = gold24kPerGram * (18/24);

            // Update table
            const rows = document.querySelectorAll('#metalsTableBody tr');
            const pricesPerGram = {
                'gold 24k': gold24kPerGram,
                'gold 22k': gold22kPerGram,
                'gold 18k': gold18kPerGram,
                'silver': silverPerGram,
                'platinum': platinumPerGram
            };

            rows.forEach(row => {
                const name = row.getAttribute('data-name');
                const pricePerGram = pricesPerGram[name];
                if (pricePerGram) {
                    row.setAttribute('data-price', pricePerGram.toFixed(2));
                    const priceCell = row.querySelector('.fuel-price-cell');
                    if (priceCell) {
                        // Gold/Platinum show per 10g, Silver shows per kg
                        if (name === 'silver') {
                            const pricePer1kg = pricePerGram * 1000;
                            priceCell.textContent = '' + pricePer1kg.toLocaleString('en-IN', {maximumFractionDigits: 0});
                        } else {
                            const pricePer10g = pricePerGram * 10;
                            priceCell.textContent = '' + pricePer10g.toLocaleString('en-IN', {maximumFractionDigits: 0});
                        }
                    }
                }
            });

            // Update timestamp
            const dateSpan = document.querySelector('#sectionMetals .toolbar-title span');
            if (dateSpan) {
                const now = new Date();
                dateSpan.textContent = now.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) + ' (Live)';
            }

            console.log('Metal prices updated from API');
        }

        // ===========================================
        // Zerodha Kite Connect API Configuration
        // ===========================================
        // API keys are now managed via the Settings UI (click gear icon)
        // Keys are stored in localStorage and loaded dynamically
        //
        // IMPORTANT: Due to CORS restrictions, you need to either:
        // 1. Use a proxy server (recommended for production)
        // 2. Use a browser extension to disable CORS (for testing only)
        // 3. Run via a local server with CORS headers
        //
        // Instrument tokens for indices:
        // NIFTY 50: 256265, SENSEX: 265, BANKNIFTY: 260105
        // NIFTY IT: 259849, NIFTY REALTY: 260361

        // Market indices configuration
        const MARKET_INDICES = {
            'SENSEX': {
                symbol: 'BSE:SENSEX',
                name: 'BSE Sensex 30',
                icon: '',
                token: 265
            },
            'NIFTY 50': {
                symbol: 'NSE:NIFTY 50',
                name: 'NSE Nifty Fifty',
                icon: '',
                token: 256265
            },
            'BANK NIFTY': {
                symbol: 'NSE:NIFTY BANK',
                name: 'Nifty Bank Index',
                icon: '',
                token: 260105
            },
            'NIFTY IT': {
                symbol: 'NSE:NIFTY IT',
                name: 'Nifty IT Index',
                icon: '',
                token: 259849
            },
            'NIFTY REALTY': {
                symbol: 'NSE:NIFTY REALTY',
                name: 'Nifty Realty Index',
                icon: '',
                token: 260361
            }
        };

        // Fetch market data from Kite Connect (via proxy)
        async function fetchMarketData() {
            if (!isKiteApiEnabled()) {
                console.log('Kite Connect API not configured. Using static prices.');
                return null;
            }

            try {
                // Build instrument list for query
                const instruments = Object.values(MARKET_INDICES).map(i => i.symbol).join('&i=');
                const proxyUrl = getProxyUrl();
                const url = `${proxyUrl}/api/quote?i=${instruments}`;

                const response = await fetch(url, {
                    headers: {
                        'X-Kite-Version': '3',
                        'Authorization': `token ${getKiteApiKey()}:${getKiteAccessToken()}`
                    }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Kite API error');
                }

                const data = await response.json();
                return data.data;
            } catch (error) {
                console.error('Error fetching market data:', error);
                // Show error to user
                updateMarketsStatus('API Error: ' + error.message, true);
                return null;
            }
        }

        // Update market table with live data
        async function updateMarketPricesFromAPI() {
            const data = await fetchMarketData();
            if (!data) return;

            console.log('Market API Response:', data);

            const tbody = document.querySelector('#marketsTable tbody');
            if (!tbody) return;

            // Clear existing rows
            tbody.innerHTML = '';

            // Update each index
            for (const [code, config] of Object.entries(MARKET_INDICES)) {
                const quote = data[config.symbol];
                if (!quote) {
                    console.log(`No quote for ${config.symbol}`);
                    continue;
                }

                console.log(`${code} quote:`, quote);

                // Calculate change from OHLC close (previous day close)
                // net_change can be 0 for some instruments, so prefer OHLC calculation
                const ltp = quote.last_price || 0;
                const close = quote.ohlc?.close || ltp;
                let change;
                if (close && close !== ltp) {
                    change = ltp - close;
                } else if (quote.net_change && quote.net_change !== 0) {
                    change = quote.net_change;
                } else {
                    change = ltp - (quote.ohlc?.open || ltp);
                }
                const changePercent = close !== 0 ? ((change / close) * 100) : 0;
                const changeClass = change >= 0 ? 'positive' : 'negative';
                const changeSign = change >= 0 ? '+' : '';

                const row = document.createElement('tr');
                row.className = `market-row ${changeClass}`;
                row.innerHTML = `
                    <td>
                        <div class="currency-cell">
                            <div class="currency-flag">${config.icon}</div>
                            <div class="currency-info">
                                <span class="currency-code">${code}</span>
                                <span class="currency-name">${config.name}</span>
                            </div>
                        </div>
                    </td>
                    <td class="fuel-price-cell">${ltp.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td class="change-cell ${changeClass}">${changeSign}${change.toFixed(2)}</td>
                    <td class="change-cell ${changeClass}">${changeSign}${changePercent.toFixed(2)}%</td>
                    <td class="state-name">${quote.ohlc?.high?.toLocaleString('en-IN') || '-'}</td>
                    <td class="state-name">${quote.ohlc?.low?.toLocaleString('en-IN') || '-'}</td>
                `;
                tbody.appendChild(row);
            }

            // Update timestamp
            updateMarketsStatus('Live data from Kite Connect', false);
            console.log('Market prices updated from Kite API');

            // Update quick stats
            const niftyQuote = data['NSE:NIFTY 50'];
            const bankNiftyQuote = data['NSE:NIFTY BANK'];
            updateQuickStats(niftyQuote, bankNiftyQuote);

            // Fetch Nifty 50 data for other tabs
            fetchNifty50Data();
        }

        // Update markets section status
        function updateMarketsStatus(message, isError) {
            const dateSpan = document.querySelector('#sectionMarkets .toolbar-title span');
            const noteSpan = document.querySelector('#sectionMarkets .section-note span');

            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            const marketStatus = isMarketOpen() ? ' Market Open' : ' Market Closed';

            if (dateSpan) {
                dateSpan.textContent = `${now.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}  ${timeStr}`;
            }

            if (noteSpan) {
                if (isError) {
                    noteSpan.innerHTML = `<span style="color: var(--danger);"> ${message}</span>  ${marketStatus}. <a href="https://developers.kite.trade/" target="_blank">Get API access</a>`;
                } else {
                    noteSpan.innerHTML = `${message}  ${marketStatus}  Auto-refresh ${isMarketOpen() ? 'ON' : 'OFF'}. <a href="https://kite.zerodha.com" target="_blank">Zerodha Kite</a>`;
                }
            }
        }

        // ========== WebSocket Client for Real-time Market Data ==========
        let marketWs = null;
        let marketWsReconnectTimer = null;
        let marketPrices = {}; // Store latest prices by token

        // Token to index mapping
        const TOKEN_TO_INDEX = {
            256265: 'NIFTY 50',
            260105: 'BANK NIFTY',
            259849: 'NIFTY IT',
            260361: 'NIFTY REALTY'
        };

        function connectMarketWebSocket() {
            const proxyUrl = getProxyUrl();
            if (!proxyUrl) {
                console.log('No proxy URL configured, skipping WebSocket');
                return;
            }

            // Convert http:// to ws://
            const wsUrl = proxyUrl.replace('http://', 'ws://').replace('https://', 'wss://');

            console.log('Connecting to market WebSocket:', wsUrl);

            try {
                marketWs = new WebSocket(wsUrl);

                marketWs.onopen = () => {
                    console.log('Market WebSocket connected');
                    updateMarketsStatus('Real-time streaming connected', false);
                };

                marketWs.onmessage = (event) => {
                    try {
                        const message = JSON.parse(event.data);

                        if (message.type === 'status') {
                            if (message.kiteConnected) {
                                updateMarketsStatus('Live streaming from Kite', false);
                            } else {
                                updateMarketsStatus('Waiting for Kite connection...', false);
                            }
                        } else if (message.type === 'tick') {
                            // Update prices from tick data
                            message.data.forEach(tick => {
                                marketPrices[tick.token] = tick;
                                updateMarketRow(tick);
                            });
                        }
                    } catch (e) {
                        console.error('Error parsing WebSocket message:', e);
                    }
                };

                marketWs.onclose = () => {
                    console.log('Market WebSocket disconnected');
                    updateMarketsStatus('Streaming disconnected', true);

                    // Reconnect after 5 seconds
                    if (marketWsReconnectTimer) clearTimeout(marketWsReconnectTimer);
                    marketWsReconnectTimer = setTimeout(connectMarketWebSocket, 5000);
                };

                marketWs.onerror = (err) => {
                    console.error('Market WebSocket error:', err);
                };
            } catch (e) {
                console.error('Failed to create WebSocket:', e);
            }
        }

        // Update a single market row with tick data
        function updateMarketRow(tick) {
            const indexCode = TOKEN_TO_INDEX[tick.token];
            if (!indexCode) return;

            const config = MARKET_INDICES[indexCode];
            if (!config) return;

            const tbody = document.querySelector('#marketsTable tbody');
            if (!tbody) return;

            // Find existing row or create new one
            let row = tbody.querySelector(`tr[data-token="${tick.token}"]`);

            const change = tick.change || 0;
            const changePercent = tick.changePercent || 0;
            const changeClass = change >= 0 ? 'positive' : 'negative';
            const changeSign = change >= 0 ? '+' : '';

            if (!row) {
                row = document.createElement('tr');
                row.dataset.token = tick.token;
                tbody.appendChild(row);
            }

            row.className = `market-row ${changeClass}`;
            row.dataset.lastPrice = tick.ltp;

            row.innerHTML = `
                <td>
                    <div class="currency-cell">
                        <div class="currency-flag">${tick.icon || config.icon}</div>
                        <div class="currency-info">
                            <span class="currency-code">${indexCode}</span>
                            <span class="currency-name">${tick.name || config.name}</span>
                        </div>
                    </div>
                </td>
                <td class="fuel-price-cell">${tick.ltp?.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) || '-'}</td>
                <td class="change-cell ${changeClass}">${changeSign}${change.toFixed(2)}</td>
                <td class="change-cell ${changeClass}">${changeSign}${changePercent.toFixed(2)}%</td>
                <td class="state-name">${tick.high?.toLocaleString('en-IN', {minimumFractionDigits: 2}) || '-'}</td>
                <td class="state-name">${tick.low?.toLocaleString('en-IN', {minimumFractionDigits: 2}) || '-'}</td>
            `;
        }
        // ========== End WebSocket Client ==========

        // ========== Nifty 50 Stocks Data ==========
        const NIFTY_50_STOCKS = {
            'ADANIENT': { name: 'Adani Enterprises', sector: 'Diversified' },
            'ADANIPORTS': { name: 'Adani Ports & SEZ', sector: 'Infrastructure' },
            'APOLLOHOSP': { name: 'Apollo Hospitals', sector: 'Healthcare' },
            'ASIANPAINT': { name: 'Asian Paints', sector: 'Consumer' },
            'AXISBANK': { name: 'Axis Bank', sector: 'Banking' },
            'BAJAJ-AUTO': { name: 'Bajaj Auto', sector: 'Auto' },
            'BAJFINANCE': { name: 'Bajaj Finance', sector: 'Finance' },
            'BAJAJFINSV': { name: 'Bajaj Finserv', sector: 'Finance' },
            'BPCL': { name: 'Bharat Petroleum', sector: 'Oil & Gas' },
            'BHARTIARTL': { name: 'Bharti Airtel', sector: 'Telecom' },
            'BRITANNIA': { name: 'Britannia Industries', sector: 'FMCG' },
            'CIPLA': { name: 'Cipla', sector: 'Pharma' },
            'COALINDIA': { name: 'Coal India', sector: 'Mining' },
            'DIVISLAB': { name: 'Divi\'s Laboratories', sector: 'Pharma' },
            'DRREDDY': { name: 'Dr. Reddy\'s Labs', sector: 'Pharma' },
            'EICHERMOT': { name: 'Eicher Motors', sector: 'Auto' },
            'GRASIM': { name: 'Grasim Industries', sector: 'Cement' },
            'HCLTECH': { name: 'HCL Technologies', sector: 'IT' },
            'HDFCBANK': { name: 'HDFC Bank', sector: 'Banking' },
            'HDFCLIFE': { name: 'HDFC Life Insurance', sector: 'Insurance' },
            'HEROMOTOCO': { name: 'Hero MotoCorp', sector: 'Auto' },
            'HINDALCO': { name: 'Hindalco Industries', sector: 'Metals' },
            'HINDUNILVR': { name: 'Hindustan Unilever', sector: 'FMCG' },
            'ICICIBANK': { name: 'ICICI Bank', sector: 'Banking' },
            'ITC': { name: 'ITC', sector: 'FMCG' },
            'INDUSINDBK': { name: 'IndusInd Bank', sector: 'Banking' },
            'INFY': { name: 'Infosys', sector: 'IT' },
            'JSWSTEEL': { name: 'JSW Steel', sector: 'Metals' },
            'KOTAKBANK': { name: 'Kotak Mahindra Bank', sector: 'Banking' },
            'LT': { name: 'Larsen & Toubro', sector: 'Infrastructure' },
            'M&M': { name: 'Mahindra & Mahindra', sector: 'Auto' },
            'MARUTI': { name: 'Maruti Suzuki', sector: 'Auto' },
            'NESTLEIND': { name: 'Nestle India', sector: 'FMCG' },
            'NTPC': { name: 'NTPC', sector: 'Power' },
            'ONGC': { name: 'Oil & Natural Gas Corp', sector: 'Oil & Gas' },
            'POWERGRID': { name: 'Power Grid Corp', sector: 'Power' },
            'RELIANCE': { name: 'Reliance Industries', sector: 'Diversified' },
            'SBILIFE': { name: 'SBI Life Insurance', sector: 'Insurance' },
            'SBIN': { name: 'State Bank of India', sector: 'Banking' },
            'SUNPHARMA': { name: 'Sun Pharmaceutical', sector: 'Pharma' },
            'TCS': { name: 'Tata Consultancy', sector: 'IT' },
            'TATACONSUM': { name: 'Tata Consumer', sector: 'FMCG' },
            'TATAMOTORS': { name: 'Tata Motors', sector: 'Auto' },
            'TATASTEEL': { name: 'Tata Steel', sector: 'Metals' },
            'TECHM': { name: 'Tech Mahindra', sector: 'IT' },
            'TITAN': { name: 'Titan Company', sector: 'Consumer' },
            'ULTRACEMCO': { name: 'UltraTech Cement', sector: 'Cement' },
            'UPL': { name: 'UPL', sector: 'Chemicals' },
            'WIPRO': { name: 'Wipro', sector: 'IT' },
            'SHRIRAMFIN': { name: 'Shriram Finance', sector: 'Finance' }
        };

        // Sectoral Indices
        const SECTORAL_INDICES = {
            'NIFTY BANK': { symbol: 'NSE:NIFTY BANK', name: 'Banking', icon: '' },
            'NIFTY IT': { symbol: 'NSE:NIFTY IT', name: 'Information Technology', icon: '' },
            'NIFTY PHARMA': { symbol: 'NSE:NIFTY PHARMA', name: 'Pharmaceutical', icon: '' },
            'NIFTY AUTO': { symbol: 'NSE:NIFTY AUTO', name: 'Automobile', icon: '' },
            'NIFTY FMCG': { symbol: 'NSE:NIFTY FMCG', name: 'FMCG', icon: '' },
            'NIFTY METAL': { symbol: 'NSE:NIFTY METAL', name: 'Metals', icon: '' },
            'NIFTY REALTY': { symbol: 'NSE:NIFTY REALTY', name: 'Real Estate', icon: '' },
            'NIFTY ENERGY': { symbol: 'NSE:NIFTY ENERGY', name: 'Energy', icon: '' },
            'NIFTY INFRA': { symbol: 'NSE:NIFTY INFRA', name: 'Infrastructure', icon: '' },
            'NIFTY PSU BANK': { symbol: 'NSE:NIFTY PSU BANK', name: 'PSU Banks', icon: '' },
            'NIFTY FIN SERVICE': { symbol: 'NSE:NIFTY FIN SERVICE', name: 'Financial Services', icon: '' },
            'NIFTY MEDIA': { symbol: 'NSE:NIFTY MEDIA', name: 'Media', icon: '' }
        };

        // State for Nifty 50
        let nifty50Data = [];
        let nifty50SortColumn = 'changePercent';
        let nifty50SortDirection = 'desc';
        let watchlist = JSON.parse(localStorage.getItem('stockWatchlist') || '[]');

        // Tab switching
        function showMarketTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.market-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.market-tab-content').forEach(content => content.classList.remove('active'));
            const tabId = 'marketTab' + tabName.charAt(0).toUpperCase() + tabName.slice(1);
            document.getElementById(tabId).classList.add('active');

            // Fetch data for the tab if needed
            if (tabName === 'nifty50' || tabName === 'gainers' || tabName === 'losers') {
                fetchNifty50Data();
            } else if (tabName === 'sectors') {
                fetchSectoralData();
            } else if (tabName === 'watchlist') {
                updateWatchlistTable();
            }
        }

        // Fetch Nifty 50 stocks data
        async function fetchNifty50Data() {
            if (!isKiteApiEnabled()) {
                console.log('Kite API not configured');
                return;
            }

            try {
                const symbols = Object.keys(NIFTY_50_STOCKS).map(s => `NSE:${s}`).join('&i=');
                const proxyUrl = getProxyUrl();
                const url = `${proxyUrl}/api/quote?i=${symbols}`;

                const response = await fetch(url, {
                    headers: {
                        'X-Kite-Version': '3',
                        'Authorization': `token ${getKiteApiKey()}:${getKiteAccessToken()}`
                    }
                });

                if (!response.ok) throw new Error('API error');

                const result = await response.json();
                const data = result.data;

                console.log('Nifty 50 API Response sample:', Object.entries(data).slice(0, 2));

                // Process data
                nifty50Data = [];
                let advances = 0, declines = 0;

                for (const [symbol, info] of Object.entries(NIFTY_50_STOCKS)) {
                    const quote = data[`NSE:${symbol}`];
                    if (quote) {
                        const ltp = quote.last_price || 0;
                        const open = quote.ohlc?.open || ltp;
                        const close = quote.ohlc?.close || ltp;
                        const high = quote.ohlc?.high || ltp;
                        const low = quote.ohlc?.low || ltp;

                        // For stocks, calculate change from previous close (OHLC close)
                        // Note: net_change often returns 0 for individual stocks, so always calculate from OHLC
                        let change, changePercent;

                        // Use OHLC close (previous day close) to calculate change
                        if (close && close !== ltp) {
                            change = ltp - close;
                            changePercent = close !== 0 ? ((change / close) * 100) : 0;
                        } else if (quote.net_change && quote.net_change !== 0) {
                            // Only use net_change if it's non-zero
                            change = quote.net_change;
                            changePercent = close !== 0 ? ((change / close) * 100) : 0;
                        } else {
                            // Fallback: use open price for intraday change
                            change = ltp - open;
                            changePercent = open !== 0 ? ((change / open) * 100) : 0;
                        }

                        if (change >= 0) advances++;
                        else declines++;

                        nifty50Data.push({
                            symbol,
                            name: info.name,
                            sector: info.sector,
                            ltp,
                            open,
                            close,
                            high,
                            low,
                            change,
                            changePercent,
                            volume: quote.volume || 0
                        });
                    }
                }

                console.log('Processed Nifty 50 data sample:', nifty50Data.slice(0, 3));

                // Update market breadth
                updateMarketBreadth(advances, declines);

                // Sort and render
                sortNifty50Data();
                renderNifty50Table();
                renderGainersLosers();
                updateWatchlistTable();

            } catch (error) {
                console.error('Error fetching Nifty 50 data:', error);
            }
        }

        // Fetch sectoral indices data
        async function fetchSectoralData() {
            if (!isKiteApiEnabled()) return;

            try {
                const symbols = Object.values(SECTORAL_INDICES).map(s => s.symbol).join('&i=');
                const proxyUrl = getProxyUrl();
                const url = `${proxyUrl}/api/quote?i=${symbols}`;

                const response = await fetch(url, {
                    headers: {
                        'X-Kite-Version': '3',
                        'Authorization': `token ${getKiteApiKey()}:${getKiteAccessToken()}`
                    }
                });

                if (!response.ok) throw new Error('API error');

                const result = await response.json();
                renderSectorsGrid(result.data);

            } catch (error) {
                console.error('Error fetching sectoral data:', error);
            }
        }

        // Update market breadth display
        function updateMarketBreadth(advances, declines) {
            const total = advances + declines;
            const advancesPct = total > 0 ? (advances / total * 100) : 50;
            const declinesPct = total > 0 ? (declines / total * 100) : 50;

            document.getElementById('breadthAdvances').style.width = advancesPct + '%';
            document.getElementById('breadthDeclines').style.width = declinesPct + '%';
            document.getElementById('advancesCount').textContent = advances;
            document.getElementById('declinesCount').textContent = declines;
        }

        // Sector to stocks mapping
        const SECTOR_STOCKS = {
            'NIFTY BANK': ['HDFCBANK', 'ICICIBANK', 'KOTAKBANK', 'AXISBANK', 'SBIN', 'INDUSINDBK'],
            'NIFTY IT': ['TCS', 'INFY', 'HCLTECH', 'WIPRO', 'TECHM'],
            'NIFTY PHARMA': ['SUNPHARMA', 'DRREDDY', 'CIPLA', 'DIVISLAB', 'APOLLOHOSP'],
            'NIFTY AUTO': ['TATAMOTORS', 'M&M', 'MARUTI', 'BAJAJ-AUTO', 'EICHERMOT', 'HEROMOTOCO'],
            'NIFTY FMCG': ['HINDUNILVR', 'ITC', 'NESTLEIND', 'BRITANNIA', 'TATACONSUM'],
            'NIFTY METAL': ['TATASTEEL', 'JSWSTEEL', 'HINDALCO', 'COALINDIA'],
            'NIFTY REALTY': ['ADANIENT', 'ADANIPORTS'],
            'NIFTY ENERGY': ['RELIANCE', 'ONGC', 'BPCL', 'NTPC', 'POWERGRID'],
            'NIFTY INFRA': ['LT', 'ADANIPORTS', 'NTPC', 'POWERGRID'],
            'NIFTY PSU BANK': ['SBIN'],
            'NIFTY FIN SERVICE': ['HDFCBANK', 'ICICIBANK', 'BAJFINANCE', 'BAJAJFINSV', 'SBILIFE', 'HDFCLIFE', 'SHRIRAMFIN'],
            'NIFTY MEDIA': []
        };

        // Render sectors list (row-wise)
        function renderSectorsGrid(data) {
            const list = document.getElementById('sectorsList');
            if (!list) return;

            let html = '';
            const sectors = [];

            for (const [code, config] of Object.entries(SECTORAL_INDICES)) {
                const quote = data[config.symbol];
                if (quote) {
                    const ltp = quote.last_price || 0;
                    const close = quote.ohlc?.close || ltp;
                    // Calculate change from OHLC close, use net_change only if non-zero
                    let change;
                    if (close && close !== ltp) {
                        change = ltp - close;
                    } else if (quote.net_change && quote.net_change !== 0) {
                        change = quote.net_change;
                    } else {
                        change = ltp - (quote.ohlc?.open || ltp);
                    }
                    const changePercent = close !== 0 ? ((change / close) * 100) : 0;
                    sectors.push({ code, config, ltp, change, changePercent });
                }
            }

            // Sort by change percent
            sectors.sort((a, b) => b.changePercent - a.changePercent);

            // Find max change for bar scaling
            const maxChange = Math.max(...sectors.map(s => Math.abs(s.changePercent)), 1);

            sectors.forEach((sector, index) => {
                const changeClass = sector.changePercent >= 0 ? 'positive' : 'negative';
                const changeSign = sector.changePercent >= 0 ? '+' : '';
                const barWidth = (Math.abs(sector.changePercent) / maxChange * 100);
                const sectorStocks = SECTOR_STOCKS[sector.code] || [];

                // Get stocks data for this sector
                let stocksHtml = '';
                sectorStocks.forEach(symbol => {
                    const stock = nifty50Data.find(s => s.symbol === symbol);
                    if (stock) {
                        const change = stock.change || 0;
                        const changePercent = stock.changePercent || 0;
                        const stockChangeClass = changePercent >= 0 ? 'positive' : 'negative';
                        const stockSign = changePercent >= 0 ? '+' : '';
                        stocksHtml += `
                            <div class="sector-stock-row ${stockChangeClass}">
                                <span class="sector-stock-symbol">${symbol}</span>
                                <span class="sector-stock-name">${stock.name}</span>
                                <span class="sector-stock-ltp">${(stock.ltp || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</span>
                                <span class="sector-stock-change ${stockChangeClass}">${stockSign}${change.toFixed(2)}</span>
                                <span class="sector-stock-pct ${stockChangeClass}">${stockSign}${changePercent.toFixed(2)}%</span>
                            </div>
                        `;
                    }
                });

                html += `
                    <div class="sector-row ${changeClass}" id="sector-${index}">
                        <div class="sector-header" onclick="toggleSector(${index})">
                            <span class="sector-icon">${sector.config.icon}</span>
                            <div class="sector-info">
                                <div class="sector-name">${sector.code}</div>
                                <div class="sector-full-name">${sector.config.name}</div>
                            </div>
                            <div class="sector-value">${sector.ltp.toLocaleString('en-IN', {minimumFractionDigits: 2})}</div>
                            <div class="sector-change-container">
                                <div class="sector-change ${changeClass}">${changeSign}${sector.changePercent.toFixed(2)}%</div>
                                <div class="sector-bar-container">
                                    <div class="sector-bar ${changeClass}" style="width: ${barWidth}%"></div>
                                </div>
                            </div>
                            <svg class="sector-toggle" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </div>
                        ${sectorStocks.length > 0 ? `
                        <div class="sector-stocks">
                            <div class="sector-stocks-list">
                                ${stocksHtml || '<div style="color: var(--gray-400); padding: 12px;">Loading stocks...</div>'}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            });

            list.innerHTML = html;
        }

        // Toggle sector expansion
        function toggleSector(index) {
            const row = document.getElementById(`sector-${index}`);
            if (row) {
                row.classList.toggle('expanded');
            }
        }

        // Sort Nifty 50 data
        function sortNifty50(column) {
            if (nifty50SortColumn === column) {
                nifty50SortDirection = nifty50SortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                nifty50SortColumn = column;
                nifty50SortDirection = 'desc';
            }
            sortNifty50Data();
            renderNifty50Table();
        }

        function sortNifty50Data() {
            nifty50Data.sort((a, b) => {
                let aVal = a[nifty50SortColumn];
                let bVal = b[nifty50SortColumn];
                if (typeof aVal === 'string') {
                    return nifty50SortDirection === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                }
                return nifty50SortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            });
        }

        // Filter Nifty 50 stocks
        function filterNifty50Stocks() {
            const query = document.getElementById('nifty50Search').value.toLowerCase();
            const rows = document.querySelectorAll('#nifty50Table tbody tr');
            rows.forEach(row => {
                const symbol = row.dataset.symbol?.toLowerCase() || '';
                const name = row.querySelector('.currency-name')?.textContent.toLowerCase() || '';
                row.style.display = (symbol.includes(query) || name.includes(query)) ? '' : 'none';
            });
        }

        // Render Nifty 50 table
        function renderNifty50Table() {
            const tbody = document.querySelector('#nifty50Table tbody');
            if (!tbody) return;

            if (nifty50Data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: var(--gray-400);">Loading Nifty 50 stocks...</td></tr>';
                return;
            }

            let html = '';
            nifty50Data.forEach(stock => {
                const change = stock.change || 0;
                const changePercent = stock.changePercent || 0;
                const changeClass = change >= 0 ? 'positive' : 'negative';
                const changeSign = change >= 0 ? '+' : '';
                const inWatchlist = watchlist.includes(stock.symbol);

                html += `
                    <tr class="market-row ${changeClass}" data-symbol="${stock.symbol}">
                        <td>
                            <div class="currency-cell">
                                <div class="currency-info">
                                    <span class="currency-code">${stock.symbol}</span>
                                    <span class="currency-name">${stock.name}</span>
                                </div>
                            </div>
                        </td>
                        <td class="fuel-price-cell">${(stock.ltp || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${change.toFixed(2)}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${changePercent.toFixed(2)}%</td>
                        <td class="volume-cell">${formatVolume(stock.volume || 0)}</td>
                        <td>
                            <button class="action-btn ${inWatchlist ? 'in-watchlist' : 'add'}" onclick="toggleWatchlist('${stock.symbol}')">
                                ${inWatchlist ? ' Added' : '+ Add'}
                            </button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Render gainers and losers
        function renderGainersLosers() {
            const sorted = [...nifty50Data].sort((a, b) => b.changePercent - a.changePercent);
            const gainers = sorted.slice(0, 10);
            const losers = sorted.slice(-10).reverse();

            renderStockTable('gainersTable', gainers);
            renderStockTable('losersTable', losers);
        }

        function renderStockTable(tableId, stocks) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            if (!tbody) return;

            if (stocks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--gray-400);">Loading data...</td></tr>';
                return;
            }

            let html = '';
            stocks.forEach(stock => {
                const change = stock.change || 0;
                const changePercent = stock.changePercent || 0;
                const changeClass = change >= 0 ? 'positive' : 'negative';
                const changeSign = change >= 0 ? '+' : '';

                html += `
                    <tr class="market-row ${changeClass}">
                        <td>
                            <div class="currency-cell">
                                <div class="currency-info">
                                    <span class="currency-code">${stock.symbol}</span>
                                    <span class="currency-name">${stock.name}</span>
                                </div>
                            </div>
                        </td>
                        <td class="fuel-price-cell">${(stock.ltp || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${change.toFixed(2)}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${changePercent.toFixed(2)}%</td>
                        <td class="volume-cell">${formatVolume(stock.volume || 0)}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Format volume
        function formatVolume(vol) {
            if (vol >= 10000000) return (vol / 10000000).toFixed(2) + ' Cr';
            if (vol >= 100000) return (vol / 100000).toFixed(2) + ' L';
            if (vol >= 1000) return (vol / 1000).toFixed(2) + ' K';
            return vol.toString();
        }

        // Watchlist functions
        function toggleWatchlist(symbol) {
            const index = watchlist.indexOf(symbol);
            if (index > -1) {
                watchlist.splice(index, 1);
            } else {
                watchlist.push(symbol);
            }
            localStorage.setItem('stockWatchlist', JSON.stringify(watchlist));
            renderNifty50Table();
            updateWatchlistTable();
        }

        function clearWatchlist() {
            if (confirm('Remove all stocks from watchlist?')) {
                watchlist = [];
                localStorage.setItem('stockWatchlist', JSON.stringify(watchlist));
                renderNifty50Table();
                updateWatchlistTable();
            }
        }

        function updateWatchlistTable() {
            const tbody = document.querySelector('#watchlistTable tbody');
            const countSpan = document.getElementById('watchlistCount');
            if (!tbody) return;

            countSpan.textContent = `${watchlist.length} stocks`;

            if (watchlist.length === 0) {
                tbody.innerHTML = `
                    <tr class="empty-watchlist">
                        <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-400);">
                            No stocks in watchlist. Add stocks from Nifty 50 tab.
                        </td>
                    </tr>
                `;
                return;
            }

            const watchlistStocks = nifty50Data.filter(s => watchlist.includes(s.symbol));
            let html = '';

            watchlistStocks.forEach(stock => {
                const change = stock.change || 0;
                const changePercent = stock.changePercent || 0;
                const changeClass = change >= 0 ? 'positive' : 'negative';
                const changeSign = change >= 0 ? '+' : '';

                html += `
                    <tr class="market-row ${changeClass}">
                        <td>
                            <div class="currency-cell">
                                <div class="currency-info">
                                    <span class="currency-code">${stock.symbol}</span>
                                    <span class="currency-name">${stock.name}</span>
                                </div>
                            </div>
                        </td>
                        <td class="fuel-price-cell">${(stock.ltp || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${change.toFixed(2)}</td>
                        <td class="change-cell ${changeClass}">${changeSign}${changePercent.toFixed(2)}%</td>
                        <td class="volume-cell">${formatVolume(stock.volume || 0)}</td>
                        <td>
                            <button class="action-btn remove" onclick="toggleWatchlist('${stock.symbol}')">Remove</button>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html || `
                <tr class="empty-watchlist">
                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--gray-400);">
                        Loading watchlist data...
                    </td>
                </tr>
            `;
        }

        // Update quick stats in overview
        function updateQuickStats(niftyData, bankNiftyData) {
            if (niftyData) {
                const ltp = niftyData.last_price || 0;
                const close = niftyData.ohlc?.close || ltp;
                const niftyChange = (close && close !== ltp) ? (ltp - close) : (niftyData.net_change || 0);
                const niftyChangeClass = niftyChange >= 0 ? 'positive' : 'negative';
                document.getElementById('niftyQuickValue').textContent = ltp?.toLocaleString('en-IN', {minimumFractionDigits: 2}) || '--';
                const niftyChangeEl = document.getElementById('niftyQuickChange');
                niftyChangeEl.textContent = `${niftyChange >= 0 ? '+' : ''}${niftyChange.toFixed(2)}`;
                niftyChangeEl.className = 'stat-change ' + niftyChangeClass;
            }
            if (bankNiftyData) {
                const ltp = bankNiftyData.last_price || 0;
                const close = bankNiftyData.ohlc?.close || ltp;
                const bankChange = (close && close !== ltp) ? (ltp - close) : (bankNiftyData.net_change || 0);
                const bankChangeClass = bankChange >= 0 ? 'positive' : 'negative';
                document.getElementById('bankNiftyQuickValue').textContent = ltp?.toLocaleString('en-IN', {minimumFractionDigits: 2}) || '--';
                const bankChangeEl = document.getElementById('bankNiftyQuickChange');
                bankChangeEl.textContent = `${bankChange >= 0 ? '+' : ''}${bankChange.toFixed(2)}`;
                bankChangeEl.className = 'stat-change ' + bankChangeClass;
            }
        }
        // ========== End Market Features ==========

        // Refresh market data (all tabs)
        async function refreshMarketData() {
            if (isKiteApiEnabled()) {
                await updateMarketPricesFromAPI();
                // Also refresh sectors tab
                fetchSectoralData();
            }
        }

        // Check if market is open (9 AM to 5 PM IST, Monday to Friday)
        function isMarketOpen() {
            const now = new Date();
            const hours = now.getHours();
            const day = now.getDay(); // 0 = Sunday, 6 = Saturday

            // Market closed on weekends
            if (day === 0 || day === 6) return false;

            // Market open 9 AM to 5 PM
            return hours >= 9 && hours < 17;
        }

        // Auto-refresh market data every 5 seconds during market hours
        let marketRefreshInterval = null;

        function startMarketAutoRefresh() {
            // Clear any existing interval
            if (marketRefreshInterval) {
                clearInterval(marketRefreshInterval);
            }

            // Check every 5 seconds
            marketRefreshInterval = setInterval(() => {
                if (isMarketOpen() && isKiteApiEnabled()) {
                    updateMarketPricesFromAPI();
                }
            }, 5000);

            // Also do an immediate check
            if (isMarketOpen() && isKiteApiEnabled()) {
                updateMarketPricesFromAPI();
            }
        }

        // Currency data
        const CURRENCIES = {
            'USD': { name: 'US Dollar', flag: '' },
            'EUR': { name: 'Euro', flag: '' },
            'GBP': { name: 'British Pound', flag: '' },
            'JPY': { name: 'Japanese Yen', flag: '' },
            'AUD': { name: 'Australian Dollar', flag: '' },
            'CAD': { name: 'Canadian Dollar', flag: '' },
            'CHF': { name: 'Swiss Franc', flag: '' },
            'CNY': { name: 'Chinese Yuan', flag: '' },
            'HKD': { name: 'Hong Kong Dollar', flag: '' },
            'SGD': { name: 'Singapore Dollar', flag: '' },
            'SEK': { name: 'Swedish Krona', flag: '' },
            'KRW': { name: 'South Korean Won', flag: '' },
            'NOK': { name: 'Norwegian Krone', flag: '' },
            'NZD': { name: 'New Zealand Dollar', flag: '' },
            'MXN': { name: 'Mexican Peso', flag: '' },
            'ZAR': { name: 'South African Rand', flag: '' },
            'THB': { name: 'Thai Baht', flag: '' },
            'TRY': { name: 'Turkish Lira', flag: '' },
            'PLN': { name: 'Polish Zloty', flag: '' },
            'DKK': { name: 'Danish Krone', flag: '' }
        };

        const TOP_20_CURRENCIES = Object.keys(CURRENCIES);

        const PERIODS = [
            { label: '1D', days: 1, key: 'd1' },
            { label: '5D', days: 5, key: 'd5' },
            { label: '10D', days: 10, key: 'd10' },
            { label: '1M', days: 30, key: 'm1' },
            { label: '6M', days: 180, key: 'm6' },
            { label: '1Y', days: 365, key: 'y1' },
            { label: '5Y', days: 1825, key: 'y5' }
        ];

        const API_BASE = 'https://api.frankfurter.app';

        // State
        let tableData = [];
        let sortColumn = 'code';
        let sortDirection = 'asc';
        let searchQuery = '';
        let displayMode = 'percent'; // 'percent' or 'absolute'
        let conversionAmount = 0; // INR amount to convert
        let countdownInterval;
        let refreshInterval;
        let secondsRemaining = 300; // 5 minutes

        // Animated text cycling
        const animatedWords = ['Currency', 'Crypto', 'Gold', 'Fuel', 'Market', 'Banking', 'RBI', 'Bond'];
        let currentWordIndex = 0;

        function cycleAnimatedText() {
            const textElement = document.getElementById('animatedText');
            if (!textElement) return;

            // Fade out
            textElement.classList.remove('text-fade-in');
            textElement.classList.add('text-fade-out');

            setTimeout(() => {
                // Change text
                currentWordIndex = (currentWordIndex + 1) % animatedWords.length;
                textElement.textContent = animatedWords[currentWordIndex];

                // Fade in
                textElement.classList.remove('text-fade-out');
                textElement.classList.add('text-fade-in');
            }, 400);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchAllRates();
            startAutoRefresh();
            setupSearch();
            setupClickOutside();

            // Start text animation (cycle every 2.5 seconds)
            setInterval(cycleAnimatedText, 2500);

            // Update settings button appearance on load
            updateSettingsBadges();

            // Fetch metal prices from API if configured
            if (isMetalsApiEnabled()) {
                updateMetalPricesFromAPI();
                // Update metals every 8 hours (3x per day = ~90 requests/month)
                setInterval(updateMetalPricesFromAPI, 8 * 60 * 60 * 1000);
            }

            // Fetch market data from Kite Connect if configured
            // Auto-refresh every 5 seconds during market hours (9 AM - 5 PM)
            if (isKiteApiEnabled()) {
                // Fetch immediately on load (Markets is now default tab)
                updateMarketPricesFromAPI();
                startMarketAutoRefresh();
            }

            // Connect to market WebSocket for real-time streaming
            if (getProxyUrl()) {
                connectMarketWebSocket();
            }
        });

        // Auto refresh
        function startAutoRefresh() {
            secondsRemaining = 300;
            updateCountdown();

            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                secondsRemaining--;
                updateCountdown();
                if (secondsRemaining <= 0) {
                    fetchAllRates();
                    secondsRemaining = 300;
                }
            }, 1000);
        }

        function updateCountdown() {
            const mins = Math.floor(secondsRemaining / 60);
            const secs = secondsRemaining % 60;
            document.getElementById('countdown').textContent =
                `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function manualRefresh() {
            fetchAllRates();
            secondsRemaining = 300;
        }

        // Search
        function setupSearch() {
            const input = document.getElementById('searchInput');
            const clearBtn = document.getElementById('searchClear');

            input.addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                clearBtn.classList.toggle('visible', searchQuery.length > 0);
                renderTable();
            });
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('visible');
            searchQuery = '';
            renderTable();
        }

        // Display mode toggle
        function setDisplayMode(mode) {
            displayMode = mode;
            document.getElementById('togglePercent').classList.toggle('active', mode === 'percent');
            document.getElementById('toggleAbsolute').classList.toggle('active', mode === 'absolute');
            renderTable();
        }

        // Currency conversion
        function updateConversion() {
            const input = document.getElementById('converterInput');
            conversionAmount = parseFloat(input.value) || 0;
            renderTable();
        }

        // Section switching
        function showSection(section) {
            // Hide all sections
            document.getElementById('sectionCurrency').style.display = 'none';
            document.getElementById('sectionMetals').style.display = 'none';
            document.getElementById('sectionFuel').style.display = 'none';
            document.getElementById('sectionBanking').style.display = 'none';
            document.getElementById('sectionMarkets').style.display = 'none';
            document.getElementById('sectionCrypto').style.display = 'none';
            document.getElementById('sectionEconomy').style.display = 'none';

            // Remove active from all tabs
            document.getElementById('tabCurrency').classList.remove('active');
            document.getElementById('tabMetals').classList.remove('active');
            document.getElementById('tabFuel').classList.remove('active');
            document.getElementById('tabBanking').classList.remove('active');
            document.getElementById('tabMarkets').classList.remove('active');
            document.getElementById('tabCrypto').classList.remove('active');
            document.getElementById('tabEconomy').classList.remove('active');

            // Show selected section and activate tab
            if (section === 'currency') {
                document.getElementById('sectionCurrency').style.display = 'block';
                document.getElementById('tabCurrency').classList.add('active');
            } else if (section === 'metals') {
                document.getElementById('sectionMetals').style.display = 'block';
                document.getElementById('tabMetals').classList.add('active');
            } else if (section === 'fuel') {
                document.getElementById('sectionFuel').style.display = 'block';
                document.getElementById('tabFuel').classList.add('active');
            } else if (section === 'banking') {
                document.getElementById('sectionBanking').style.display = 'block';
                document.getElementById('tabBanking').classList.add('active');
            } else if (section === 'markets') {
                document.getElementById('sectionMarkets').style.display = 'block';
                document.getElementById('tabMarkets').classList.add('active');
            } else if (section === 'crypto') {
                document.getElementById('sectionCrypto').style.display = 'block';
                document.getElementById('tabCrypto').classList.add('active');
            } else if (section === 'economy') {
                document.getElementById('sectionEconomy').style.display = 'block';
                document.getElementById('tabEconomy').classList.add('active');
            }
        }

        // Share functionality
        function toggleShareDropdown() {
            const dropdown = document.getElementById('shareDropdown');
            dropdown.classList.toggle('open');
        }

        function setupClickOutside() {
            document.addEventListener('click', (e) => {
                // Close all share dropdowns when clicking outside
                const allContainers = document.querySelectorAll('.share-container');
                let clickedInside = false;
                allContainers.forEach(container => {
                    if (container.contains(e.target)) {
                        clickedInside = true;
                    }
                });
                if (!clickedInside) {
                    document.querySelectorAll('.share-dropdown').forEach(d => d.classList.remove('open'));
                }
            });
        }

        function getShareText() {
            return 'Check out live currency exchange rates vs INR with historical changes!';
        }

        function getShareUrl() {
            return window.location.href;
        }

        function shareTwitter(e) {
            e.preventDefault();
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(getShareText())}&url=${encodeURIComponent(getShareUrl())}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function shareFacebook(e) {
            e.preventDefault();
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(getShareUrl())}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function shareLinkedIn(e) {
            e.preventDefault();
            const url = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(getShareUrl())}`;
            window.open(url, '_blank', 'width=550,height=420');
        }

        function shareWhatsApp(e) {
            e.preventDefault();
            const url = `https://wa.me/?text=${encodeURIComponent(getShareText() + ' ' + getShareUrl())}`;
            window.open(url, '_blank');
        }

        function shareTelegram(e) {
            e.preventDefault();
            const url = `https://t.me/share/url?url=${encodeURIComponent(getShareUrl())}&text=${encodeURIComponent(getShareText())}`;
            window.open(url, '_blank');
        }

        function copyLink() {
            navigator.clipboard.writeText(getShareUrl()).then(() => {
                const toast = document.getElementById('copiedToast');
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 2000);
            });
            // Close all share dropdowns
            document.querySelectorAll('.share-dropdown').forEach(d => d.classList.remove('open'));
        }

        // Markets share toggle
        function toggleMarketsShare() {
            const dropdown = document.getElementById('marketsShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Crypto share toggle
        function toggleCryptoShare() {
            const dropdown = document.getElementById('cryptoShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Economy share toggle
        function toggleEconomyShare() {
            const dropdown = document.getElementById('economyShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Crypto search filter
        function filterCrypto() {
            const input = document.getElementById('cryptoSearchInput');
            const filter = input.value.toLowerCase();
            const rows = document.querySelectorAll('#cryptoTableBody tr');
            const clearBtn = document.getElementById('cryptoClearBtn');

            clearBtn.style.display = filter ? 'block' : 'none';

            rows.forEach(row => {
                const coin = row.getAttribute('data-coin') || '';
                const text = row.textContent.toLowerCase();
                if (coin.includes(filter) || text.includes(filter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function clearCryptoSearch() {
            const input = document.getElementById('cryptoSearchInput');
            input.value = '';
            filterCrypto();
            input.focus();
        }

        // Economy tab switching
        function setEconomyTab(tab) {
            // Hide all economy sub-tables
            document.getElementById('rbiRatesTable').style.display = 'none';
            document.getElementById('inflationTable').style.display = 'none';
            document.getElementById('savingsTable').style.display = 'none';

            // Remove active from all toggle buttons
            document.getElementById('toggleRBI').classList.remove('active');
            document.getElementById('toggleInflation').classList.remove('active');
            document.getElementById('toggleSavings').classList.remove('active');

            // Show selected tab
            if (tab === 'rbi') {
                document.getElementById('rbiRatesTable').style.display = 'block';
                document.getElementById('toggleRBI').classList.add('active');
            } else if (tab === 'inflation') {
                document.getElementById('inflationTable').style.display = 'block';
                document.getElementById('toggleInflation').classList.add('active');
            } else if (tab === 'savings') {
                document.getElementById('savingsTable').style.display = 'block';
                document.getElementById('toggleSavings').classList.add('active');
            }
        }

        // Date helpers
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function getDateDaysAgo(days) {
            const date = new Date();
            date.setDate(date.getDate() - days);
            return formatDate(date);
        }

        // API
        async function fetchRatesForDate(date) {
            try {
                const response = await fetch(`${API_BASE}/${date}?from=EUR`);
                if (!response.ok) throw new Error('API error');
                const data = await response.json();
                return data.rates;
            } catch (error) {
                console.error(`Error fetching rates for ${date}:`, error);
                return null;
            }
        }

        function calculateINRRate(rates, currency) {
            if (!rates || !rates.INR) return null;
            if (currency === 'EUR') return rates.INR;
            if (!rates[currency]) return null;
            return rates.INR / rates[currency];
        }

        function calculateChange(currentRate, pastRate) {
            if (!currentRate || !pastRate) return { percent: null, absolute: null };
            return {
                percent: ((currentRate - pastRate) / pastRate) * 100,
                absolute: currentRate - pastRate
            };
        }

        // Sorting
        function sortData(data) {
            return [...data].sort((a, b) => {
                let aVal, bVal;

                if (sortColumn === 'code') {
                    aVal = a.code;
                    bVal = b.code;
                } else if (sortColumn === 'rate') {
                    aVal = a.rate || 0;
                    bVal = b.rate || 0;
                } else {
                    const idx = PERIODS.findIndex(p => p.key === sortColumn);
                    const changeA = a.changes[idx];
                    const changeB = b.changes[idx];
                    aVal = changeA ? changeA[displayMode] || 0 : 0;
                    bVal = changeB ? changeB[displayMode] || 0 : 0;
                }

                if (typeof aVal === 'string') {
                    return sortDirection === 'asc'
                        ? aVal.localeCompare(bVal)
                        : bVal.localeCompare(aVal);
                }
                return sortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            });
        }

        function handleSort(column) {
            if (sortColumn === column) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortDirection = column === 'code' ? 'asc' : 'desc';
            }
            renderTable();
        }

        // Fetch all rates
        async function fetchAllRates() {
            const refreshBtn = document.getElementById('refreshBtn');
            const content = document.getElementById('content');

            refreshBtn.classList.add('loading');
            refreshBtn.disabled = true;

            try {
                const dates = ['latest', ...PERIODS.map(p => getDateDaysAgo(p.days))];
                const allRates = await Promise.all(dates.map(d => fetchRatesForDate(d)));
                const [currentRates, ...historicalRates] = allRates;

                if (!currentRates) throw new Error('Failed to fetch current rates');

                tableData = TOP_20_CURRENCIES.map(currency => {
                    const currentINR = calculateINRRate(currentRates, currency);
                    const changes = historicalRates.map(rates => {
                        const pastINR = calculateINRRate(rates, currency);
                        return calculateChange(currentINR, pastINR);
                    });

                    return {
                        code: currency,
                        name: CURRENCIES[currency]?.name || currency,
                        flag: CURRENCIES[currency]?.flag || '',
                        rate: currentINR,
                        changes
                    };
                });

                renderTable();
                document.getElementById('lastUpdated').textContent =
                    `Updated: ${new Date().toLocaleTimeString()}`;

            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = `
                    <div class="error-container">
                        <div class="error-icon">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                        </div>
                        <h3>Failed to load rates</h3>
                        <p>There was an error fetching exchange rates. Please try again.</p>
                        <button class="refresh-btn" onclick="fetchAllRates()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M23 4v6h-6M1 20v-6h6"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                            Try Again
                        </button>
                    </div>
                `;
            } finally {
                refreshBtn.classList.remove('loading');
                refreshBtn.disabled = false;
            }
        }

        // Metals functions
        let metalsSortColumn = 'name';
        let metalsSortDirection = 'asc';

        function filterMetals() {
            const query = document.getElementById('metalsSearchInput').value.toLowerCase();
            const clearBtn = document.getElementById('metalsClearBtn');
            clearBtn.classList.toggle('visible', query.length > 0);

            const rows = document.querySelectorAll('#metalsTableBody tr');
            rows.forEach(row => {
                const name = row.getAttribute('data-name') || '';
                row.style.display = name.includes(query) ? '' : 'none';
            });
        }

        function clearMetalsSearch() {
            document.getElementById('metalsSearchInput').value = '';
            document.getElementById('metalsClearBtn').classList.remove('visible');
            filterMetals();
        }

        function sortMetals(column) {
            const tbody = document.getElementById('metalsTableBody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            if (metalsSortColumn === column) {
                metalsSortDirection = metalsSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                metalsSortColumn = column;
                metalsSortDirection = column === 'name' ? 'asc' : 'desc';
            }

            rows.sort((a, b) => {
                let aVal, bVal;
                if (column === 'name') {
                    aVal = a.getAttribute('data-name') || '';
                    bVal = b.getAttribute('data-name') || '';
                } else if (column === 'price') {
                    aVal = parseFloat(a.getAttribute('data-price')) || 0;
                    bVal = parseFloat(b.getAttribute('data-price')) || 0;
                } else {
                    aVal = a.getAttribute('data-unit') || '';
                    bVal = b.getAttribute('data-unit') || '';
                }

                if (typeof aVal === 'string') {
                    return metalsSortDirection === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                }
                return metalsSortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        function updateMetalsConversion() {
            const input = document.getElementById('metalsConverterInput');
            const amount = parseFloat(input.value) || 0;
            const header = document.getElementById('metalsYouGetHeader');
            const cells = document.querySelectorAll('.metals-converted');

            if (amount > 0) {
                header.style.display = '';
                cells.forEach(cell => {
                    cell.style.display = '';
                    const row = cell.parentElement;
                    const pricePerGram = parseFloat(row.getAttribute('data-price')) || 0;
                    if (pricePerGram > 0) {
                        const grams = amount / pricePerGram;
                        cell.textContent = grams >= 1 ? grams.toFixed(2) + 'g' : (grams * 1000).toFixed(2) + 'mg';
                    }
                });
            } else {
                header.style.display = 'none';
                cells.forEach(cell => cell.style.display = 'none');
            }
        }

        function toggleMetalsShare() {
            const dropdown = document.getElementById('metalsShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Fuel functions
        let fuelSortColumn = 'city';
        let fuelSortDirection = 'asc';

        function filterFuel() {
            const query = document.getElementById('fuelSearchInput').value.toLowerCase();
            const clearBtn = document.getElementById('fuelClearBtn');
            clearBtn.classList.toggle('visible', query.length > 0);

            const rows = document.querySelectorAll('#fuelTableBody tr');
            rows.forEach(row => {
                const city = row.getAttribute('data-city') || '';
                row.style.display = city.includes(query) ? '' : 'none';
            });
        }

        function clearFuelSearch() {
            document.getElementById('fuelSearchInput').value = '';
            document.getElementById('fuelClearBtn').classList.remove('visible');
            filterFuel();
        }

        function sortFuel(column) {
            const tbody = document.getElementById('fuelTableBody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            if (fuelSortColumn === column) {
                fuelSortDirection = fuelSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                fuelSortColumn = column;
                fuelSortDirection = column === 'city' ? 'asc' : 'desc';
            }

            rows.sort((a, b) => {
                let aVal, bVal;
                if (column === 'city') {
                    aVal = a.getAttribute('data-city') || '';
                    bVal = b.getAttribute('data-city') || '';
                } else {
                    aVal = parseFloat(a.getAttribute('data-' + column)) || 0;
                    bVal = parseFloat(b.getAttribute('data-' + column)) || 0;
                }

                if (typeof aVal === 'string') {
                    return fuelSortDirection === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
                }
                return fuelSortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        function toggleFuelShare() {
            const dropdown = document.getElementById('fuelShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Banking functions
        let currentBankingTab = 'fd';

        function setBankingTab(tab) {
            currentBankingTab = tab;

            // Hide all subtables
            document.getElementById('fdRatesTable').style.display = 'none';
            document.getElementById('homeLoanTable').style.display = 'none';
            document.getElementById('carLoanTable').style.display = 'none';

            // Remove active from all toggle buttons
            document.getElementById('toggleFD').classList.remove('active');
            document.getElementById('toggleHomeLoan').classList.remove('active');
            document.getElementById('toggleCarLoan').classList.remove('active');

            // Show selected tab
            if (tab === 'fd') {
                document.getElementById('fdRatesTable').style.display = 'block';
                document.getElementById('toggleFD').classList.add('active');
            } else if (tab === 'homeloan') {
                document.getElementById('homeLoanTable').style.display = 'block';
                document.getElementById('toggleHomeLoan').classList.add('active');
            } else if (tab === 'carloan') {
                document.getElementById('carLoanTable').style.display = 'block';
                document.getElementById('toggleCarLoan').classList.add('active');
            }
        }

        function filterBanking() {
            const query = document.getElementById('bankingSearchInput').value.toLowerCase();
            const clearBtn = document.getElementById('bankingClearBtn');
            clearBtn.classList.toggle('visible', query.length > 0);

            // Filter all three tables
            ['fdTableBody', 'hlTableBody', 'clTableBody'].forEach(tableId => {
                const rows = document.querySelectorAll(`#${tableId} tr`);
                rows.forEach(row => {
                    const bank = row.getAttribute('data-bank') || '';
                    const text = row.textContent.toLowerCase();
                    row.style.display = (bank.includes(query) || text.includes(query)) ? '' : 'none';
                });
            });
        }

        function clearBankingSearch() {
            document.getElementById('bankingSearchInput').value = '';
            document.getElementById('bankingClearBtn').classList.remove('visible');
            filterBanking();
        }

        function sortBanking(tableType, column) {
            const tableIds = { fd: 'fdTableBody', hl: 'hlTableBody', cl: 'clTableBody' };
            const tbody = document.getElementById(tableIds[tableType]);
            const rows = Array.from(tbody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                let aVal, bVal;
                if (column === 'bank') {
                    aVal = a.getAttribute('data-bank') || '';
                    bVal = b.getAttribute('data-bank') || '';
                    return aVal.localeCompare(bVal);
                } else {
                    aVal = parseFloat(a.getAttribute('data-' + column)) || 0;
                    bVal = parseFloat(b.getAttribute('data-' + column)) || 0;
                    return bVal - aVal; // Higher rates first
                }
            });

            rows.forEach(row => tbody.appendChild(row));
        }

        function toggleBankingShare() {
            const dropdown = document.getElementById('bankingShareDropdown');
            dropdown.classList.toggle('open');
        }

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            // Metals share dropdown
            const metalsContainer = document.querySelector('#sectionMetals .share-container');
            if (metalsContainer && !metalsContainer.contains(e.target)) {
                document.getElementById('metalsShareDropdown')?.classList.remove('open');
            }
            // Fuel share dropdown
            const fuelContainer = document.querySelector('#sectionFuel .share-container');
            if (fuelContainer && !fuelContainer.contains(e.target)) {
                document.getElementById('fuelShareDropdown')?.classList.remove('open');
            }
            // Banking share dropdown
            const bankingContainer = document.querySelector('#sectionBanking .share-container');
            if (bankingContainer && !bankingContainer.contains(e.target)) {
                document.getElementById('bankingShareDropdown')?.classList.remove('open');
            }
        });

        // Render table
        function renderTable() {
            const content = document.getElementById('content');

            // Filter data
            let filteredData = tableData.filter(c =>
                c.code.toLowerCase().includes(searchQuery) ||
                c.name.toLowerCase().includes(searchQuery)
            );

            // Sort data
            filteredData = sortData(filteredData);

            if (filteredData.length === 0) {
                content.innerHTML = `
                    <div class="no-results">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <p>No currencies found matching "${searchQuery}"</p>
                    </div>
                `;
                return;
            }

            const getSortIcon = (column) => {
                const isActive = sortColumn === column;
                const icon = sortDirection === 'asc' ? '' : '';
                return `<span class="sort-icon">${isActive ? icon : ''}</span>`;
            };

            const headerCells = PERIODS.map(p => `
                <th class="${sortColumn === p.key ? 'sorted' : ''}" onclick="handleSort('${p.key}')">
                    <span class="th-content">${p.label} ${getSortIcon(p.key)}</span>
                </th>
            `).join('');

            const formatChange = (changeObj) => {
                if (!changeObj || changeObj.percent === null) return { text: 'N/A', class: 'neutral' };
                const value = displayMode === 'percent' ? changeObj.percent : changeObj.absolute;
                if (value === null || isNaN(value)) return { text: 'N/A', class: 'neutral' };
                const sign = value >= 0 ? '+' : '';
                const cssClass = value > 0 ? 'positive' : value < 0 ? 'negative' : 'neutral';
                if (displayMode === 'percent') {
                    return { text: `${sign}${value.toFixed(2)}%`, class: cssClass };
                } else {
                    // Format absolute change
                    const absFormatted = Math.abs(value) > 1 ? value.toFixed(2) : value.toFixed(4);
                    return { text: `${sign}${absFormatted}`, class: cssClass };
                }
            };

            const formatRate = (rate) => {
                if (!rate) return 'N/A';
                let formatted;
                if (rate > 100) formatted = rate.toFixed(2);
                else if (rate > 1) formatted = rate.toFixed(4);
                else formatted = rate.toFixed(6);
                return `${formatted}`;
            };

            const formatConverted = (rate) => {
                if (!rate || conversionAmount <= 0) return '';
                const converted = conversionAmount / rate;
                let formatted;
                if (converted >= 1000) formatted = converted.toFixed(0);
                else if (converted >= 1) formatted = converted.toFixed(2);
                else formatted = converted.toFixed(4);
                return formatted;
            };

            const rows = filteredData.map(currency => {
                const changeCells = currency.changes.map(change => {
                    const formatted = formatChange(change);
                    return `<td class="change-cell ${formatted.class}">${formatted.text}</td>`;
                }).join('');

                const convertedValue = formatConverted(currency.rate);
                const convertedCell = conversionAmount > 0
                    ? `<td class="converted-value">${convertedValue}</td>`
                    : '';

                return `
                    <tr>
                        <td>
                            <div class="currency-cell">
                                <div class="currency-flag">${currency.flag}</div>
                                <div class="currency-info">
                                    <span class="currency-code">${currency.code}</span>
                                    <span class="currency-name">${currency.name}</span>
                                </div>
                            </div>
                        </td>
                        <td class="rate-cell">${formatRate(currency.rate)}</td>
                        ${convertedCell}
                        ${changeCells}
                    </tr>
                `;
            }).join('');

            const convertedHeader = conversionAmount > 0
                ? `<th><span class="th-content">${conversionAmount.toLocaleString()} =</span></th>`
                : '';

            content.innerHTML = `
                <div class="table-scroll">
                    <table class="currency-table">
                        <thead>
                            <tr>
                                <th class="${sortColumn === 'code' ? 'sorted' : ''}" onclick="handleSort('code')">
                                    <span class="th-content">Currency ${getSortIcon('code')}</span>
                                </th>
                                <th class="${sortColumn === 'rate' ? 'sorted' : ''}" onclick="handleSort('rate')">
                                    <span class="th-content">Rate ${getSortIcon('rate')}</span>
                                </th>
                                ${convertedHeader}
                                ${headerCells}
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
        }
    </script>
</body>
</html>
