<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fintpe - DIY Personal Finance | Track Net Worth, Assets & Investments</title>
    <meta name="description" content="Your money. Your way. Your data. A privacy-first personal finance platform to track net worth, assets, and investments. No clutter, no spam, no tracking.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Include your main.css styles here */
        :root {
            /* Minimalistic pastel color scheme - soft and soothing */
            --primary: #6b7280;
            --primary-dark: #4b5563;
            --primary-light: #9ca3af;
            --accent: #8b7355;
            --secondary: #6b8e7d;
            --success: #6b8e7d;
            --warning: #c9a86c;
            --danger: #b87070;
            --dark: #374151;
            --light: #faf9f7;
            --white: #ffffff;
            --text-primary: #374151;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e8e6e3;
            --border-light: #f3f2f0;

            /* Subtle pastel additions */
            --gradient-primary: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            --gradient-accent: linear-gradient(135deg, #8b7355 0%, #a68b5b 100%);
            --gradient-subtle: linear-gradient(135deg, #faf9f7 0%, #f3f2f0 100%);
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.03);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.03);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.03);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.05), 0 8px 10px -6px rgb(0 0 0 / 0.03);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes textReveal {
            from {
                clip-path: inset(0 100% 0 0);
            }
            to {
                clip-path: inset(0 0 0 0);
            }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes pulse-subtle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes float-gentle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        @keyframes draw-line {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }

        /* Scroll-triggered animation classes */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s var(--ease-out-expo), transform 0.8s var(--ease-out-expo);
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .animate-stagger > * {
            opacity: 0;
            transform: translateY(20px);
        }

        .animate-stagger.visible > *:nth-child(1) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.1s forwards; }
        .animate-stagger.visible > *:nth-child(2) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.2s forwards; }
        .animate-stagger.visible > *:nth-child(3) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.3s forwards; }
        .animate-stagger.visible > *:nth-child(4) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.4s forwards; }
        .animate-stagger.visible > *:nth-child(5) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.5s forwards; }
        .animate-stagger.visible > *:nth-child(6) { animation: fadeInUp 0.6s var(--ease-out-expo) 0.6s forwards; }

        /* Dark Mode Variables - subtle and muted */
        [data-theme="dark"] {
            --primary: #9ca3af;
            --primary-dark: #6b7280;
            --primary-light: #d1d5db;
            --secondary: #7fa090;
            --success: #7fa090;
            --warning: #d4b87a;
            --danger: #c88080;
            --dark: #1f2937;
            --light: #1f2937;
            --white: #2d3748;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border: #374151;
            --border-light: #2d3748;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--white);
            transition: all 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        ::selection {
            background: var(--primary);
            color: white;
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .coming-soon-badge {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: color 0.3s ease;
            background: none;
            border: none;
            cursor: pointer;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .login-btn {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .login-btn:hover {
            background: var(--primary-dark);
        }

        /* User Menu Dropdown */
        .user-menu {
            position: relative;
        }

        .user-menu-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .user-menu-btn:hover {
            background: var(--white);
            border-color: var(--primary);
        }

        .user-menu-btn i {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.12);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
            z-index: 1001;
        }

        .user-menu:hover .user-dropdown,
        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.15s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .user-dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .user-dropdown-item:last-child {
            border-radius: 0 0 12px 12px;
        }

        .user-dropdown-item:hover {
            background: var(--light);
        }

        .user-dropdown-item i {
            width: 18px;
            color: var(--text-secondary);
        }

        .user-dropdown-item.danger {
            color: var(--danger);
        }

        .user-dropdown-item.danger i {
            color: var(--danger);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 0.25rem 0;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* ========== PREMIUM DARK HERO ========== */
        .hero {
            min-height: 100vh;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #020347;
            position: relative;
            overflow: hidden;
        }

        /* Animated gradient mesh background */
        .hero-gradient {
            position: absolute;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(120, 119, 198, 0.15), transparent),
                radial-gradient(ellipse 60% 50% at 80% 50%, rgba(79, 70, 229, 0.12), transparent),
                radial-gradient(ellipse 50% 40% at 40% 80%, rgba(16, 185, 129, 0.08), transparent);
            animation: gradientShift 15s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
            33% { opacity: 0.8; transform: scale(1.05) rotate(1deg); }
            66% { opacity: 0.9; transform: scale(0.98) rotate(-1deg); }
        }

        /* Grid overlay */
        .hero-grid {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%);
            -webkit-mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%);
        }

        /* Glow orbs */
        .hero-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: orbFloat 20s ease-in-out infinite;
        }

        .hero-orb-1 {
            width: 600px;
            height: 600px;
            background: rgba(79, 70, 229, 0.3);
            top: -20%;
            right: -10%;
            animation-delay: 0s;
        }

        .hero-orb-2 {
            width: 400px;
            height: 400px;
            background: rgba(16, 185, 129, 0.2);
            bottom: -10%;
            left: -5%;
            animation-delay: -7s;
        }

        .hero-orb-3 {
            width: 300px;
            height: 300px;
            background: rgba(120, 119, 198, 0.25);
            top: 40%;
            left: 20%;
            animation-delay: -14s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(10px, 10px) scale(1.02); }
        }

        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 4rem 0;
        }

        .hero-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 2rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            opacity: 0;
            animation: fadeInUp 1s var(--ease-out-expo) 0.1s forwards;
        }

        .hero-eyebrow::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(16, 185, 129, 0); }
        }

        .hero-title {
            font-size: clamp(3rem, 10vw, 5.5rem);
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #ffffff;
            line-height: 1.05;
            letter-spacing: -0.04em;
            opacity: 0;
            animation: fadeInUp 1s var(--ease-out-expo) 0.25s forwards;
        }

        .hero-title-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 50%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: textShimmer 5s linear infinite;
        }

        @keyframes textShimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .hero-subtitle {
            font-size: 1.25rem;
            margin-bottom: 3rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.7;
            max-width: 560px;
            margin-left: auto;
            margin-right: auto;
            opacity: 0;
            animation: fadeInUp 1s var(--ease-out-expo) 0.4s forwards;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 4rem;
            opacity: 0;
            animation: fadeInUp 1s var(--ease-out-expo) 0.55s forwards;
        }

        /* Premium buttons */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: #ffffff;
            color: #020347;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2), 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .btn-primary i {
            transition: transform 0.4s var(--ease-out-expo);
        }

        .btn-primary:hover i {
            transform: translateX(4px);
        }

        .btn-secondary {
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            color: #ffffff;
        }

        .btn-tertiary {
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            padding: 1rem 1.5rem;
        }

        .btn-tertiary:hover {
            color: #ffffff;
        }

        /* Stats row */
        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 4rem;
            opacity: 0;
            animation: fadeInUp 1s var(--ease-out-expo) 0.7s forwards;
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.02em;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .hero-stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        @media (max-width: 768px) {
            .hero-stats {
                flex-direction: column;
                gap: 2rem;
            }
            .hero-stat-value {
                font-size: 2rem;
            }
        }

        /* Non-hero button overrides */
        .features-section .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(2, 3, 71, 0.15);
        }

        .btn-tertiary {
            background: transparent;
            color: var(--text-secondary);
            padding: 0.95rem 1.25rem;
            position: relative;
        }

        .btn-tertiary::after {
            content: '';
            position: absolute;
            bottom: 0.7rem;
            left: 1.25rem;
            right: 1.25rem;
            height: 1px;
            background: currentColor;
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.4s var(--ease-out-expo);
        }

        .btn-tertiary:hover {
            color: var(--primary);
        }

        .btn-tertiary:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        /* Modals */
        .modal, .service-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content, .service-modal-content {
            background-color: var(--white);
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .service-modal-content {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header, .service-modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .service-modal-header {
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-body, .service-modal-body {
            padding: 2rem;
        }

        /* Auth Tabs */
        .auth-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            background: var(--light);
            border-radius: 8px;
            padding: 4px;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .auth-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Settings Tabs */
        .settings-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 1.5rem;
            background: var(--light);
            border-radius: 8px;
            padding: 4px;
        }

        .settings-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .settings-tab.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .settings-tab:hover:not(.active) {
            color: var(--text-primary);
        }

        .settings-content {
            max-height: 50vh;
            overflow-y: auto;
            padding-right: 0.5rem;
        }

        .settings-section {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .settings-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-section-title i {
            color: var(--primary);
        }

        .rate-table {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .rate-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 80px;
            gap: 1rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .rate-row:last-child {
            border-bottom: none;
        }

        .rate-row[onclick]:hover {
            background: var(--light);
            margin: 0 -0.5rem;
            padding: 0.75rem 0.5rem;
            border-radius: 8px;
        }

        .rate-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .rate-unit {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .rate-value {
            font-weight: 600;
            color: var(--text-primary);
            text-align: right;
        }

        .rate-change {
            font-size: 0.85rem;
            font-weight: 500;
            text-align: right;
        }

        .rate-change.positive {
            color: var(--success);
        }

        .rate-change.negative {
            color: var(--danger);
        }

        .rate-change.neutral {
            color: var(--text-secondary);
        }

        @media (max-width: 600px) {
            .rate-row {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }
            .rate-unit {
                display: none;
            }
        }

        .form-section-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .account-action-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
            border: 1px solid transparent;
        }

        .account-action-item:hover {
            background: var(--white);
            border-color: var(--border);
            transform: translateX(4px);
        }

        .account-action-item .action-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border-radius: 10px;
            font-size: 1.2rem;
        }

        .account-action-item .action-info h4 {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .account-action-item .action-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .account-action-item .action-arrow {
            margin-left: auto;
            color: var(--text-secondary);
        }

        /* Onboarding Modal Styles */
        .onboarding-modal {
            max-width: 580px;
            max-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .onboarding-modal .modal-body {
            overflow-y: auto;
            flex: 1;
        }

        .onboarding-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 2rem;
        }

        .onboarding-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }

        .progress-step span {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .progress-step.active span,
        .progress-step.completed span {
            color: white;
        }

        .step-circle {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: white;
            border-color: white;
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .progress-step.completed .step-circle {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .progress-line {
            width: 60px;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 0.5rem;
            margin-bottom: 1.5rem;
            border-radius: 2px;
            transition: background 0.3s ease;
        }

        .progress-line.active {
            background: #10b981;
        }

        .step-header {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .step-header h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .step-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .onboarding-next-btn {
            width: 100%;
            justify-content: center;
            padding: 1rem;
            font-size: 1rem;
            margin-top: 1rem;
        }

        .btn-ghost {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        .btn-ghost:hover {
            background: var(--light);
            color: var(--text-primary);
        }

        .btn-success-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-success-gradient:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        /* Goals Grid */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .goal-card {
            cursor: pointer;
        }

        .goal-card input {
            display: none;
        }

        .goal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--light);
            border: 2px solid transparent;
            border-radius: 12px;
            transition: all 0.2s ease;
            text-align: center;
        }

        .goal-content i {
            font-size: 1.5rem;
            color: var(--text-secondary);
        }

        .goal-content span {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .goal-card input:checked + .goal-content {
            background: rgba(2, 3, 71, 0.05);
            border-color: var(--primary);
        }

        .goal-card input:checked + .goal-content i {
            color: var(--primary);
        }

        .goal-card input:checked + .goal-content span {
            color: var(--primary);
        }

        .goal-card:hover .goal-content {
            border-color: var(--border);
        }

        /* Risk Options */
        .risk-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .risk-option {
            cursor: pointer;
        }

        .risk-option input {
            display: none;
        }

        .risk-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--light);
            border: 2px solid transparent;
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .risk-icon {
            font-size: 1.5rem;
        }

        .risk-content strong {
            display: block;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .risk-content p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .risk-option input:checked + .risk-content {
            background: rgba(2, 3, 71, 0.05);
            border-color: var(--primary);
        }

        .risk-option:hover .risk-content {
            border-color: var(--border);
        }

        @media (max-width: 500px) {
            .goals-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .progress-line {
                width: 30px;
            }

            .step-circle {
                width: 36px;
                height: 36px;
                font-size: 0.85rem;
            }
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .form-actions .btn {
            flex: 1;
        }

        .form-group label i {
            margin-right: 0.5rem;
            color: var(--text-secondary);
        }

        /* Donut Chart */
        .donut-chart-container {
            display: flex;
            align-items: center;
            gap: 2rem;
            padding: 1.5rem;
            background: var(--white);
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .donut-chart {
            position: relative;
            width: 160px;
            height: 160px;
            flex-shrink: 0;
        }

        .donut-chart svg {
            transform: rotate(-90deg);
        }

        .donut-chart-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-chart-center .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .donut-chart-center .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .donut-legend {
            flex: 1;
        }

        .donut-legend-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }

        .donut-legend-item:last-child {
            border-bottom: none;
        }

        .legend-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-text {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .legend-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Toast Messages */
        .toast-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            background: var(--white);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 9999;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            font-weight: 500;
        }

        .toast-message.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-success i {
            color: var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--danger);
        }

        .toast-error i {
            color: var(--danger);
        }

        .toast-info {
            border-left: 4px solid var(--primary);
        }

        .toast-info i {
            color: var(--primary);
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Login Form */
        .login-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* OTP */
        .otp-container {
            display: none;
        }

        .otp-inputs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem 0;
        }

        .otp-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            border: 2px solid var(--border);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .otp-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .resend-otp {
            text-align: center;
            margin-top: 1rem;
        }

        .resend-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* Services Grid */
        .service-grid {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .service-item {
            background: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .service-item:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
        }

        .service-item h4 {
            margin: 0 0 0.5rem 0;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .service-item p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Features */
        .features-section {
            padding: 8rem 2rem;
            background: var(--white);
            border-top: 1px solid var(--border);
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-title {
            text-align: center;
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .section-subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 0;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
        }

        .features-grid {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.25rem;
        }

        @media (max-width: 900px) {
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
        }

        .feature-card {
            padding: 2rem;
            border-radius: 12px;
            background: var(--light);
            border: 1px solid transparent;
            transition: all 0.5s var(--ease-out-expo);
            position: relative;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px;
            padding: 1px;
            background: linear-gradient(135deg, transparent 0%, rgba(2, 3, 71, 0.1) 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.5s var(--ease-out-expo);
        }

        .feature-card:hover {
            background: var(--white);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -15px rgba(2, 3, 71, 0.1);
        }

        .feature-card:hover::before {
            opacity: 1;
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-bottom: 1.25rem;
            transition: transform 0.5s var(--ease-out-expo);
        }

        .feature-card:hover .feature-icon {
            transform: scale(1.05);
        }

        .feature-title {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 0.6rem;
            color: var(--text-primary);
        }

        .feature-description {
            color: var(--text-secondary);
            line-height: 1.65;
            font-size: 0.9rem;
        }

        /* Security Features */
        .security-section {
            padding: 8rem 2rem;
            background: var(--light);
            border-top: 1px solid var(--border);
        }

        .security-features {
            max-width: 900px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .security-card {
            padding: 1.5rem;
            text-align: center;
        }

        .security-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin: 0 auto 1rem;
            background: var(--white);
            color: var(--primary);
        }

        .security-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .security-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: none;
            min-height: 100vh;
            background: var(--light);
            padding: 6rem 2rem 2rem;
            transition: all 0.3s ease;
        }

        .dashboard-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .dashboard-header {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
        }

        .dashboard-welcome {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .card-amount {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-change {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }

        /* Privacy Mode */
        .privacy-blur {
            filter: blur(8px);
            transition: filter 0.3s ease;
            user-select: none;
        }

        /* Transactions */
        .transactions-section {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
        }

        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .transactions-table th,
        .transactions-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .transactions-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--text-primary);
        }

        .transaction-type {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .type-credit {
            background: #d1fae5;
            color: var(--success);
        }

        .type-debit {
            background: #fee2e2;
            color: var(--danger);
        }

        .type-transfer {
            background: #dbeafe;
            color: var(--primary);
        }

        /* Account Section */
        .account-section {
            padding: 2rem;
            background: var(--light);
            min-height: 100vh;
        }

        .account-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            background: var(--white);
            border-radius: 16px;
            padding: 1.5rem 2rem;
            border: 1px solid var(--border);
        }

        .profile-avatar {
            flex-shrink: 0;
        }

        .avatar-circle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .account-status-alert {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 0;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .account-status-alert i {
            color: #c9a86c;
            font-size: 0.75rem;
        }

        .btn-complete {
            background: transparent;
            color: #8b7355;
            border: none;
            padding: 0;
            border-radius: 0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: underline;
            font-size: 0.85rem;
        }

        .profile-details-section {
            background: var(--white);
            border-radius: 24px;
            padding: 2.5rem;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.05);
            margin-bottom: 3rem;
        }

        .profile-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2.5rem;
            align-items: flex-start;
        }

        .profile-form-card h3,
        .profile-summary-card h3 {
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .profile-form-card p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .profile-form {
            display: grid;
            gap: 1rem;
        }

        .profile-form .form-row {
            display: grid;
            gap: 0.5rem;
        }

        .profile-form label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .profile-form input,
        .profile-form select {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .profile-form input:focus,
        .profile-form select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .profile-form textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .profile-form textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .profile-form button {
            justify-self: flex-start;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .profile-summary-card {
            background: var(--light);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
        }

        .profile-summary-card p {
            color: var(--text-secondary);
        }

        .profile-details-display {
            border: 1px dashed var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            display: grid;
            gap: 1rem;
        }

        .profile-details-display.empty {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .profile-detail-item {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-light);
        }

        .profile-detail-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .profile-detail-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .profile-detail-value {
            font-weight: 600;
            color: var(--text-primary);
            text-align: right;
        }

        .profile-clear-btn {
            margin-top: 1rem;
            width: 100%;
            justify-content: center;
        }

        .profile-details-section.section-highlight {
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2), 0 25px 60px rgba(15, 23, 42, 0.2);
            transition: box-shadow 0.4s ease;
        }

        /* Management Modal - Clean Table Design */
        .management-container {
            padding: 0.5rem 0;
        }

        .management-records {
            margin-bottom: 1.5rem;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .records-table th {
            background: var(--light);
            padding: 0.875rem 1rem;
            text-align: left;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            border-bottom: 1px solid var(--border);
        }

        .records-table td {
            padding: 1rem;
            font-size: 0.95rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
        }

        .records-table tbody tr:last-child td {
            border-bottom: none;
        }

        .records-table tbody tr:hover {
            background: var(--light);
        }

        .actions-cell {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .icon-btn.edit {
            background: #f3f2f0;
            color: #6b7280;
        }

        .icon-btn.edit:hover {
            background: #6b7280;
            color: white;
        }

        .icon-btn.delete {
            background: #fef0f0;
            color: #b87070;
        }

        .icon-btn.delete:hover {
            background: #b87070;
            color: white;
        }

        .add-entry-btn {
            width: 100%;
            padding: 0.875rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .management-form-wrapper {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .management-form h4 {
            margin: 0 0 1.25rem 0;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .form-fields-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        @media (max-width: 600px) {
            .form-fields-grid {
                grid-template-columns: 1fr;
            }
        }

        .management-field {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .management-field label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .management-field input,
        .management-field select,
        .management-field textarea {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: inherit;
            background: var(--white);
        }

        .management-field input:focus,
        .management-field select:focus,
        .management-field textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        .management-field textarea {
            min-height: 80px;
            resize: vertical;
        }

        .form-actions-row {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: flex-end;
        }

        .form-actions-row .btn {
            min-width: 100px;
        }

        .management-empty-state {
            text-align: center;
            padding: 3rem 2rem;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .management-empty-state p {
            margin: 0;
            color: var(--text-secondary);
        }

        /* Investment Portfolio Styles */
        .portfolio-container {
            padding: 0;
        }

        .broker-upload-section {
            background: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .broker-selection {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .broker-btn {
            flex: 1;
            min-width: 140px;
            padding: 1rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .broker-btn:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .broker-btn.active {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .broker-btn img {
            width: 28px;
            height: 28px;
            border-radius: 6px;
        }

        .broker-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .broker-icon.zerodha {
            background: #387ed1;
            color: white;
        }

        .broker-icon.groww {
            background: #00d09c;
            color: white;
        }

        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover,
        .file-upload-area.drag-over {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .file-upload-area i {
            font-size: 2.5rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .file-upload-area p {
            margin: 0;
            color: var(--text-secondary);
        }

        .file-upload-area .browse-link {
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
        }

        .file-upload-area input[type="file"] {
            display: none;
        }

        .portfolio-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            .portfolio-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .summary-card {
            background: var(--white);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        .summary-card .label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .summary-card .value {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .summary-card .value.positive {
            color: #6b8e7d;
        }

        .summary-card .value.negative {
            color: #b87070;
        }

        .holdings-section {
            background: var(--white);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .holdings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--light);
            border-bottom: 1px solid var(--border);
        }

        .holdings-header h4 {
            margin: 0;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .holdings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .holdings-table th {
            background: var(--light);
            padding: 0.75rem 1rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            position: sticky;
            top: 0;
        }

        .holdings-table td {
            padding: 0.875rem 1rem;
            font-size: 0.9rem;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
        }

        .holdings-table tbody tr:last-child td {
            border-bottom: none;
        }

        .holdings-table tbody tr:hover {
            background: rgba(37, 99, 235, 0.03);
        }

        .holdings-table .symbol {
            font-weight: 600;
        }

        .holdings-table .sector {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .holdings-table .pnl-positive {
            color: #6b8e7d;
            font-weight: 600;
        }

        .holdings-table .pnl-negative {
            color: #b87070;
            font-weight: 600;
        }

        .holdings-scroll {
            max-height: 400px;
            overflow-y: auto;
        }

        .portfolio-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .portfolio-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: var(--light);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .portfolio-tab.active {
            background: var(--primary);
            color: white;
        }

        .portfolio-tab:hover:not(.active) {
            background: var(--border);
        }

        .clear-portfolio-btn {
            background: #fef0f0;
            color: #b87070;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .clear-portfolio-btn:hover {
            background: #b87070;
            color: white;
        }

        /* Settings Toggle Section */
        .settings-toggle-section {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .toggle-setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .toggle-setting-item:last-child {
            border-bottom: none;
        }

        .toggle-setting-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .toggle-setting-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* iOS Toggle Switch */
        .ios-toggle {
            width: 60px;
            height: 34px;
            background-color: #e5e7eb;
            border-radius: 17px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            outline: none;
        }

        .ios-toggle.active {
            background-color: var(--primary);
        }

        .ios-toggle-slider {
            width: 30px;
            height: 30px;
            background-color: white;
            border-radius: 15px;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .ios-toggle.active .ios-toggle-slider {
            transform: translateX(26px);
        }

        /* Family Section */
        .family-section {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .family-toggle-button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .family-view {
            display: none;
        }

        .family-members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .family-member-card {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .family-member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            margin: 0 auto 1rem;
        }

        .family-member-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .family-member-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .family-member-wealth {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--success);
        }

        /* Account Settings - Two Panel Layout */
        .account-settings-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        @media (max-width: 768px) {
            .account-settings-layout {
                grid-template-columns: 1fr;
            }
        }

        .account-sidebar {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            height: fit-content;
        }

        .account-sidebar-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .account-management-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .account-card {
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--border);
            border-radius: 0;
            padding: 0.875rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.15s ease;
            border-left: 3px solid transparent;
        }

        .account-card:last-child {
            border-bottom: none;
        }

        .account-card:hover {
            background: var(--light);
        }

        .account-card.active {
            background: var(--light);
            border-left-color: #8b7355;
        }

        .account-card.active .card-content h3 {
            color: #8b7355;
            font-weight: 600;
        }

        .card-icon {
            width: 18px;
            height: 18px;
            border-radius: 0;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .card-content h3 {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0;
            transition: color 0.15s ease;
        }

        .card-content p {
            display: none;
        }

        .account-content-panel {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            min-height: 400px;
        }

        .account-content-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .account-content-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 0.25rem 0;
        }

        .account-content-header p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .account-content-body {
            padding: 1.5rem;
        }

        .account-grid-header {
            display: none;
        }

        /* Quick Actions - Minimal Style */
        .quick-actions {
            background: var(--white);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        .quick-actions h3 {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .quick-actions-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .quick-action-btn {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem 0.875rem;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.15s ease;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .quick-action-btn:hover {
            background: var(--light);
            border-color: var(--border);
            color: var(--text-primary);
            transform: none;
        }

        .quick-action-btn.danger {
            color: var(--danger);
        }

        .quick-action-btn.danger:hover {
            background: #fef0f0;
            border-color: var(--danger);
        }

        /* Success Notification */
        .success-notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            z-index: 9999;
            animation: slideInRight 0.3s ease-out;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }

        /* Insight Arrow Buttons */
        .insight-arrow-btn {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .insight-arrow-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateX(2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Member Insight Buttons */
        .member-insight-btn {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            margin-top: 1rem;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .member-insight-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-1px);
        }

        /* Calendar Modal Styles */
        .calendar-modal {
            display: none;
            position: fixed;
            z-index: 2500;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }

        .calendar-modal-content {
            background-color: var(--white);
            margin: 2% auto;
            padding: 0;
            border-radius: 20px;
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }

        .calendar-modal-header {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            border-radius: 20px 20px 0 0;
        }

        .calendar-modal-body {
            padding: 2rem;
        }

        .calendar-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .calendar-grid {
            background: var(--white);
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .calendar-header {
            background: var(--light);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            color: var(--primary);
            transition: background 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--border);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day-header {
            background: var(--border-light);
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .calendar-day {
            min-height: 80px;
            border: 1px solid var(--border-light);
            padding: 0.5rem;
            cursor: pointer;
            transition: background 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--light);
        }

        .calendar-day.selected {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary);
        }

        .calendar-day.today {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        .calendar-day.other-month {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
            margin-bottom: 2px;
        }

        .event-dot.emi { background: #b87070; }
        .event-dot.sip { background: #6b8e7d; }
        .event-dot.insurance { background: #8b9dc3; }
        .event-dot.bill { background: #c9a86c; }

        .calendar-events-panel {
            background: var(--light);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .selected-date-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .event-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .event-item {
            background: var(--white);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .event-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .event-details {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .event-amount {
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }
            
            .calendar-modal-content {
                width: 98%;
                margin: 1% auto;
            }
        }

        /* Insight Modal Styles */
        .insight-modal {
            display: none;
            position: fixed;
            z-index: 2500;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }

        .insight-modal-content {
            background-color: var(--white);
            margin: 3% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
        }

        .insight-modal-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            border-radius: 20px 20px 0 0;
        }

        .insight-modal-body {
            padding: 2rem;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .insight-card {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .insight-card h4 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .insight-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .progress-bar-container {
            background: #e5e7eb;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.5s ease;
        }

        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 3rem 2rem 2rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: white;
        }

        .footer-links {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .footer-links a {
            color: #9ca3af;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #374151;
            text-align: center;
            color: #9ca3af;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .mobile-toggle {
                display: block;
            }

            .nav-menu {
                display: none;
                position: fixed;
                top: 100%;
                left: 0;
                width: 100%;
                background: white;
                flex-direction: column;
                padding: 2rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            .nav-menu.active {
                display: flex;
            }

            .profile-header {
                flex-direction: column;
                gap: 1.5rem;
            }

            .dashboard-welcome {
                flex-direction: column;
                gap: 1rem;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .account-status-alert {
                flex-direction: row;
                align-items: center;
                gap: 0.5rem;
            }
            .account-settings-layout {
                grid-template-columns: 1fr;
            }
            .account-sidebar {
                order: 2;
            }
            .account-content-panel {
                order: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo-container">
                <a href="#" class="logo">Fintpe</a>
                <span class="coming-soon-badge">Coming Soon</span>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li id="loginBtnContainer"><button class="login-btn" onclick="openLoginModal()" id="loginBtn">Login</button></li>
                <li id="userMenuContainer" style="display: none;">
                    <div class="user-menu">
                        <button class="user-menu-btn" id="userMenuBtn">
                            <i class="fas fa-user-circle"></i>
                            <span id="userMenuName">User</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <button class="user-dropdown-item" onclick="loadDashboard()">
                                <i class="fas fa-chart-pie"></i> My Portfolio
                            </button>
                            <button class="user-dropdown-item" onclick="loadPage('account')">
                                <i class="fas fa-user-cog"></i> My Account
                            </button>
                            <div class="user-dropdown-divider"></div>
                            <button class="user-dropdown-item" onclick="openRateChart()">
                                <i class="fas fa-chart-bar"></i> Rate Chart
                            </button>
                            <button class="user-dropdown-item" onclick="openCalculators()">
                                <i class="fas fa-calculator"></i> Calculators
                            </button>
                            <div class="user-dropdown-divider"></div>
                            <button class="user-dropdown-item danger" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </li>
            </ul>
            <button class="mobile-toggle" id="mobile-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Service Modal -->
    <div id="serviceModal" class="service-modal">
        <div class="service-modal-content">
            <div class="service-modal-header">
                <span class="close" onclick="closeServiceModal()">&times;</span>
                <h2 id="serviceModalTitle">Service</h2>
                <p id="serviceModalSubtitle">Choose an option below</p>
            </div>
            <div class="service-modal-body" id="serviceModalBody">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeLoginModal()">&times;</span>
                <h2 id="modalTitle">Welcome to Fintpe</h2>
                <p id="modalSubtitle">Your private finance dashboard</p>
            </div>
            <div class="modal-body">
                <!-- Auth Tabs -->
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">Login</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>

                <!-- Login Form -->
                <form class="login-form" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="handleLogin(event)">
                        <i class="fas fa-sign-in-alt"></i>
                        Login
                    </button>
                </form>

                <!-- Signup Form -->
                <form class="login-form" id="signupForm" style="display: none;" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="signupEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="signupPassword" placeholder="Create a password (min 6 chars)" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="handleSignup(event)">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                </form>

                <p style="text-align: center; margin-top: 1.5rem; color: var(--text-muted); font-size: 0.85rem;">
                    <i class="fas fa-lock" style="margin-right: 0.5rem;"></i>
                    All data stored locally on your device
                </p>
            </div>
        </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="modal">
        <div class="modal-content onboarding-modal">
            <!-- Progress Header -->
            <div class="onboarding-header">
                <div class="onboarding-progress">
                    <div class="progress-step active" id="progressStep1">
                        <div class="step-circle"><i class="fas fa-user"></i></div>
                        <span>Profile</span>
                    </div>
                    <div class="progress-line" id="progressLine1"></div>
                    <div class="progress-step" id="progressStep2">
                        <div class="step-circle"><i class="fas fa-briefcase"></i></div>
                        <span>Financial</span>
                    </div>
                    <div class="progress-line" id="progressLine2"></div>
                    <div class="progress-step" id="progressStep3">
                        <div class="step-circle"><i class="fas fa-bullseye"></i></div>
                        <span>Goals</span>
                    </div>
                </div>
            </div>

            <div class="modal-body" style="padding: 2rem;">
                <form id="onboardingForm" onsubmit="handleOnboarding(event)">
                    <!-- Step 1: Basic Info -->
                    <div class="onboarding-step" id="onboardingStep1">
                        <div class="step-header">
                            <h3><i class="fas fa-user-circle" style="color: var(--primary); margin-right: 0.5rem;"></i> Tell us about yourself</h3>
                            <p class="step-subtitle">This helps personalize your Fintpe experience</p>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-id-card"></i> Full Name</label>
                            <input type="text" id="profileName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-calendar-alt"></i> Date of Birth</label>
                                <input type="date" id="profileDOB" required>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-venus-mars"></i> Gender</label>
                                <select id="profileGender">
                                    <option value="">Select</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                    <option value="prefer-not">Prefer not to say</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> Phone Number <span style="color: var(--text-secondary); font-weight: 400;">(Optional)</span></label>
                            <input type="tel" id="profilePhone" placeholder="+91 98765 43210">
                        </div>
                        <button type="button" class="btn btn-primary onboarding-next-btn" onclick="nextOnboardingStep(2)">
                            Continue
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- Step 2: Financial Profile -->
                    <div class="onboarding-step" id="onboardingStep2" style="display: none;">
                        <div class="step-header">
                            <h3><i class="fas fa-wallet" style="color: var(--success); margin-right: 0.5rem;"></i> Your financial profile</h3>
                            <p class="step-subtitle">Helps us provide relevant insights and recommendations</p>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-briefcase"></i> Employment Status</label>
                            <select id="profileEmployment" required>
                                <option value="">Select your status</option>
                                <option value="salaried">Salaried Employee</option>
                                <option value="self-employed">Self Employed</option>
                                <option value="business">Business Owner</option>
                                <option value="freelancer">Freelancer / Consultant</option>
                                <option value="student">Student</option>
                                <option value="retired">Retired</option>
                                <option value="homemaker">Homemaker</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-rupee-sign"></i> Monthly Income Range</label>
                            <select id="profileIncome" required>
                                <option value="">Select income range</option>
                                <option value="0-25000">Below 25,000</option>
                                <option value="25000-50000">25,000 - 50,000</option>
                                <option value="50000-100000">50,000 - 1,00,000</option>
                                <option value="100000-250000">1,00,000 - 2,50,000</option>
                                <option value="250000-500000">2,50,000 - 5,00,000</option>
                                <option value="500000+">Above 5,00,000</option>
                                <option value="prefer-not">Prefer not to say</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-globe"></i> Primary Currency</label>
                            <select id="profileCurrency" required>
                                <option value="INR"> Indian Rupee ()</option>
                                <option value="USD"> US Dollar ($)</option>
                                <option value="EUR"> Euro ()</option>
                                <option value="GBP"> British Pound ()</option>
                                <option value="AED"> UAE Dirham (.)</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" onclick="prevOnboardingStep(1)">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button type="button" class="btn btn-primary" onclick="nextOnboardingStep(3)">
                                Continue <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Goals & Preferences -->
                    <div class="onboarding-step" id="onboardingStep3" style="display: none;">
                        <div class="step-header">
                            <h3><i class="fas fa-flag-checkered" style="color: #f59e0b; margin-right: 0.5rem;"></i> Set your goals</h3>
                            <p class="step-subtitle">What would you like to achieve with Fintpe?</p>
                        </div>

                        <div class="form-group">
                            <label style="margin-bottom: 1rem;"><i class="fas fa-bullseye"></i> Financial Goals <span style="color: var(--text-secondary); font-weight: 400;">(Select all that apply)</span></label>
                            <div class="goals-grid">
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="track-expenses">
                                    <div class="goal-content">
                                        <i class="fas fa-receipt"></i>
                                        <span>Track Expenses</span>
                                    </div>
                                </label>
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="build-savings">
                                    <div class="goal-content">
                                        <i class="fas fa-piggy-bank"></i>
                                        <span>Build Savings</span>
                                    </div>
                                </label>
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="invest">
                                    <div class="goal-content">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Grow Investments</span>
                                    </div>
                                </label>
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="debt-free">
                                    <div class="goal-content">
                                        <i class="fas fa-hand-holding-usd"></i>
                                        <span>Pay Off Debt</span>
                                    </div>
                                </label>
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="retirement">
                                    <div class="goal-content">
                                        <i class="fas fa-umbrella-beach"></i>
                                        <span>Plan Retirement</span>
                                    </div>
                                </label>
                                <label class="goal-card">
                                    <input type="checkbox" name="goals" value="net-worth">
                                    <div class="goal-content">
                                        <i class="fas fa-balance-scale"></i>
                                        <span>Track Net Worth</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-shield-alt"></i> Risk Tolerance</label>
                            <div class="risk-options">
                                <label class="risk-option">
                                    <input type="radio" name="riskTolerance" value="conservative">
                                    <div class="risk-content">
                                        <span class="risk-icon" style="color: #10b981;"></span>
                                        <div>
                                            <strong>Conservative</strong>
                                            <p>Prefer safety over returns</p>
                                        </div>
                                    </div>
                                </label>
                                <label class="risk-option">
                                    <input type="radio" name="riskTolerance" value="moderate" checked>
                                    <div class="risk-content">
                                        <span class="risk-icon" style="color: #f59e0b;"></span>
                                        <div>
                                            <strong>Moderate</strong>
                                            <p>Balance safety and growth</p>
                                        </div>
                                    </div>
                                </label>
                                <label class="risk-option">
                                    <input type="radio" name="riskTolerance" value="aggressive">
                                    <div class="risk-content">
                                        <span class="risk-icon" style="color: #ef4444;"></span>
                                        <div>
                                            <strong>Aggressive</strong>
                                            <p>Higher risk for higher returns</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" onclick="prevOnboardingStep(2)">
                                <i class="fas fa-arrow-left"></i> Back
                            </button>
                            <button type="submit" class="btn btn-primary btn-success-gradient">
                                <i class="fas fa-rocket"></i> Get Started
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="main-content">
        <!-- Dynamic content will be loaded here -->
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Fintpe</h3>
                <p style="color: #9ca3af; margin-bottom: 1rem;">Complete financial management platform for modern India.</p>
                <div style="display: flex; gap: 1rem;">
                    <a href="#" style="color: #9ca3af; font-size: 1.2rem;"><i class="fab fa-twitter"></i></a>
                    <a href="#" style="color: #9ca3af; font-size: 1.2rem;"><i class="fab fa-facebook"></i></a>
                    <a href="#" style="color: #9ca3af; font-size: 1.2rem;"><i class="fab fa-linkedin"></i></a>
                    <a href="#" style="color: #9ca3af; font-size: 1.2rem;"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h3>Products</h3>
                <ul class="footer-links">
                    <li><a href="#">UPI Payments</a></li>
                    <li><a href="#">Account Tracking</a></li>
                    <li><a href="#">Investment Tools</a></li>
                    <li><a href="#">Bill Management</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Resources</h3>
                <ul class="footer-links">
                    <li><a href="#">Help Center</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">API Documentation</a></li>
                    <li><a href="#">Developer Portal</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Company</h3>
                <ul class="footer-links">
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Press</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <p>&copy; 2025 Fintpe. All rights reserved. | Privacy Policy | Terms of Service | Regulated by RBI</p>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span style="color: #9ca3af;"></span>
                    <span style="color: #9ca3af; font-weight: 600;">Made in India for World</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ========== AUTH SYSTEM ==========
        let isLoggedIn = false;
        let currentUser = null;

        // Get all users from localStorage
        function getUsers() {
            return JSON.parse(localStorage.getItem('fintpe_users') || '{}');
        }

        // Save users to localStorage
        function saveUsers(users) {
            localStorage.setItem('fintpe_users', JSON.stringify(users));
        }

        // Get current user profile
        function getUserProfile() {
            if (!currentUser) return null;
            const users = getUsers();
            return users[currentUser]?.profile || null;
        }

        // Save user profile
        function saveUserProfile(profile) {
            if (!currentUser) return;
            const users = getUsers();
            if (users[currentUser]) {
                users[currentUser].profile = profile;
                saveUsers(users);
            }
        }

        // Check if user has completed onboarding
        function hasCompletedOnboarding() {
            const profile = getUserProfile();
            return profile && profile.onboardingComplete;
        }

        // Login Modal Functions
        function openLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'block';
                switchAuthTab('login');
            }
        }

        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
                resetAuthForms();
            }
        }

        function resetAuthForms() {
            document.getElementById('loginForm')?.reset();
            document.getElementById('signupForm')?.reset();
        }

        // Switch between login and signup tabs
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const tabs = document.querySelectorAll('.auth-tab');
            const modalTitle = document.getElementById('modalTitle');
            const modalSubtitle = document.getElementById('modalSubtitle');

            tabs.forEach(t => t.classList.remove('active'));

            if (tab === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
                tabs[0].classList.add('active');
                modalTitle.textContent = 'Welcome back';
                modalSubtitle.textContent = 'Login to your account';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                tabs[1].classList.add('active');
                modalTitle.textContent = 'Create account';
                modalSubtitle.textContent = 'Start managing your finances';
            }
        }

        // Handle Login
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;

            // Debug: Check if function is called
            console.log('=== LOGIN ATTEMPT ===');
            console.log('Email:', email);
            console.log('Password length:', password.length);

            const users = getUsers();
            console.log('Registered users:', Object.keys(users));

            if (!users[email]) {
                showMessage('No account found with this email. Please sign up first.', 'error');
                console.log('User not found:', email);
                return;
            }

            if (users[email].password !== password) {
                showMessage('Incorrect password. Please try again.', 'error');
                console.log('Password mismatch for:', email);
                return;
            }

            console.log('Login successful for:', email);

            // Successful login
            isLoggedIn = true;
            currentUser = email;
            localStorage.setItem('fintpe_current_user', email);

            closeLoginModal();

            // Check if onboarding is needed
            if (!hasCompletedOnboarding()) {
                openOnboardingModal();
            } else {
                loadDashboard();
                updateNavigationForLogin();
                showMessage('Welcome back!', 'success');
            }
        }

        // Handle Signup
        function handleSignup(event) {
            event.preventDefault();
            const email = document.getElementById('signupEmail').value.trim().toLowerCase();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            console.log('Signup attempt for:', email);

            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('Password must be at least 6 characters', 'error');
                return;
            }

            const users = getUsers();

            if (users[email]) {
                showMessage('An account already exists with this email', 'error');
                return;
            }

            // Create new user
            users[email] = {
                password: password,
                createdAt: new Date().toISOString(),
                profile: null
            };
            saveUsers(users);

            console.log('User created:', email);
            console.log('Stored users:', Object.keys(getUsers()));

            // Auto-login after signup
            isLoggedIn = true;
            currentUser = email;
            localStorage.setItem('fintpe_current_user', email);

            closeLoginModal();
            openOnboardingModal();
            showMessage('Account created successfully!', 'success');
        }

        // Onboarding Modal Functions
        function openOnboardingModal() {
            const modal = document.getElementById('onboardingModal');
            if (modal) {
                modal.style.display = 'block';
                showOnboardingStep(1);
            }
        }

        function closeOnboardingModal() {
            const modal = document.getElementById('onboardingModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function showOnboardingStep(step) {
            // Update step content visibility
            for (let i = 1; i <= 3; i++) {
                const stepEl = document.getElementById(`onboardingStep${i}`);
                if (stepEl) {
                    stepEl.style.display = i === step ? 'block' : 'none';
                }

                // Update progress indicator
                const progressStep = document.getElementById(`progressStep${i}`);
                if (progressStep) {
                    progressStep.classList.remove('active', 'completed');
                    if (i < step) {
                        progressStep.classList.add('completed');
                    } else if (i === step) {
                        progressStep.classList.add('active');
                    }
                }

                // Update progress lines
                if (i < 3) {
                    const progressLine = document.getElementById(`progressLine${i}`);
                    if (progressLine) {
                        if (i < step) {
                            progressLine.classList.add('active');
                        } else {
                            progressLine.classList.remove('active');
                        }
                    }
                }
            }
        }

        function nextOnboardingStep(step) {
            // Validate current step before moving
            if (step === 2) {
                const name = document.getElementById('profileName').value;
                const dob = document.getElementById('profileDOB').value;
                if (!name || !dob) {
                    showMessage('Please fill in required fields', 'error');
                    return;
                }
            } else if (step === 3) {
                const employment = document.getElementById('profileEmployment').value;
                const income = document.getElementById('profileIncome').value;
                if (!employment || !income) {
                    showMessage('Please fill in required fields', 'error');
                    return;
                }
            }
            showOnboardingStep(step);
        }

        function prevOnboardingStep(step) {
            showOnboardingStep(step);
        }

        // Handle Onboarding Form Submit
        function handleOnboarding(event) {
            event.preventDefault();

            // Collect all profile data
            const goals = [];
            document.querySelectorAll('input[name="goals"]:checked').forEach(cb => {
                goals.push(cb.value);
            });

            // Get risk tolerance from radio buttons
            const riskRadio = document.querySelector('input[name="riskTolerance"]:checked');
            const riskTolerance = riskRadio ? riskRadio.value : 'moderate';

            const profile = {
                name: document.getElementById('profileName').value,
                dateOfBirth: document.getElementById('profileDOB').value,
                gender: document.getElementById('profileGender').value,
                phone: document.getElementById('profilePhone').value,
                employment: document.getElementById('profileEmployment').value,
                incomeRange: document.getElementById('profileIncome').value,
                currency: document.getElementById('profileCurrency').value,
                goals: goals,
                riskTolerance: riskTolerance,
                onboardingComplete: true,
                updatedAt: new Date().toISOString()
            };

            // Save profile
            saveUserProfile(profile);

            closeOnboardingModal();
            loadDashboard();
            updateNavigationForLogin();
            showMessage(`Welcome, ${profile.name}! Your profile is set up.`, 'success');
        }

        // Show message toast
        function showMessage(message, type = 'info') {
            // Remove existing toasts
            document.querySelectorAll('.toast-message').forEach(t => t.remove());

            const toast = document.createElement('div');
            toast.className = `toast-message toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Update navigation after login
        function updateNavigationForLogin() {
            const loginBtnContainer = document.getElementById('loginBtnContainer');
            const userMenuContainer = document.getElementById('userMenuContainer');
            const userMenuName = document.getElementById('userMenuName');
            const profile = getUserProfile();

            if (loginBtnContainer) {
                loginBtnContainer.style.display = 'none';
            }
            if (userMenuContainer) {
                userMenuContainer.style.display = 'block';
            }
            if (userMenuName && profile?.name) {
                userMenuName.textContent = profile.name.split(' ')[0];
            }
        }

        // Logout function
        function logout() {
            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('fintpe_current_user');

            // Hide user menu, show login button
            const loginBtnContainer = document.getElementById('loginBtnContainer');
            const userMenuContainer = document.getElementById('userMenuContainer');

            if (loginBtnContainer) {
                loginBtnContainer.style.display = 'block';
            }
            if (userMenuContainer) {
                userMenuContainer.style.display = 'none';
            }

            loadPage('landing');
            showMessage('You have been logged out', 'info');
        }

        // Open Rate Chart page
        function openRateChart() {
            loadPage('rate-chart');
        }

        // Open Calculators page
        function openCalculators() {
            loadPage('calculators');
        }

        // Load Dashboard with Family View Support
        function loadDashboard() {
            if (!isLoggedIn || !currentUser) {
                openLoginModal();
                return;
            }

            const financialData = getFinancialData();
            const mainContent = document.getElementById('main-content');
            
            if (mainContent) {
                mainContent.innerHTML = `
                    <div class="dashboard-container" style="display: block;">
                        <div class="dashboard-content">
                            <!-- Dashboard Header with Family Toggle -->
                            <div class="dashboard-header">
                                <div class="dashboard-welcome">
                                    <div>
                                        <h2 style="margin-bottom: 0.5rem;">Welcome to Fintpe! </h2>
                                        <p style="color: var(--text-secondary); margin: 0;">${currentUser || ''}</p>
                                    </div>
                                    <div style="display: flex; gap: 1rem; align-items: center;">
                                        <button onclick="toggleDashboardFamilyView()" class="btn btn-secondary" id="dashboardFamilyToggle">
                                            <i class="fas fa-users"></i>
                                            Family View
                                        </button>
                                        <button onclick="loadPage('account')" class="btn btn-secondary">
                                            <i class="fas fa-user-cog"></i>
                                            My Account
                                        </button>
                                        <button onclick="logout()" class="btn btn-secondary">
                                            <i class="fas fa-sign-out-alt"></i>
                                            Logout
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Individual Dashboard View (Default) -->
                                <div id="dashboardIndividualView">
                                    <!-- Individual Net Worth Card (Top Priority) -->
                                    <div class="dashboard-card" style="background: linear-gradient(135deg, var(--success), #059669); color: white; margin-bottom: 3rem; border: none;">
                                        <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 1rem; margin-bottom: 1.5rem;">
                                            <span class="card-title" style="color: rgba(255,255,255,0.9); font-size: 1.1rem;">YOUR NET WORTH</span>
                                            <div style="display: flex; align-items: center; gap: 1rem;">
                                                <i class="fas fa-user-crown" style="color: #fbbf24; font-size: 1.5rem;"></i>
                                                <button onclick="loadPage('account')" class="insight-arrow-btn" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); color: white;" title="Add your financial details">
                                                    <i class="fas fa-arrow-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-amount" style="font-size: 2.5rem; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">${formatCurrency(financialData.netWorth)}</div>
                                        ${financialData.netWorth === 0 ? `
                                        <div style="margin-top: 1rem; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                                            <i class="fas fa-info-circle"></i> Go to My Account to add your financial details
                                        </div>
                                        ` : `
                                        <div style="margin-top: 1.5rem; font-size: 0.85rem; color: rgba(255,255,255,0.8);">
                                            Assets: ${formatCurrency(financialData.totalAssets)} | Liabilities: ${formatCurrency(financialData.totalLoans)}
                                        </div>
                                        `}
                                    </div>

                                    <div id="donutChartPlaceholder"></div>

                                    <div class="dashboard-cards" style="grid-template-columns: repeat(3, 1fr);">
                                        <div class="dashboard-card" onclick="openBankAccounts()" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">LIQUID BALANCE</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-wallet" style="color: var(--primary);"></i>
                                                    <button onclick="event.stopPropagation(); openBankAccounts()" class="insight-arrow-btn" title="Add bank accounts">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.liquidBalance)}</div>
                                            <div class="card-change ${financialData.liquidBalance > 0 ? 'positive' : ''}">
                                                ${financialData.liquidBalance === 0 ? '<i class="fas fa-plus-circle"></i> Add bank accounts' : '<i class="fas fa-university"></i> From bank accounts'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="openInvestments()" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">INVESTMENTS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-chart-line" style="color: var(--success);"></i>
                                                    <button onclick="event.stopPropagation(); openInvestments()" class="insight-arrow-btn" title="Add investments">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.totalInvestments)}</div>
                                            <div class="card-change ${financialData.totalInvestments > 0 ? 'positive' : ''}">
                                                ${financialData.totalInvestments === 0 ? '<i class="fas fa-plus-circle"></i> Add investments' : '<i class="fas fa-briefcase"></i> Portfolio value'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="openRealEstateGold()" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">REAL ESTATE</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-home" style="color: #f59e0b;"></i>
                                                    <button onclick="event.stopPropagation(); openRealEstateGold()" class="insight-arrow-btn" title="Add property">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.realEstateValue)}</div>
                                            <div class="card-change ${financialData.realEstateValue > 0 ? 'positive' : ''}">
                                                ${financialData.realEstateValue === 0 ? '<i class="fas fa-plus-circle"></i> Add property' : '<i class="fas fa-building"></i> Property value'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="openRealEstateGold()" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">GOLD HOLDINGS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-coins" style="color: #fbbf24;"></i>
                                                    <button onclick="event.stopPropagation(); openRealEstateGold()" class="insight-arrow-btn" title="Add gold">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.goldValue)}</div>
                                            <div class="card-change ${financialData.goldValue > 0 ? 'positive' : ''}">
                                                ${financialData.goldValue === 0 ? '<i class="fas fa-plus-circle"></i> Add gold' : '<i class="fas fa-gem"></i> Gold value'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="openLoans()" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">LOANS & EMIs</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-hand-holding-usd" style="color: #b87070;"></i>
                                                    <button onclick="event.stopPropagation(); openLoans()" class="insight-arrow-btn" title="Add loans">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.totalLoans)}</div>
                                            <div class="card-change ${financialData.totalLoans > 0 ? 'negative' : ''}">
                                                ${financialData.totalLoans === 0 ? '<i class="fas fa-plus-circle"></i> Add loans' : '<i class="fas fa-calendar-check"></i> ' + formatCurrency(financialData.monthlyEmi) + ' monthly EMI'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="loadPage('account'); setTimeout(() => loadAccountSection('esops'), 200);" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">ESOPs</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-briefcase" style="color: #7ba3a8;"></i>
                                                    <button onclick="event.stopPropagation(); loadPage('account'); setTimeout(() => loadAccountSection('esops'), 200);" class="insight-arrow-btn" title="Add ESOPs">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.esopsTotalValue)}</div>
                                            <div class="card-change ${financialData.esopsTotalValue > 0 ? 'positive' : ''}">
                                                ${financialData.esopsTotalValue === 0 ? '<i class="fas fa-plus-circle"></i> Add ESOPs' : '<i class="fas fa-unlock"></i> Vested: ' + formatCurrency(financialData.esopsValue)}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="loadPage('account'); setTimeout(() => loadAccountSection('nps'), 200);" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">NPS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-piggy-bank" style="color: #6b8e7d;"></i>
                                                    <button onclick="event.stopPropagation(); loadPage('account'); setTimeout(() => loadAccountSection('nps'), 200);" class="insight-arrow-btn" title="Add NPS">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.npsValue)}</div>
                                            <div class="card-change ${financialData.npsValue > 0 ? 'positive' : ''}">
                                                ${financialData.npsValue === 0 ? '<i class="fas fa-plus-circle"></i> Add NPS' : '<i class="fas fa-shield-alt"></i> Pension fund'}
                                            </div>
                                        </div>

                                        <div class="dashboard-card" onclick="loadPage('account'); setTimeout(() => loadAccountSection('ppf'), 200);" style="cursor: pointer;">
                                            <div class="card-header">
                                                <span class="card-title">PPF</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-landmark" style="color: #9b8bb8;"></i>
                                                    <button onclick="event.stopPropagation(); loadPage('account'); setTimeout(() => loadAccountSection('ppf'), 200);" class="insight-arrow-btn" title="Add PPF">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount">${formatCurrency(financialData.ppfValue)}</div>
                                            <div class="card-change ${financialData.ppfValue > 0 ? 'positive' : ''}">
                                                ${financialData.ppfValue === 0 ? '<i class="fas fa-plus-circle"></i> Add PPF' : '<i class="fas fa-lock"></i> Tax-free savings'}
                                            </div>
                                        </div>

                                    </div>

                                    <!-- Market Rates Section -->
                                    <div style="margin-top: 2rem;">
                                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <i class="fas fa-chart-bar" style="color: var(--accent);"></i> Market Rates
                                        </h3>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                                            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #92400e; font-weight: 500;">Gold (24K)</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #78350f;">7,850/g</div>
                                                <div style="font-size: 0.7rem; color: #10b981;">+0.32%</div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #4b5563; font-weight: 500;">Silver</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">95.50/g</div>
                                                <div style="font-size: 0.7rem; color: #10b981;">+0.18%</div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #1e40af; font-weight: 500;">USD/INR</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #1e3a8a;">84.35</div>
                                                <div style="font-size: 0.7rem; color: #ef4444;">-0.05%</div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #065f46; font-weight: 500;">FD Rate (SBI)</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #064e3b;">7.10%</div>
                                                <div style="font-size: 0.7rem; color: #6b7280;">1 Year</div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #9d174d; font-weight: 500;">SENSEX</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #831843;">78,472</div>
                                                <div style="font-size: 0.7rem; color: #10b981;">+0.45%</div>
                                            </div>
                                            <div style="background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); padding: 1rem; border-radius: 12px;">
                                                <div style="font-size: 0.75rem; color: #3730a3; font-weight: 500;">NIFTY 50</div>
                                                <div style="font-size: 1.25rem; font-weight: 700; color: #312e81;">23,644</div>
                                                <div style="font-size: 0.7rem; color: #10b981;">+0.38%</div>
                                            </div>
                                        </div>
                                        <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.75rem; text-align: right;">
                                            <i class="fas fa-info-circle"></i> Indicative rates  Updated periodically
                                        </p>
                                    </div>
                                </div>
                            </div>

                                <!-- Family Dashboard View (Hidden by default) -->
                                <div id="dashboardFamilyView" style="display: none;">
                                    <h3 style="color: var(--text-primary); margin-bottom: 2rem;">Family Financial Overview</h3>
                                    
                                    <!-- Family Net Worth Card (Top Priority) -->
                                    <div class="dashboard-card" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; margin-bottom: 3rem; border: none;">
                                        <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 1rem; margin-bottom: 1.5rem;">
                                            <span class="card-title" style="color: rgba(255,255,255,0.9); font-size: 1.1rem;">FAMILY NET WORTH</span>
                                            <div style="display: flex; align-items: center; gap: 1rem;">
                                                <i class="fas fa-crown" style="color: #fbbf24; font-size: 1.5rem;"></i>
                                                <button onclick="openNetWorthInsights()" class="insight-arrow-btn" style="background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.3); color: white;" title="View net worth breakdown">
                                                    <i class="fas fa-arrow-right"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-amount" style="font-size: 3rem; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);" data-private="2,45,67,890" data-placeholder="">2,45,67,890</div>
                                        <div class="card-change positive" style="color: #10f981; font-size: 1.1rem; margin-top: 1rem;">
                                            <i class="fas fa-trending-up"></i>
                                            +4,85,320 this quarter (+2.01%)
                                        </div>
                                        <div style="margin-top: 1.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.8);">
                                            Assets: 2,67,89,450 | Liabilities: 22,21,560 | Growth: +18.5% YoY
                                        </div>
                                    </div>

                                    <!-- Enhanced Family Financial Cards with Insights (7 cards in grid) -->
                                    <div class="dashboard-cards" style="grid-template-columns: repeat(3, 1fr);">
                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">LIQUID ASSETS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-tint" style="color: var(--primary);"></i>
                                                    <button onclick="openFamilyBalanceInsights()" class="insight-arrow-btn" title="View detailed insights">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="18,45,890" data-placeholder="">18,45,890</div>
                                            <div class="card-change positive">
                                                <i class="fas fa-arrow-up"></i>
                                                +32,450 this month
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">INVESTMENTS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-chart-line" style="color: var(--success);"></i>
                                                    <button onclick="openFamilyInvestmentInsights()" class="insight-arrow-btn" title="View investment analysis">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="1,28,54,200" data-placeholder="">1,28,54,200</div>
                                            <div class="card-change positive">
                                                <i class="fas fa-arrow-up"></i>
                                                +15.2% returns (YTD)
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">REAL ESTATE</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-home" style="color: #f59e0b;"></i>
                                                    <button onclick="openRealEstateInsights()" class="insight-arrow-btn" title="View property insights">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="85,50,000" data-placeholder="">85,50,000</div>
                                            <div class="card-change positive">
                                                <i class="fas fa-arrow-up"></i>
                                                +8.5% appreciation
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">GOLD HOLDINGS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-coins" style="color: #fbbf24;"></i>
                                                    <button onclick="openGoldInsights()" class="insight-arrow-btn" title="View gold portfolio">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="12,45,600" data-placeholder="">12,45,600</div>
                                            <div class="card-change positive">
                                                <i class="fas fa-arrow-up"></i>
                                                +12.8% vs purchase
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">FAMILY LOANS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-hand-holding-usd" style="color: #b87070;"></i>
                                                    <button onclick="openFamilyLoansInsights()" class="insight-arrow-btn" title="View all family loans">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="22,21,560" data-placeholder="">22,21,560</div>
                                            <div class="card-change negative">
                                                <i class="fas fa-calendar-minus"></i>
                                                42,850 monthly EMI
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">MONTHLY SPENDING</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-credit-card" style="color: var(--danger);"></i>
                                                    <button onclick="openFamilySpendingInsights()" class="insight-arrow-btn" title="View spending breakdown">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="78,650" data-placeholder="">78,650</div>
                                            <div class="card-change negative">
                                                <i class="fas fa-arrow-down"></i>
                                                -5,200 vs last month
                                            </div>
                                        </div>

                                        <div class="dashboard-card">
                                            <div class="card-header">
                                                <span class="card-title">FINANCIAL GOALS</span>
                                                <div style="display: flex; align-items: center; gap: 1rem;">
                                                    <i class="fas fa-bullseye" style="color: var(--warning);"></i>
                                                    <button onclick="openFamilyGoalsInsights()" class="insight-arrow-btn" title="View goals progress">
                                                        <i class="fas fa-arrow-right"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="card-amount" data-private="2,50,00,000" data-placeholder="">2,50,00,000</div>
                                            <div class="card-change positive">
                                                <i class="fas fa-chart-pie"></i>
                                                72% progress overall
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <h4 style="color: var(--text-primary); margin-bottom: 1.5rem; margin-top: 3rem;">Family Members Portfolio</h4>
                                    <div class="family-members-grid" id="dashboardFamilyMembersContainer">
                                        <div class="family-member-card">
                                            <div class="family-member-avatar">JD</div>
                                            <div class="family-member-name">John Doe</div>
                                            <div class="family-member-role">You (Primary)</div>
                                            <div class="family-member-wealth" data-private="1,25,85,920" data-placeholder="">1,25,85,920</div>
                                            <div style="font-size: 0.8rem; color: var(--success); margin-top: 0.5rem;">+12.5% growth | 51% of family wealth</div>
                                            <button onclick="openMemberInsights('john')" class="member-insight-btn">
                                                <i class="fas fa-chart-bar"></i> View Details
                                            </button>
                                        </div>

                                        <div class="family-member-card">
                                            <div class="family-member-avatar">JD</div>
                                            <div class="family-member-name">Jane Doe</div>
                                            <div class="family-member-role">Spouse</div>
                                            <div class="family-member-wealth" data-private="85,25,470" data-placeholder="">85,25,470</div>
                                            <div style="font-size: 0.8rem; color: var(--success); margin-top: 0.5rem;">+18.2% growth | 35% of family wealth</div>
                                            <button onclick="openMemberInsights('jane')" class="member-insight-btn">
                                                <i class="fas fa-chart-bar"></i> View Details
                                            </button>
                                        </div>

                                        <div class="family-member-card">
                                            <div class="family-member-avatar">AD</div>
                                            <div class="family-member-name">Alex Doe</div>
                                            <div class="family-member-role">Child</div>
                                            <div class="family-member-wealth" data-private="34,56,500" data-placeholder="">34,56,500</div>
                                            <div style="font-size: 0.8rem; color: var(--success); margin-top: 0.5rem;">+25.7% growth | 14% of family wealth</div>
                                            <button onclick="openMemberInsights('alex')" class="member-insight-btn">
                                                <i class="fas fa-chart-bar"></i> View Details
                                            </button>
                                        </div>

                                        <div class="family-member-card add-family-member" onclick="inviteFamilyMember()" style="border: 2px dashed var(--border); cursor: pointer;">
                                            <div style="color: var(--text-secondary); font-size: 2rem; margin-bottom: 1rem;">+</div>
                                            <div class="family-member-name">Invite Member</div>
                                            <div class="family-member-role">Add family member</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="transactions-section">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h4 style="margin: 0; color: var(--text-primary);">Upcoming Events</h4>
                                    <button onclick="openCalendarModal()" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                                        <i class="fas fa-calendar-alt"></i>
                                        View Calendar
                                    </button>
                                </div>
                                <table class="transactions-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Event</th>
                                            <th>Type</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr onclick="showEventDetails('emi')" style="cursor: pointer;">
                                            <td>Jan 25</td>
                                            <td>Home Loan EMI - SBI</td>
                                            <td><span class="transaction-type" style="background: #fef0f0; color: #b87070;">EMI Due</span></td>
                                            <td style="color: var(--danger); font-weight: 600;" data-private="22,450" data-placeholder="">22,450</td>
                                            <td><span style="color: #f59e0b; font-weight: 500;"> Pending</span></td>
                                        </tr>
                                        <tr onclick="showEventDetails('sip')" style="cursor: pointer;">
                                            <td>Jan 28</td>
                                            <td>SIP - Axis Bluechip Fund</td>
                                            <td><span class="transaction-type" style="background: #d1fae5; color: #059669;">SIP</span></td>
                                            <td style="color: var(--success); font-weight: 600;" data-private="15,000" data-placeholder="">15,000</td>
                                            <td><span style="color: var(--success); font-weight: 500;"> Auto-pay</span></td>
                                        </tr>
                                        <tr onclick="showEventDetails('insurance')" style="cursor: pointer;">
                                            <td>Feb 02</td>
                                            <td>Health Insurance Premium - HDFC ERGO</td>
                                            <td><span class="transaction-type" style="background: #e8eff8; color: #6b7280;">Insurance</span></td>
                                            <td style="color: var(--primary); font-weight: 600;" data-private="8,500" data-placeholder="">8,500</td>
                                            <td><span style="color: #f59e0b; font-weight: 500;"> Due Soon</span></td>
                                        </tr>
                                        <tr onclick="showEventDetails('bill')" style="cursor: pointer;">
                                            <td>Feb 05</td>
                                            <td>Postpaid Bill - Airtel</td>
                                            <td><span class="transaction-type" style="background: #fef3c7; color: #f59e0b;">Bill</span></td>
                                            <td style="color: var(--warning); font-weight: 600;" data-private="1,250" data-placeholder="">1,250</td>
                                            <td><span style="color: #059669; font-weight: 500;"> Auto-pay</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;

                // Render donut chart if data exists
                renderDonutChart(financialData);
            }
        }

        function renderDonutChart(data) {
            const container = document.getElementById('donutChartPlaceholder');
            if (!container) return;

            if (data.totalAssets <= 0 && data.totalLoans <= 0) {
                container.innerHTML = '';
                return;
            }

            const total = data.totalAssets + data.totalLoans;
            const assetPercent = total > 0 ? Math.round((data.totalAssets / total) * 100) : 0;
            const assetDash = (assetPercent / 100) * 314;
            const liabilityDash = ((100 - assetPercent) / 100) * 314;

            container.innerHTML = '<div class="donut-chart-container">' +
                '<div class="donut-chart">' +
                    '<svg width="160" height="160" viewBox="0 0 160 160">' +
                        '<circle cx="80" cy="80" r="50" fill="none" stroke="#e5e7eb" stroke-width="20"/>' +
                        '<circle cx="80" cy="80" r="50" fill="none" stroke="#10b981" stroke-width="20" stroke-dasharray="' + assetDash + ' 314" stroke-dashoffset="0"/>' +
                        '<circle cx="80" cy="80" r="50" fill="none" stroke="#ef4444" stroke-width="20" stroke-dasharray="' + liabilityDash + ' 314" stroke-dashoffset="-' + assetDash + '"/>' +
                    '</svg>' +
                    '<div class="donut-chart-center">' +
                        '<div class="value">' + assetPercent + '%</div>' +
                        '<div class="label">Assets</div>' +
                    '</div>' +
                '</div>' +
                '<div class="donut-legend">' +
                    '<div class="donut-legend-item">' +
                        '<div class="legend-label">' +
                            '<span class="legend-dot" style="background: #10b981;"></span>' +
                            '<span class="legend-text">Total Assets</span>' +
                        '</div>' +
                        '<span class="legend-value">' + formatCurrency(data.totalAssets) + '</span>' +
                    '</div>' +
                    '<div class="donut-legend-item">' +
                        '<div class="legend-label">' +
                            '<span class="legend-dot" style="background: #ef4444;"></span>' +
                            '<span class="legend-text">Total Liabilities</span>' +
                        '</div>' +
                        '<span class="legend-value">' + formatCurrency(data.totalLoans) + '</span>' +
                    '</div>' +
                    '<div class="donut-legend-item" style="border-top: 2px solid var(--border); margin-top: 0.5rem; padding-top: 1rem;">' +
                        '<div class="legend-label">' +
                            '<span class="legend-dot" style="background: linear-gradient(135deg, #10b981, #059669);"></span>' +
                            '<span class="legend-text" style="font-weight: 600;">Net Worth</span>' +
                        '</div>' +
                        '<span class="legend-value" style="color: var(--success);">' + formatCurrency(data.netWorth) + '</span>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // Load Page Function
        function loadPage(pageName) {
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;

            if (pageName === 'account') {
                loadAccountPageContent();
            } else if (pageName === 'landing') {
                loadLandingPageContent();
            } else if (pageName === 'rate-chart') {
                loadRateChartPage();
            } else if (pageName === 'calculators') {
                loadCalculatorsPage();
            } else {
                loadLandingPageContent();
            }
        }

        // Load Rate Chart Page
        function loadRateChartPage() {
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;

            mainContent.innerHTML = `
                <section class="account-section">
                    <div class="account-container">
                        <div class="profile-header">
                            <div class="profile-info" style="flex: 1;">
                                <h1 class="profile-name" style="margin-bottom: 0;">Rate Chart</h1>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Market rates and bank interest rates</p>
                            </div>
                            <button onclick="loadDashboard()" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                                <i class="fas fa-arrow-left"></i> Dashboard
                            </button>
                        </div>

                        <div style="margin-top: 1.5rem;">
                                <!-- Commodities -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title"><i class="fas fa-coins"></i> Commodities</h3>
                                    <div class="rate-table">
                                        <div class="rate-row">
                                            <span class="rate-name">Gold (24K)</span>
                                            <span class="rate-unit">per 10g</span>
                                            <span class="rate-value">78,450</span>
                                            <span class="rate-change positive">+0.45%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">Gold (22K)</span>
                                            <span class="rate-unit">per 10g</span>
                                            <span class="rate-value">71,880</span>
                                            <span class="rate-change positive">+0.42%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">Silver</span>
                                            <span class="rate-unit">per kg</span>
                                            <span class="rate-value">92,500</span>
                                            <span class="rate-change positive">+0.32%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Currency Rates -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title"><i class="fas fa-exchange-alt"></i> Currency Rates</h3>
                                    <div class="rate-table">
                                        <div class="rate-row">
                                            <span class="rate-name">US Dollar (USD)</span>
                                            <span class="rate-unit">1 USD</span>
                                            <span class="rate-value">83.42</span>
                                            <span class="rate-change positive">+0.12%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">Euro (EUR)</span>
                                            <span class="rate-unit">1 EUR</span>
                                            <span class="rate-value">90.15</span>
                                            <span class="rate-change negative">-0.08%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">British Pound (GBP)</span>
                                            <span class="rate-unit">1 GBP</span>
                                            <span class="rate-value">105.20</span>
                                            <span class="rate-change positive">+0.15%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">Japanese Yen (JPY)</span>
                                            <span class="rate-unit">100 JPY</span>
                                            <span class="rate-value">55.80</span>
                                            <span class="rate-change negative">-0.22%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Bank Rates -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title"><i class="fas fa-university"></i> Bank Interest Rates</h3>
                                    <div class="rate-table">
                                        <div class="rate-row">
                                            <span class="rate-name">SBI FD Rate</span>
                                            <span class="rate-unit">1 Year</span>
                                            <span class="rate-value">7.10%</span>
                                            <span class="rate-change neutral">-</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">HDFC FD Rate</span>
                                            <span class="rate-unit">1 Year</span>
                                            <span class="rate-value">7.25%</span>
                                            <span class="rate-change neutral">-</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">ICICI FD Rate</span>
                                            <span class="rate-unit">1 Year</span>
                                            <span class="rate-value">7.20%</span>
                                            <span class="rate-change neutral">-</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">PPF Rate</span>
                                            <span class="rate-unit">Current</span>
                                            <span class="rate-value">7.10%</span>
                                            <span class="rate-change neutral">-</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">NSC Rate</span>
                                            <span class="rate-unit">5 Year</span>
                                            <span class="rate-value">7.70%</span>
                                            <span class="rate-change neutral">-</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Market Indices -->
                                <div class="settings-section">
                                    <h3 class="settings-section-title"><i class="fas fa-chart-line"></i> Market Indices</h3>
                                    <div class="rate-table">
                                        <div class="rate-row">
                                            <span class="rate-name">SENSEX</span>
                                            <span class="rate-unit">BSE</span>
                                            <span class="rate-value">72,568.45</span>
                                            <span class="rate-change positive">+1.25%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">NIFTY 50</span>
                                            <span class="rate-unit">NSE</span>
                                            <span class="rate-value">21,845.30</span>
                                            <span class="rate-change positive">+1.18%</span>
                                        </div>
                                        <div class="rate-row">
                                            <span class="rate-name">NIFTY Bank</span>
                                            <span class="rate-unit">NSE</span>
                                            <span class="rate-value">46,125.80</span>
                                            <span class="rate-change positive">+0.95%</span>
                                        </div>
                                    </div>
                                </div>

                                <p style="text-align: center; color: var(--text-secondary); font-size: 0.85rem; margin-top: 1.5rem;">
                                    <i class="fas fa-info-circle"></i> Rates are indicative and may vary. Last updated: Today
                                </p>
                        </div>
                    </div>
                </section>
            `;
        }

        // Load Calculators Page
        function loadCalculatorsPage() {
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;

            mainContent.innerHTML = `
                <section class="account-section">
                    <div class="account-container">
                        <div class="profile-header">
                            <div class="profile-info" style="flex: 1;">
                                <h1 class="profile-name" style="margin-bottom: 0;">Calculators</h1>
                                <p style="color: var(--text-secondary); margin: 0; font-size: 0.9rem;">Financial planning tools</p>
                            </div>
                            <button onclick="loadDashboard()" class="btn btn-secondary" style="padding: 0.5rem 1rem;">
                                <i class="fas fa-arrow-left"></i> Dashboard
                            </button>
                        </div>

                        <div style="margin-top: 1.5rem;">
                                <div class="settings-section">
                                    <div class="rate-table">
                                        <div class="rate-row" onclick="openSIPCalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-chart-line" style="color: var(--primary); margin-right: 0.5rem;"></i> SIP Calculator</span>
                                            <span class="rate-unit">Mutual Funds</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Calculate returns</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                        <div class="rate-row" onclick="openEMICalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-home" style="color: var(--primary); margin-right: 0.5rem;"></i> EMI Calculator</span>
                                            <span class="rate-unit">Loans</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Calculate EMI</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                        <div class="rate-row" onclick="openFDCalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-university" style="color: var(--primary); margin-right: 0.5rem;"></i> FD Calculator</span>
                                            <span class="rate-unit">Fixed Deposit</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Calculate maturity</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                        <div class="rate-row" onclick="openPPFCalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-piggy-bank" style="color: var(--primary); margin-right: 0.5rem;"></i> PPF Calculator</span>
                                            <span class="rate-unit">Public Provident Fund</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Calculate returns</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                        <div class="rate-row" onclick="openRetirementCalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-umbrella-beach" style="color: var(--primary); margin-right: 0.5rem;"></i> Retirement Calculator</span>
                                            <span class="rate-unit">Planning</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Plan corpus</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                        <div class="rate-row" onclick="openTaxCalculator()" style="cursor: pointer;">
                                            <span class="rate-name"><i class="fas fa-receipt" style="color: var(--primary); margin-right: 0.5rem;"></i> Tax Calculator</span>
                                            <span class="rate-unit">Income Tax</span>
                                            <span class="rate-value" style="color: var(--text-secondary);">Old vs New regime</span>
                                            <span class="rate-change"><i class="fas fa-chevron-right"></i></span>
                                        </div>
                                    </div>
                                </div>

                                <p style="text-align: center; color: var(--text-secondary); font-size: 0.85rem; margin-top: 1.5rem;">
                                    <i class="fas fa-info-circle"></i> Calculators coming soon! Stay tuned.
                                </p>
                        </div>
                    </div>
                </section>
            `;
        }

        // Placeholder calculator functions
        function openSIPCalculator() { showMessage('SIP Calculator coming soon!', 'info'); }
        function openEMICalculator() { showMessage('EMI Calculator coming soon!', 'info'); }
        function openFDCalculator() { showMessage('FD Calculator coming soon!', 'info'); }
        function openPPFCalculator() { showMessage('PPF Calculator coming soon!', 'info'); }
        function openRetirementCalculator() { showMessage('Retirement Calculator coming soon!', 'info'); }
        function openTaxCalculator() { showMessage('Tax Calculator coming soon!', 'info'); }

        // Load Landing Page
        function loadLandingPageContent() {
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.innerHTML = `
                    <section class="hero">
                        <!-- Animated background layers -->
                        <div class="hero-gradient"></div>
                        <div class="hero-grid"></div>
                        <div class="hero-orb hero-orb-1"></div>
                        <div class="hero-orb hero-orb-2"></div>
                        <div class="hero-orb hero-orb-3"></div>

                        <div class="hero-content">
                            <p class="hero-eyebrow">Now in Beta</p>
                            <h1 class="hero-title">Your money.<br><span class="hero-title-gradient">Your way.</span></h1>
                            <p class="hero-subtitle">The private finance platform for people who want control. Track everything, share nothing.</p>
                            <div class="cta-buttons">
                                <button onclick="openLoginModal()" class="btn btn-primary">
                                    Start for free
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                                <button onclick="openProductsModal()" class="btn btn-secondary">
                                    <i class="fas fa-play"></i>
                                    Watch demo
                                </button>
                            </div>
                            <div class="hero-stats">
                                <div class="hero-stat">
                                    <div class="hero-stat-value" data-count="100">100%</div>
                                    <div class="hero-stat-label">Private</div>
                                </div>
                                <div class="hero-stat">
                                    <div class="hero-stat-value">0</div>
                                    <div class="hero-stat-label">Data shared</div>
                                </div>
                                <div class="hero-stat">
                                    <div class="hero-stat-value"></div>
                                    <div class="hero-stat-label">Control</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="features-section">
                        <div class="section-header animate-on-scroll">
                            <h2 class="section-title">Everything in one place</h2>
                            <p class="section-subtitle">Track all your finances without the noise. No ads, no upsells, no distractions.</p>
                        </div>

                        <div class="features-grid animate-stagger">
                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(2, 3, 71, 0.08); color: var(--primary);">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <h3 class="feature-title">Net Worth Dashboard</h3>
                                <p class="feature-description">See your complete financial picture at a glance. Cash, investments, property, gold  everything in one beautiful dashboard.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                    <i class="fas fa-university"></i>
                                </div>
                                <h3 class="feature-title">All Accounts Together</h3>
                                <p class="feature-description">Bank accounts, credit cards, fixed deposits, PPF, NPS  track all your accounts manually without linking credentials.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3 class="feature-title">Investment Tracker</h3>
                                <p class="feature-description">Monitor mutual funds, stocks, SIPs, and crypto. Track performance over time without sharing login credentials.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(2, 3, 71, 0.06); color: var(--primary);">
                                    <i class="fas fa-receipt"></i>
                                </div>
                                <h3 class="feature-title">Expense Insights</h3>
                                <p class="feature-description">Understand where your money goes. Categorize spending and spot trends with simple, visual analytics.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(236, 72, 153, 0.1); color: #ec4899;">
                                    <i class="fas fa-bell"></i>
                                </div>
                                <h3 class="feature-title">Bill Reminders</h3>
                                <p class="feature-description">Never miss a payment. Set reminders for EMIs, subscriptions, and recurring bills on your terms.</p>
                            </div>

                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(20, 184, 166, 0.1); color: #14b8a6;">
                                    <i class="fas fa-history"></i>
                                </div>
                                <h3 class="feature-title">Wealth Timeline</h3>
                                <p class="feature-description">Watch your net worth grow over months and years. Visual charts show your financial progress over time.</p>
                            </div>
                        </div>
                    </section>

                    <!-- Goals & Planning Section -->
                    <section class="features-section" id="goals">
                        <div class="section-header animate-on-scroll">
                            <h2 class="section-title">Plan Your Financial Future</h2>
                            <p class="section-subtitle">Set goals, track progress, and build wealth on your own terms. No advisors pushing products.</p>
                        </div>
                        <div class="features-grid animate-stagger">
                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(2, 3, 71, 0.08); color: var(--primary);">
                                    <i class="fas fa-bullseye"></i>
                                </div>
                                <h3 class="feature-title">Goal Tracking</h3>
                                <p class="feature-description">Set savings goals, debt payoff targets, and investment milestones. Visual progress bars show exactly where you stand.</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
                                    <i class="fas fa-piggy-bank"></i>
                                </div>
                                <h3 class="feature-title">Budget Templates</h3>
                                <p class="feature-description">Choose from 50/30/20, zero-based, or envelope budgeting. Or create your own custom budget that fits your life.</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">
                                    <i class="fas fa-chart-area"></i>
                                </div>
                                <h3 class="feature-title">Net Worth History</h3>
                                <p class="feature-description">Track your net worth over time with interactive charts. See trends, milestones, and growth at a glance.</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon" style="background: rgba(2, 3, 71, 0.06); color: var(--primary);">
                                    <i class="fas fa-plus-circle"></i>
                                </div>
                                <h3 class="feature-title">Manual Entry</h3>
                                <p class="feature-description">Add any asset manually  property, crypto, gold, cash, collectibles. Your complete wealth picture, not just bank accounts.</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon" style="background: #f3e8ff; color: #a855f7;">
                                    <i class="fas fa-tags"></i>
                                </div>
                                <h3 class="feature-title">Custom Categories</h3>
                                <p class="feature-description">Create your own expense categories that match how you think about money. No forced categorization.</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon" style="background: #fecaca; color: var(--danger);">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <h3 class="feature-title">Multi-Currency</h3>
                                <p class="feature-description">Track assets in any currency. Perfect for international investments, travel funds, or overseas accounts.</p>
                            </div>
                        </div>
                    </section>

                    <!-- DIY Tools Section -->
                    <section class="features-section" id="tools" style="background: var(--white);">
                        <h2 class="section-title">Built for DIY Finance</h2>
                        <p class="section-subtitle">Your data, your control. Import, export, backup  do it yourself, your way.</p>
                        <div style="max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                            <div style="background: var(--light); border-radius: 16px; padding: 2rem; border: 2px dashed var(--border); text-align: center;">
                                <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #8b7355 0%, #a68b5b 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem;">
                                    <i class="fas fa-file-csv" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <h3 style="font-size: 1.15rem; font-weight: 600; margin-bottom: 0.5rem;">CSV Import/Export</h3>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">Import from any bank, app, or spreadsheet. Export everything to CSV anytime.</p>
                            </div>
                            <div style="background: var(--light); border-radius: 16px; padding: 2rem; border: 2px dashed var(--border); text-align: center;">
                                <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #6b8e7d 0%, #7fa090 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem;">
                                    <i class="fas fa-wifi-slash" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <h3 style="font-size: 1.15rem; font-weight: 600; margin-bottom: 0.5rem;">Works Offline</h3>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">No internet? No problem. Full functionality offline with local storage.</p>
                            </div>
                            <div style="background: var(--light); border-radius: 16px; padding: 2rem; border: 2px dashed var(--border); text-align: center;">
                                <div style="width: 64px; height: 64px; background: linear-gradient(135deg, #8b9dc3 0%, #a3b5d8 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.25rem;">
                                    <i class="fas fa-cloud-download-alt" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <h3 style="font-size: 1.15rem; font-weight: 600; margin-bottom: 0.5rem;">Data Backup</h3>
                                <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;">Download your complete data as JSON. Restore anytime, anywhere.</p>
                            </div>
                        </div>
                        <div style="max-width: 800px; margin: 3rem auto 0; background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%); border-radius: 16px; padding: 2rem 3rem; display: flex; align-items: center; justify-content: space-between; gap: 2rem; flex-wrap: wrap;">
                            <div>
                                <h3 style="color: white; font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-user-slash" style="margin-right: 0.5rem; color: #d1d5db;"></i>
                                    No Account Required
                                </h3>
                                <p style="color: #d1d5db; font-size: 0.95rem; margin: 0;">Start using immediately. All data stored locally on your device.</p>
                            </div>
                            <button class="btn btn-primary" onclick="openLoginModal()">Try Without Signup</button>
                        </div>
                    </section>

                    <!-- Trust Section -->
                    <section class="features-section" id="trust">
                        <h2 class="section-title">Transparent by Design</h2>
                        <p class="section-subtitle">Know exactly what's running on your device. No hidden code, no surprise data collection.</p>
                        <div style="max-width: 900px; margin: 0 auto;">
                            <div style="background: var(--white); border-radius: 16px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 1.5rem;">
                                <div style="padding: 1.5rem 2rem; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 1rem;">
                                    <div style="width: 48px; height: 48px; background: #0f172a; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fab fa-github" style="color: white; font-size: 1.5rem;"></i>
                                    </div>
                                    <div>
                                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">Open Source Components</h3>
                                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin: 0;">See exactly what code runs on your device</p>
                                    </div>
                                </div>
                                <div style="padding: 1.5rem 2rem; background: var(--light); display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-check" style="color: var(--success);"></i>
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">No third-party analytics</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-check" style="color: var(--success);"></i>
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">No tracking pixels</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-check" style="color: var(--success);"></i>
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">No ad networks</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <i class="fas fa-check" style="color: var(--success);"></i>
                                        <span style="color: var(--text-secondary); font-size: 0.9rem;">No data brokers</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Privacy Section -->
                    <section class="security-section">
                        <h2 class="section-title">Privacy First. Always.</h2>
                        <p class="section-subtitle">Your financial data belongs to you. We don't track, sell, or share it. Ever.</p>
                        <div class="security-features">
                            <div class="security-card">
                                <div class="security-icon">
                                    <i class="fas fa-eye-slash"></i>
                                </div>
                                <h3>No Data Tracking</h3>
                                <p>Zero analytics, no behavioral profiling, no third-party trackers.</p>
                            </div>
                            <div class="security-card">
                                <div class="security-icon">
                                    <i class="fas fa-database"></i>
                                </div>
                                <h3>Local-First Storage</h3>
                                <p>Your data stays on your device. You decide what syncs.</p>
                            </div>
                            <div class="security-card">
                                <div class="security-icon">
                                    <i class="fas fa-ban"></i>
                                </div>
                                <h3>No Spam. Ever.</h3>
                                <p>No marketing emails, no promotional notifications.</p>
                            </div>
                            <div class="security-card">
                                <div class="security-icon">
                                    <i class="fas fa-file-export"></i>
                                </div>
                                <h3>Export Anytime</h3>
                                <p>Your data, your rules. Export everything whenever you want.</p>
                            </div>
                        </div>
                    </section>
                `;
            }
        }

        // Load Account Page
        let activeAccountSection = 'bankAccounts';

        function loadAccountPageContent() {
            const mainContent = document.getElementById('main-content');
            if (mainContent) {
                mainContent.innerHTML = `
                    <section class="account-section">
                        <div class="account-container">
                            <div class="profile-header" style="margin-bottom: 0;">
                                <div class="profile-avatar">
                                    <div class="avatar-circle" id="userAvatar">
                                        <span id="avatarInitials">U</span>
                                    </div>
                                </div>
                                <div class="profile-info">
                                    <h1 class="profile-name" id="profileDisplayName">Hi, User</h1>
                                    <div class="account-status-alert">
                                        <i class="fas fa-info-circle"></i>
                                        <button onclick="openProfileSetupModal()" class="btn-complete">Complete your profile</button>
                                    </div>
                                </div>
                            </div>

                            <div class="account-settings-layout">
                                <div class="account-sidebar">
                                    <div class="account-sidebar-header">Settings</div>
                                    <div class="account-management-grid">
                                        <div class="account-card" data-section="bankAccounts" onclick="loadAccountSection('bankAccounts')">
                                            <div class="card-icon" style="color: #6b8e7d;"><i class="fas fa-university"></i></div>
                                            <div class="card-content"><h3>Bank Accounts</h3></div>
                                        </div>
                                        <div class="account-card" data-section="myProfile" onclick="loadAccountSection('myProfile')">
                                            <div class="card-icon" style="color: #8b7355;"><i class="fas fa-user-circle"></i></div>
                                            <div class="card-content"><h3>My Profile</h3></div>
                                        </div>
                                        <div class="account-card" data-section="investments" onclick="loadAccountSection('investments')">
                                            <div class="card-icon" style="color: #9b8bb8;"><i class="fas fa-chart-line"></i></div>
                                            <div class="card-content"><h3>Investments</h3></div>
                                        </div>
                                        <div class="account-card" data-section="realEstateGold" onclick="loadAccountSection('realEstateGold')">
                                            <div class="card-icon" style="color: #c9a86c;"><i class="fas fa-gem"></i></div>
                                            <div class="card-content"><h3>Real Estate & Gold</h3></div>
                                        </div>
                                        <div class="account-card" data-section="loans" onclick="loadAccountSection('loans')">
                                            <div class="card-icon" style="color: #b87070;"><i class="fas fa-hand-holding-usd"></i></div>
                                            <div class="card-content"><h3>Loans & EMIs</h3></div>
                                        </div>
                                        <div class="account-card" data-section="insurance" onclick="loadAccountSection('insurance')">
                                            <div class="card-icon" style="color: #6b8e7d;"><i class="fas fa-shield-alt"></i></div>
                                            <div class="card-content"><h3>Insurance</h3></div>
                                        </div>
                                        <div class="account-card" data-section="calendarReminders" onclick="loadAccountSection('calendarReminders')">
                                            <div class="card-icon" style="color: #8aa876;"><i class="fas fa-calendar-alt"></i></div>
                                            <div class="card-content"><h3>Calendar & Reminders</h3></div>
                                        </div>
                                        <div class="account-card" data-section="taxServices" onclick="loadAccountSection('taxServices')">
                                            <div class="card-icon" style="color: #c9a86c;"><i class="fas fa-file-invoice-dollar"></i></div>
                                            <div class="card-content"><h3>Tax Services</h3></div>
                                        </div>
                                        <div class="account-card" data-section="esops" onclick="loadAccountSection('esops')">
                                            <div class="card-icon" style="color: #7ba3a8;"><i class="fas fa-briefcase"></i></div>
                                            <div class="card-content"><h3>ESOPs</h3></div>
                                        </div>
                                        <div class="account-card" data-section="nps" onclick="loadAccountSection('nps')">
                                            <div class="card-icon" style="color: #6b8e7d;"><i class="fas fa-piggy-bank"></i></div>
                                            <div class="card-content"><h3>NPS</h3></div>
                                        </div>
                                        <div class="account-card" data-section="ppf" onclick="loadAccountSection('ppf')">
                                            <div class="card-icon" style="color: #9b8bb8;"><i class="fas fa-landmark"></i></div>
                                            <div class="card-content"><h3>PPF</h3></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-content-panel" id="accountContentPanel">
                                    <div class="account-content-header">
                                        <h3 id="accountPanelTitle">Bank Accounts</h3>
                                        <p id="accountPanelSubtitle">Manage your linked bank accounts and balances</p>
                                    </div>
                                    <div class="account-content-body" id="accountPanelBody">
                                        <!-- Content loads here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                `;
                
                setTimeout(() => {
                    loadStoredProfileDetails();
                    setUserInfo();
                    setupProfileDetailsForm();
                    initializeEnhancedFeatures();
                    loadAccountSection('bankAccounts');
                }, 100);
            }
        }

        function loadAccountSection(sectionKey) {
            activeAccountSection = sectionKey;

            // Update active state in sidebar
            document.querySelectorAll('.account-card').forEach(card => {
                card.classList.toggle('active', card.dataset.section === sectionKey);
            });

            const titleEl = document.getElementById('accountPanelTitle');
            const subtitleEl = document.getElementById('accountPanelSubtitle');
            const bodyEl = document.getElementById('accountPanelBody');

            const sectionInfo = {
                bankAccounts: { title: 'Bank Accounts', subtitle: 'Manage your linked bank accounts and balances', key: 'bankAccounts' },
                myProfile: { title: 'My Profile', subtitle: 'Personal details, contact information', key: null },
                investments: { title: 'Investments', subtitle: 'Upload broker files to track your portfolio', key: 'investments' },
                realEstateGold: { title: 'Real Estate & Gold', subtitle: 'Property and gold investment tracking', key: 'realEstateGold' },
                loans: { title: 'Loans & EMIs', subtitle: 'Track your loans, EMIs and outstanding balances', key: 'loans' },
                insurance: { title: 'Insurance', subtitle: 'Health, life and motor insurance policies', key: 'insurance' },
                calendarReminders: { title: 'Calendar & Reminders', subtitle: 'SIP dates, bill payments and notifications', key: 'calendarReminders' },
                taxServices: { title: 'Tax Services', subtitle: 'ITR filing and tax planning', key: 'taxServices' },
                esops: { title: 'ESOPs', subtitle: 'Track employee stock options and vesting', key: 'esops' },
                nps: { title: 'NPS', subtitle: 'National Pension System contributions', key: 'nps' },
                ppf: { title: 'PPF', subtitle: 'Public Provident Fund balance tracking', key: 'ppf' }
            };

            const info = sectionInfo[sectionKey];
            if (titleEl) titleEl.textContent = info.title;
            if (subtitleEl) subtitleEl.textContent = info.subtitle;

            // Load content based on section
            if (sectionKey === 'investments') {
                loadInvestmentPanelContent(bodyEl);
            } else if (sectionKey === 'myProfile') {
                loadProfilePanelContent(bodyEl);
            } else if (info.key && ACCOUNT_MANAGEMENT_SECTIONS[info.key]) {
                loadManagementPanelContent(bodyEl, info.key);
            }
        }

        function loadManagementPanelContent(container, sectionKey) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;

            const formId = sectionKey + 'InlineForm';
            const recordsId = sectionKey + 'InlineRecords';

            const fieldsHtml = config.fields.map(function(field) {
                return buildManagementField(field, sectionKey);
            }).join('');

            container.innerHTML = '<div id="' + recordsId + '" class="management-records" style="margin-bottom: 1rem;"></div>' +
                '<button type="button" class="btn btn-primary" style="margin-bottom: 1rem;" onclick="toggleInlineForm(\'' + sectionKey + '\')">' +
                '<i class="fas fa-plus"></i> Add New</button>' +
                '<div id="' + sectionKey + 'InlineFormWrapper" style="display: none;">' +
                '<form id="' + formId + '" class="management-form" style="background: var(--light); padding: 1.25rem; border-radius: 12px;">' +
                '<h4 id="' + sectionKey + 'InlineFormTitle" style="margin: 0 0 1rem 0; font-size: 1rem;">' + config.formTitle + '</h4>' +
                '<div class="form-fields-grid">' + fieldsHtml + '</div>' +
                '<input type="hidden" id="' + sectionKey + 'InlineEditIndex" value="-1">' +
                '<div class="form-actions-row">' +
                '<button type="button" class="btn btn-secondary" onclick="toggleInlineForm(\'' + sectionKey + '\', false)">Cancel</button>' +
                '<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>' +
                '</div></form></div>';

            renderInlineRecords(sectionKey);
            attachInlineForm(sectionKey);
        }

        function toggleInlineForm(sectionKey, show) {
            if (show === undefined) show = true;
            const wrapper = document.getElementById(sectionKey + 'InlineFormWrapper');
            const form = document.getElementById(sectionKey + 'InlineForm');
            const editField = document.getElementById(sectionKey + 'InlineEditIndex');
            if (wrapper) {
                wrapper.style.display = show ? 'block' : 'none';
                if (!show && form) {
                    form.reset();
                    if (editField) editField.value = '-1';
                }
            }
        }

        function renderInlineRecords(sectionKey) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;
            const container = document.getElementById(sectionKey + 'InlineRecords');
            if (!container) return;

            const data = getAccountManagementData(sectionKey);
            if (!data.length) {
                container.innerHTML = '<div class="management-empty-state"><i class="fas fa-inbox" style="font-size: 1.5rem; color: var(--text-secondary); margin-bottom: 0.75rem;"></i><p style="font-size: 0.9rem;">' + config.emptyState + '</p></div>';
                return;
            }

            const displayFields = config.fields.filter(function(f) { return f.name !== 'notes'; }).slice(0, 4);
            let html = '<table class="records-table"><thead><tr>';
            displayFields.forEach(function(f) { html += '<th>' + f.label + '</th>'; });
            html += '<th style="width: 100px;">Actions</th></tr></thead><tbody>';

            data.forEach(function(entry, index) {
                html += '<tr>';
                displayFields.forEach(function(field) {
                    html += '<td>' + formatManagementValue(field, entry[field.name] || '-') + '</td>';
                });
                html += '<td class="actions-cell">' +
                    '<button type="button" class="icon-btn edit" onclick="editInlineRecord(\'' + sectionKey + '\', ' + index + ')" title="Edit"><i class="fas fa-pen"></i></button>' +
                    '<button type="button" class="icon-btn delete" onclick="deleteInlineRecord(\'' + sectionKey + '\', ' + index + ')" title="Delete"><i class="fas fa-trash"></i></button>' +
                '</td></tr>';
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function attachInlineForm(sectionKey) {
            const form = document.getElementById(sectionKey + 'InlineForm');
            if (!form) return;

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
                const editIndexField = document.getElementById(sectionKey + 'InlineEditIndex');
                const editIndex = editIndexField ? parseInt(editIndexField.value, 10) : -1;

                const formData = {};
                config.fields.forEach(function(field) {
                    const element = form.elements[field.name];
                    if (element) formData[field.name] = element.value;
                });

                const data = getAccountManagementData(sectionKey);
                if (editIndex >= 0 && data[editIndex]) {
                    data[editIndex] = formData;
                } else {
                    data.push(formData);
                }
                saveAccountManagementData(sectionKey, data);
                renderInlineRecords(sectionKey);
                form.reset();
                if (editIndexField) editIndexField.value = -1;
                toggleInlineForm(sectionKey, false);
                showSuccessMessage(editIndex >= 0 ? 'Updated' : 'Saved');
                setTimeout(function() { loadDashboard(); }, 500);
            });
        }

        function editInlineRecord(sectionKey, index) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            const data = getAccountManagementData(sectionKey);
            if (!data[index]) return;

            toggleInlineForm(sectionKey, true);
            const form = document.getElementById(sectionKey + 'InlineForm');
            const editField = document.getElementById(sectionKey + 'InlineEditIndex');

            config.fields.forEach(function(field) {
                const element = form.elements[field.name];
                if (element) element.value = data[index][field.name] || '';
            });
            if (editField) editField.value = index;
        }

        function deleteInlineRecord(sectionKey, index) {
            if (!confirm('Delete this entry?')) return;
            const data = getAccountManagementData(sectionKey);
            data.splice(index, 1);
            saveAccountManagementData(sectionKey, data);
            renderInlineRecords(sectionKey);
            showSuccessMessage('Deleted');
        }

        function loadInvestmentPanelContent(container) {
            selectedBroker = null;
            currentPortfolioTab = 'all';

            container.innerHTML = '<div class="broker-upload-section" style="margin-bottom: 1.5rem;">' +
                '<p style="margin: 0 0 1rem 0; font-weight: 500; font-size: 0.9rem;">Select broker and upload holdings:</p>' +
                '<div class="broker-selection" style="margin-bottom: 1rem;">' +
                    '<button type="button" class="broker-btn" data-broker="zerodha" onclick="selectBroker(\'zerodha\')">' +
                        '<span class="broker-icon zerodha">Z</span>Zerodha</button>' +
                    '<button type="button" class="broker-btn" data-broker="groww" onclick="selectBroker(\'groww\')">' +
                        '<span class="broker-icon groww">G</span>Groww</button>' +
                '</div>' +
                '<div class="file-upload-area" id="fileUploadArea" style="padding: 1.5rem;">' +
                    '<i class="fas fa-cloud-upload-alt" style="font-size: 2rem;"></i>' +
                    '<p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">Drop Excel file or <span class="browse-link">browse</span></p>' +
                    '<input type="file" id="csvFileInput" accept=".xlsx,.xls,.csv" />' +
                '</div>' +
            '</div>' +
            '<div id="portfolioDataSection"></div>';

            attachPortfolioEventListeners();
            renderPortfolioData();
        }

        function loadProfilePanelContent(container) {
            const profile = JSON.parse(localStorage.getItem('fintpe_profile_details') || '{}');
            container.innerHTML = '<form id="inlineProfileForm">' +
                '<div class="form-fields-grid">' +
                    '<div class="management-field"><label>Full Name</label><input type="text" name="fullName" value="' + (profile.fullName || '') + '"></div>' +
                    '<div class="management-field"><label>Email</label><input type="email" name="email" value="' + (currentUser || '') + '" readonly style="background: var(--light);"></div>' +
                    '<div class="management-field"><label>Phone</label><input type="tel" name="phone" value="' + (profile.phone || '') + '"></div>' +
                    '<div class="management-field"><label>Date of Birth</label><input type="date" name="dob" value="' + (profile.dob || '') + '"></div>' +
                    '<div class="management-field"><label>PAN Number</label><input type="text" name="pan" value="' + (profile.pan || '') + '" placeholder="ABCDE1234F"></div>' +
                    '<div class="management-field"><label>Occupation</label><input type="text" name="occupation" value="' + (profile.occupation || '') + '"></div>' +
                '</div>' +
                '<div style="margin-top: 1.5rem;"><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Profile</button></div>' +
            '</form>';

            document.getElementById('inlineProfileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const data = {};
                formData.forEach(function(value, key) { data[key] = value; });
                localStorage.setItem('fintpe_profile_details', JSON.stringify(data));
                showSuccessMessage('Profile saved');
            });
        }

        // Services Modal
        function openProductsModal() {
            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('serviceModalTitle');
            const subtitle = document.getElementById('serviceModalSubtitle');
            const body = document.getElementById('serviceModalBody');
            
            title.textContent = 'Fintpe Products';
            subtitle.textContent = 'Complete financial services for modern India';
            body.innerHTML = `
                <div class="service-grid">
                    <div class="service-item" onclick="alert('Financial Calculators coming soon!')">
                        <h4><i class="fas fa-calculator"></i> Financial Calculators</h4>
                        <p>EMI, SIP, FD, PPF, Retirement & Tax calculators</p>
                    </div>
                    <div class="service-item" onclick="alert('UPI Payments coming soon!')">
                        <h4><i class="fas fa-mobile-alt"></i> UPI Payments</h4>
                        <p>Send & receive money instantly using UPI</p>
                    </div>
                    <div class="service-item" onclick="alert('Investment Tracking coming soon!')">
                        <h4><i class="fas fa-chart-line"></i> Investment Tracking</h4>
                        <p>Track mutual funds, stocks, SIPs with insights</p>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeServiceModal() {
            document.getElementById('serviceModal').style.display = 'none';
        }

        const ACCOUNT_MANAGEMENT_SECTIONS = {
            bankAccounts: {
                title: 'Bank Accounts',
                subtitle: 'Store your linked bank details securely on this device.',
                storageKey: 'fintpe_bank_accounts',
                formTitle: 'Add Bank Account',
                listTitle: 'Saved Bank Accounts',
                emptyState: 'No bank accounts added yet. Add your first account to get started.',
                ctaText: 'Save Bank Details',
                fields: [
                    { name: 'bankName', label: 'Bank Name', type: 'text', placeholder: 'State Bank of India', required: true },
                    { name: 'accountType', label: 'Account Type', type: 'select', required: true, options: ['Savings', 'Current', 'Salary', 'NRE/NRO', 'Other'] },
                    { name: 'accountNumber', label: 'Account Number (last 4 digits)', type: 'text', placeholder: '1234', required: true, maxlength: 20 },
                    { name: 'ifsc', label: 'IFSC Code', type: 'text', placeholder: 'SBIN0001234' },
                    { name: 'balance', label: 'Current Balance', type: 'number', placeholder: '98500', prefix: '' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Primary salary account' }
                ]
            },
            insurance: {
                title: 'Insurance Policies',
                subtitle: 'Track all your insurance coverage in one place.',
                storageKey: 'fintpe_insurance',
                formTitle: 'Add Insurance Policy',
                listTitle: 'Saved Policies',
                emptyState: 'No insurance policies added yet.',
                ctaText: 'Save Policy',
                fields: [
                    { name: 'provider', label: 'Provider', type: 'text', placeholder: 'HDFC Life', required: true },
                    { name: 'policyType', label: 'Policy Type', type: 'select', required: true, options: ['Health', 'Life', 'Term', 'Motor', 'Travel', 'Other'] },
                    { name: 'policyNumber', label: 'Policy Number', type: 'text', placeholder: 'POL123456', required: true },
                    { name: 'coverage', label: 'Coverage Amount', type: 'number', placeholder: '2500000', prefix: '' },
                    { name: 'premium', label: 'Premium (per year)', type: 'number', placeholder: '35000', prefix: '' },
                    { name: 'renewalDate', label: 'Next Renewal Date', type: 'date' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Covers entire family' }
                ]
            },
            realEstateGold: {
                title: 'Real Estate & Gold',
                subtitle: 'Keep quick notes on your tangible assets.',
                storageKey: 'fintpe_realestate_gold',
                formTitle: 'Add Asset',
                listTitle: 'Saved Assets',
                emptyState: 'No assets added yet.',
                ctaText: 'Save Asset',
                fields: [
                    { name: 'assetType', label: 'Asset Type', type: 'select', required: true, options: ['Real Estate', 'Gold', 'Other'] },
                    { name: 'assetName', label: 'Asset Name / Description', type: 'text', placeholder: '2BHK - Pune', required: true },
                    { name: 'location', label: 'Location', type: 'text', placeholder: 'Pune, Maharashtra' },
                    { name: 'currentValue', label: 'Current Value', type: 'number', placeholder: '4500000', prefix: '' },
                    { name: 'ownership', label: 'Ownership Share', type: 'text', placeholder: '50%' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Jointly owned with spouse' }
                ]
            },
            investments: {
                title: 'Investments',
                subtitle: 'Track SIPs, stocks and deposits you care about.',
                storageKey: 'fintpe_investments',
                formTitle: 'Add Investment',
                listTitle: 'Saved Investments',
                emptyState: 'No investments recorded yet.',
                ctaText: 'Save Investment',
                fields: [
                    { name: 'instrument', label: 'Instrument', type: 'text', placeholder: 'Nippon India Growth Fund', required: true },
                    { name: 'category', label: 'Category', type: 'select', required: true, options: ['Mutual Fund', 'Stock', 'FD', 'Bond', 'SIP', 'ETF', 'Other'] },
                    { name: 'holding', label: 'Holding Value', type: 'number', placeholder: '150000', prefix: '' },
                    { name: 'goal', label: 'Goal / Purpose', type: 'text', placeholder: 'Retirement corpus' },
                    { name: 'nextAction', label: 'Next Action Date', type: 'date' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'SIP every 1st of month' }
                ]
            },
            calendarReminders: {
                title: 'Calendar & Reminders',
                subtitle: 'Never miss a due date again.',
                storageKey: 'fintpe_reminders',
                formTitle: 'Add Reminder',
                listTitle: 'Upcoming Reminders',
                emptyState: 'No reminders added yet.',
                ctaText: 'Save Reminder',
                fields: [
                    { name: 'title', label: 'Reminder Title', type: 'text', placeholder: 'SIP - Growth Fund', required: true },
                    { name: 'reminderType', label: 'Reminder Type', type: 'select', required: true, options: ['SIP Payment', 'Bill Payment', 'Tax', 'Insurance', 'Investment', 'Other'] },
                    { name: 'reminderDate', label: 'Date', type: 'date', required: true },
                    { name: 'amount', label: 'Amount', type: 'number', placeholder: '15000', prefix: '' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Auto-debit from HDFC salary account' }
                ]
            },
            authorizations: {
                title: 'Authorizations',
                subtitle: 'Track which platforms have access to your financial data.',
                storageKey: 'fintpe_authorizations',
                formTitle: 'Add Authorization',
                listTitle: 'Linked Platforms',
                emptyState: 'No authorizations stored yet.',
                ctaText: 'Save Authorization',
                fields: [
                    { name: 'platform', label: 'Platform / App', type: 'text', placeholder: 'Zerodha', required: true },
                    { name: 'accessLevel', label: 'Access Level', type: 'select', required: true, options: ['View Only', 'Read', 'Write', 'Full Access'] },
                    { name: 'linkedAccounts', label: 'Linked Accounts', type: 'text', placeholder: 'SBI Savings, ICICI Demat' },
                    { name: 'expiresOn', label: 'Access Expires On', type: 'date' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Revoke if inactive for 90 days' }
                ]
            },
            taxServices: {
                title: 'Tax Services',
                subtitle: 'Keep a checklist of your ITR filings and documents.',
                storageKey: 'fintpe_tax',
                formTitle: 'Add Tax Item',
                listTitle: 'Tax Checklist',
                emptyState: 'No tax tasks tracked yet.',
                ctaText: 'Save Tax Item',
                fields: [
                    { name: 'document', label: 'Document / Filing', type: 'text', placeholder: 'ITR-2 Filing', required: true },
                    { name: 'assessmentYear', label: 'Assessment Year', type: 'text', placeholder: '2024-25', required: true },
                    { name: 'status', label: 'Status', type: 'select', required: true, options: ['Pending', 'In Progress', 'Completed', 'Need Review'] },
                    { name: 'dueDate', label: 'Due Date', type: 'date' },
                    { name: 'preparedBy', label: 'Prepared By', type: 'text', placeholder: 'Self / CA Name' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Awaiting Form 16 from employer' }
                ]
            },
            passwordSecurity: {
                title: 'Password & Security',
                subtitle: 'Log your last password or PIN update for each service.',
                storageKey: 'fintpe_security',
                formTitle: 'Add Security Item',
                listTitle: 'Security Checklist',
                emptyState: 'No security items recorded yet.',
                ctaText: 'Save Security Item',
                fields: [
                    { name: 'item', label: 'Security Item', type: 'text', placeholder: 'Netbanking PIN', required: true },
                    { name: 'status', label: 'Status', type: 'select', required: true, options: ['Active', 'Needs Update', 'Expired'] },
                    { name: 'lastUpdated', label: 'Last Updated On', type: 'date' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Rotate every 90 days' }
                ]
            },
            loans: {
                title: 'Loans & EMIs',
                subtitle: 'Track your loans, EMIs and outstanding balances.',
                storageKey: 'fintpe_loans',
                formTitle: 'Add Loan',
                listTitle: 'Your Loans',
                emptyState: 'No loans added yet.',
                ctaText: 'Save Loan',
                fields: [
                    { name: 'loanName', label: 'Loan Name', type: 'text', placeholder: 'Home Loan - HDFC', required: true },
                    { name: 'loanType', label: 'Loan Type', type: 'select', required: true, options: ['Home Loan', 'Car Loan', 'Personal Loan', 'Education Loan', 'Credit Card', 'Gold Loan', 'Other'] },
                    { name: 'lender', label: 'Lender', type: 'text', placeholder: 'HDFC Bank' },
                    { name: 'outstandingAmount', label: 'Outstanding Amount', type: 'number', placeholder: '1500000', prefix: '', required: true },
                    { name: 'emiAmount', label: 'Monthly EMI', type: 'number', placeholder: '28500', prefix: '' },
                    { name: 'interestRate', label: 'Interest Rate (%)', type: 'number', placeholder: '8.5' },
                    { name: 'emiDate', label: 'EMI Date (Day of Month)', type: 'number', placeholder: '5' },
                    { name: 'endDate', label: 'Loan End Date', type: 'date' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Auto-debit from salary account' }
                ]
            },
            esops: {
                title: 'ESOPs',
                subtitle: 'Track your employee stock options and vesting schedule.',
                storageKey: 'fintpe_esops',
                formTitle: 'Add ESOP Grant',
                listTitle: 'Your ESOPs',
                emptyState: 'No ESOPs added yet.',
                ctaText: 'Save ESOP',
                fields: [
                    { name: 'company', label: 'Company', type: 'text', placeholder: 'Acme Corp', required: true },
                    { name: 'grantDate', label: 'Grant Date', type: 'date', required: true },
                    { name: 'totalOptions', label: 'Total Options', type: 'number', placeholder: '1000', required: true },
                    { name: 'vestedOptions', label: 'Vested Options', type: 'number', placeholder: '250' },
                    { name: 'strikePrice', label: 'Strike Price', type: 'number', placeholder: '50', prefix: '' },
                    { name: 'currentPrice', label: 'Current Price', type: 'number', placeholder: '150', prefix: '' },
                    { name: 'vestingSchedule', label: 'Vesting Schedule', type: 'text', placeholder: '4 years, 1 year cliff' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Next vesting on March 2025' }
                ]
            },
            nps: {
                title: 'NPS',
                subtitle: 'National Pension System contributions and growth.',
                storageKey: 'fintpe_nps',
                formTitle: 'Add NPS Account',
                listTitle: 'Your NPS',
                emptyState: 'No NPS account added yet.',
                ctaText: 'Save NPS Details',
                fields: [
                    { name: 'pranNumber', label: 'PRAN Number', type: 'text', placeholder: '1100XXXXXXXX', required: true },
                    { name: 'accountType', label: 'Account Type', type: 'select', required: true, options: ['Tier I', 'Tier II', 'Both'] },
                    { name: 'fundManager', label: 'Pension Fund Manager', type: 'select', options: ['SBI Pension Fund', 'LIC Pension Fund', 'UTI Retirement Solutions', 'HDFC Pension Fund', 'ICICI Prudential', 'Kotak Pension Fund', 'Aditya Birla Sun Life', 'Other'] },
                    { name: 'totalContribution', label: 'Total Contribution', type: 'number', placeholder: '500000', prefix: '' },
                    { name: 'currentValue', label: 'Current Value', type: 'number', placeholder: '650000', prefix: '' },
                    { name: 'monthlyContribution', label: 'Monthly Contribution', type: 'number', placeholder: '5000', prefix: '' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: 'Employer + self contribution' }
                ]
            },
            ppf: {
                title: 'PPF',
                subtitle: 'Public Provident Fund balance and maturity tracking.',
                storageKey: 'fintpe_ppf',
                formTitle: 'Add PPF Account',
                listTitle: 'Your PPF',
                emptyState: 'No PPF account added yet.',
                ctaText: 'Save PPF Details',
                fields: [
                    { name: 'bankName', label: 'Bank/Post Office', type: 'text', placeholder: 'SBI', required: true },
                    { name: 'accountNumber', label: 'Account Number', type: 'text', placeholder: 'PPF123456', required: true },
                    { name: 'openingDate', label: 'Account Opening Date', type: 'date' },
                    { name: 'maturityDate', label: 'Maturity Date', type: 'date' },
                    { name: 'currentBalance', label: 'Current Balance', type: 'number', placeholder: '850000', prefix: '' },
                    { name: 'yearlyContribution', label: 'Yearly Contribution', type: 'number', placeholder: '150000', prefix: '' },
                    { name: 'notes', label: 'Notes', type: 'textarea', placeholder: '15 year lock-in period' }
                ]
            }
        };

        function openAccountManagementSection(sectionKey) {
            // Special handling for investments - use portfolio upload
            if (sectionKey === 'investments') {
                openInvestmentPortfolio();
                return;
            }

            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;

            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('serviceModalTitle');
            const subtitle = document.getElementById('serviceModalSubtitle');
            const body = document.getElementById('serviceModalBody');

            title.textContent = config.title;
            subtitle.textContent = config.subtitle;
            body.innerHTML = buildManagementModalContent(sectionKey, config);
            attachManagementForm(sectionKey);
            renderManagementRecords(sectionKey);
            modal.style.display = 'block';
        }

        function buildManagementModalContent(sectionKey, config) {
            const formId = `${sectionKey}ManagementForm`;
            const recordsId = `${sectionKey}Records`;
            const editFieldId = `${sectionKey}EditIndex`;

            const fieldsHtml = config.fields.map(field => buildManagementField(field, sectionKey)).join('');

            return `
                <div class="management-container">
                    <div id="${recordsId}" class="management-records"></div>
                    <button type="button" class="btn btn-primary add-entry-btn" onclick="toggleManagementForm('${sectionKey}')">
                        <i class="fas fa-plus"></i> Add New
                    </button>
                    <div class="management-form-wrapper" id="${sectionKey}FormWrapper" style="display: none;">
                        <form id="${formId}" class="management-form">
                            <h4 id="${sectionKey}FormTitle">${config.formTitle || 'Add Entry'}</h4>
                            <div class="form-fields-grid">
                                ${fieldsHtml}
                            </div>
                            <input type="hidden" id="${editFieldId}" value="-1">
                            <div class="form-actions-row">
                                <button type="button" class="btn btn-secondary" onclick="toggleManagementForm('${sectionKey}', false)">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> ${config.ctaText || 'Save'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function toggleManagementForm(sectionKey, show = true) {
            const wrapper = document.getElementById(sectionKey + 'FormWrapper');
            const form = document.getElementById(sectionKey + 'ManagementForm');
            const editField = document.getElementById(sectionKey + 'EditIndex');
            const titleEl = document.getElementById(sectionKey + 'FormTitle');
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];

            if (wrapper) {
                wrapper.style.display = show ? 'block' : 'none';
                if (!show && form) {
                    form.reset();
                    if (editField) editField.value = '-1';
                    if (titleEl && config) titleEl.textContent = config.formTitle || 'Add Entry';
                }
            }
        }

        function buildManagementField(field, sectionKey) {
            const inputId = `${sectionKey}_${field.name}`;
            const requiredAttr = field.required ? 'required' : '';
            const maxAttr = field.maxlength ? `maxlength="${field.maxlength}"` : '';
            const placeholder = field.placeholder ? `placeholder="${field.placeholder}"` : '';
            
            if (field.type === 'textarea') {
                return `
                    <div class="management-field">
                        <label for="${inputId}">${field.label}</label>
                        <textarea id="${inputId}" name="${field.name}" ${placeholder} ${requiredAttr}></textarea>
                    </div>
                `;
            }
            
            if (field.type === 'select') {
                const placeholderOption = `<option value="" ${field.required ? 'disabled selected' : 'selected'}>${field.selectPlaceholder || 'Select an option'}</option>`;
                const options = (field.options || []).map(option => `<option value="${option}">${option}</option>`).join('');
                
                return `
                    <div class="management-field">
                        <label for="${inputId}">${field.label}</label>
                        <select id="${inputId}" name="${field.name}" ${requiredAttr}>
                            ${placeholderOption}
                            ${options}
                        </select>
                    </div>
                `;
            }
            
            const type = field.type === 'number' ? 'number' : field.type === 'date' ? 'date' : 'text';
            const stepAttr = field.type === 'number' ? 'step="any"' : '';
            
            return `
                <div class="management-field">
                    <label for="${inputId}">${field.label}</label>
                    <input type="${type}" id="${inputId}" name="${field.name}" ${placeholder} ${requiredAttr} ${maxAttr} ${stepAttr}>
                </div>
            `;
        }

        function attachManagementForm(sectionKey) {
            const form = document.getElementById(`${sectionKey}ManagementForm`);
            if (!form) return;
            
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
                if (!config) return;
                
                const formData = new FormData(form);
                const entry = {};
                config.fields.forEach(field => {
                    entry[field.name] = (formData.get(field.name) || '').toString().trim();
                });
                
                const editIndexField = document.getElementById(`${sectionKey}EditIndex`);
                const editIndex = editIndexField ? parseInt(editIndexField.value, 10) : -1;
                const data = getAccountManagementData(sectionKey);
                
                if (editIndex >= 0 && data[editIndex]) {
                    data[editIndex] = entry;
                } else {
                    data.push(entry);
                }
                
                saveAccountManagementData(sectionKey, data);
                renderManagementRecords(sectionKey);
                form.reset();
                if (editIndexField) editIndexField.value = -1;
                toggleManagementForm(sectionKey, false);
                showSuccessMessage(editIndex >= 0 ? 'Details updated' : 'Details saved');

                // Refresh dashboard for financial sections
                if (['bankAccounts', 'investments', 'realEstateGold', 'loans'].includes(sectionKey)) {
                    setTimeout(() => loadDashboard(), 500);
                }
            });
        }

        function getAccountManagementData(sectionKey) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return [];
            
            const raw = localStorage.getItem(config.storageKey);
            if (!raw) return [];
            
            try {
                const parsed = JSON.parse(raw);
                return Array.isArray(parsed) ? parsed : [];
            } catch (error) {
                return [];
            }
        }

        function saveAccountManagementData(sectionKey, data) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;
            localStorage.setItem(config.storageKey, JSON.stringify(data));
        }

        function renderManagementRecords(sectionKey) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;

            const container = document.getElementById(`${sectionKey}Records`);
            if (!container) return;

            const data = getAccountManagementData(sectionKey);
            if (!data.length) {
                container.innerHTML = '<div class="management-empty-state"><i class="fas fa-inbox" style="font-size: 2rem; color: var(--text-secondary); margin-bottom: 1rem;"></i><p>' + config.emptyState + '</p></div>';
                return;
            }

            // Get key display fields (first 3 non-notes fields)
            const displayFields = config.fields.filter(f => f.name !== 'notes').slice(0, 4);

            let html = '<table class="records-table"><thead><tr>';
            displayFields.forEach(f => { html += '<th>' + f.label + '</th>'; });
            html += '<th style="width: 120px;">Actions</th></tr></thead><tbody>';

            data.forEach((entry, index) => {
                html += '<tr>';
                displayFields.forEach(field => {
                    const value = entry[field.name] || '-';
                    html += '<td>' + formatManagementValue(field, value) + '</td>';
                });
                html += '<td class="actions-cell">' +
                    '<button type="button" class="icon-btn edit" data-section="' + sectionKey + '" data-index="' + index + '" data-action="edit" title="Edit"><i class="fas fa-pen"></i></button>' +
                    '<button type="button" class="icon-btn delete" data-section="' + sectionKey + '" data-index="' + index + '" data-action="delete" title="Delete"><i class="fas fa-trash"></i></button>' +
                '</td></tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;

            container.querySelectorAll('button[data-action]').forEach(button => {
                button.addEventListener('click', function() {
                    handleManagementRecordAction(this.dataset.section, this.dataset.action, parseInt(this.dataset.index, 10));
                });
            });
        }

        function formatManagementValue(field, value) {
            if (!value) return '';
            let displayValue = value;
            
            if (field.type === 'date') {
                const parsed = new Date(value);
                if (!isNaN(parsed.getTime())) {
                    displayValue = parsed.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
                }
            }
            
            if (field.type === 'number' && !isNaN(Number(value))) {
                const numberValue = Number(value);
                displayValue = numberValue.toLocaleString('en-IN', { maximumFractionDigits: 2 });
            }
            
            if (field.prefix) {
                displayValue = `${field.prefix}${displayValue}`;
            }
            
            if (field.suffix) {
                displayValue = `${displayValue}${field.suffix}`;
            }
            
            return displayValue;
        }

        function handleManagementRecordAction(sectionKey, action, index) {
            const config = ACCOUNT_MANAGEMENT_SECTIONS[sectionKey];
            if (!config) return;
            
            const data = getAccountManagementData(sectionKey);
            if (!data[index]) return;
            
            if (action === 'delete') {
                if (!confirm('Delete this entry?')) return;
                data.splice(index, 1);
                saveAccountManagementData(sectionKey, data);
                renderManagementRecords(sectionKey);
                showSuccessMessage('Entry deleted');
                return;
            }
            
            if (action === 'edit') {
                const form = document.getElementById(`${sectionKey}ManagementForm`);
                const editIndexField = document.getElementById(`${sectionKey}EditIndex`);
                const titleEl = document.getElementById(`${sectionKey}FormTitle`);
                if (!form) return;

                // Show the form
                toggleManagementForm(sectionKey, true);

                // Update title to "Edit"
                if (titleEl) titleEl.textContent = 'Edit Entry';

                // Fill form with existing data
                config.fields.forEach(field => {
                    const element = form.elements[field.name];
                    if (element) {
                        element.value = data[index][field.name] || '';
                    }
                });

                if (editIndexField) editIndexField.value = index;
            }
        }

        // Investment Portfolio Functions
        const PORTFOLIO_STORAGE_KEY = 'fintpe_portfolio';
        let selectedBroker = null;
        let currentPortfolioTab = 'all';

        function openInvestmentPortfolio() {
            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('serviceModalTitle');
            const subtitle = document.getElementById('serviceModalSubtitle');
            const body = document.getElementById('serviceModalBody');

            title.textContent = 'Investments';
            subtitle.textContent = 'Upload your broker CSV to track your portfolio.';
            body.innerHTML = buildInvestmentPortfolioContent();
            attachPortfolioEventListeners();
            renderPortfolioData();
            modal.style.display = 'block';
        }

        function buildInvestmentPortfolioContent() {
            return '<div class="portfolio-container">' +
                '<div class="broker-upload-section">' +
                    '<p style="margin: 0 0 1rem 0; font-weight: 600; color: var(--text-primary);">Select your broker and upload holdings CSV:</p>' +
                    '<div class="broker-selection">' +
                        '<button type="button" class="broker-btn" data-broker="zerodha" onclick="selectBroker(\'zerodha\')">' +
                            '<span class="broker-icon zerodha">Z</span>' +
                            'Zerodha' +
                        '</button>' +
                        '<button type="button" class="broker-btn" data-broker="groww" onclick="selectBroker(\'groww\')">' +
                            '<span class="broker-icon groww">G</span>' +
                            'Groww' +
                        '</button>' +
                    '</div>' +
                    '<div class="file-upload-area" id="fileUploadArea">' +
                        '<i class="fas fa-cloud-upload-alt"></i>' +
                        '<p>Drag & drop your Excel file here, or <span class="browse-link">browse</span></p>' +
                        '<p style="font-size: 0.8rem; margin-top: 0.5rem;">Select a broker first, then upload the holdings file (.xlsx)</p>' +
                        '<input type="file" id="csvFileInput" accept=".xlsx,.xls,.csv" />' +
                    '</div>' +
                '</div>' +
                '<div id="portfolioDataSection"></div>' +
            '</div>';
        }

        function attachPortfolioEventListeners() {
            const fileInput = document.getElementById('csvFileInput');
            const uploadArea = document.getElementById('fileUploadArea');

            if (uploadArea) {
                uploadArea.addEventListener('click', function() {
                    if (!selectedBroker) {
                        showSuccessMessage('Please select a broker first');
                        return;
                    }
                    fileInput.click();
                });

                uploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    uploadArea.classList.add('drag-over');
                });

                uploadArea.addEventListener('dragleave', function() {
                    uploadArea.classList.remove('drag-over');
                });

                uploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    uploadArea.classList.remove('drag-over');
                    if (!selectedBroker) {
                        showSuccessMessage('Please select a broker first');
                        return;
                    }
                    const file = e.dataTransfer.files[0];
                    if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls') || file.name.endsWith('.csv'))) {
                        parseCSVFile(file);
                    }
                });
            }

            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        parseCSVFile(file);
                    }
                });
            }
        }

        function selectBroker(broker) {
            selectedBroker = broker;
            document.querySelectorAll('.broker-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.broker === broker);
            });
        }

        function parseCSVFile(file) {
            const isExcel = file.name.endsWith('.xlsx') || file.name.endsWith('.xls');
            const reader = new FileReader();

            reader.onload = function(e) {
                let holdings = [];

                if (isExcel) {
                    // Parse Excel file using SheetJS
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                        holdings = parseExcelByBroker(rows, selectedBroker);
                    } catch (err) {
                        console.error('Excel parse error:', err);
                        showSuccessMessage('Error parsing Excel file. Please check the format.');
                        return;
                    }
                } else {
                    // Parse CSV file
                    const text = e.target.result;
                    holdings = parseCSVByBroker(text, selectedBroker);
                }

                if (holdings && holdings.length > 0) {
                    savePortfolioData(holdings);
                    renderPortfolioData();
                    showSuccessMessage('Portfolio imported successfully! ' + holdings.length + ' holdings found.');
                    setTimeout(function() { loadDashboard(); }, 500);
                } else {
                    showSuccessMessage('No valid holdings found in the file.');
                }
            };

            if (isExcel) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        }

        function parseExcelByBroker(rows, broker) {
            if (rows.length < 2) return [];

            const headerRow = rows[0].map(h => (h || '').toString().toLowerCase());
            const dataRows = rows.slice(1);

            if (broker === 'zerodha') {
                return parseZerodhaExcel(headerRow, dataRows);
            } else if (broker === 'groww') {
                return parseGrowwExcel(headerRow, dataRows);
            }
            return [];
        }

        function parseZerodhaExcel(headers, dataRows) {
            const holdings = [];

            // Map headers to indices
            const symbolIdx = headers.findIndex(h => h.includes('symbol') || h.includes('tradingsymbol'));
            const isinIdx = headers.findIndex(h => h.includes('isin'));
            const sectorIdx = headers.findIndex(h => h.includes('sector'));
            const qtyIdx = headers.findIndex(h => h.includes('quantity') || h.includes('qty'));
            const avgPriceIdx = headers.findIndex(h => h.includes('average') && h.includes('price'));
            const currentPriceIdx = headers.findIndex(h => h.includes('previous') || h.includes('closing') || h.includes('ltp') || h.includes('current'));
            const pnlIdx = headers.findIndex(h => h.includes('unrealized') && h.includes('p&l') && !h.includes('pct'));
            const pnlPctIdx = headers.findIndex(h => h.includes('pct') || h.includes('%'));
            const instrumentIdx = headers.findIndex(h => h.includes('instrument'));

            dataRows.forEach(function(row) {
                if (!row || row.length < 3) return;

                const symbol = row[symbolIdx >= 0 ? symbolIdx : 0];
                if (!symbol) return;

                const holding = {
                    symbol: String(symbol).trim(),
                    isin: isinIdx >= 0 ? String(row[isinIdx] || '').trim() : '',
                    sector: sectorIdx >= 0 ? String(row[sectorIdx] || '').trim() : '',
                    quantity: parseFloat(row[qtyIdx]) || 0,
                    avgPrice: parseFloat(row[avgPriceIdx]) || 0,
                    currentPrice: parseFloat(row[currentPriceIdx]) || 0,
                    pnl: parseFloat(row[pnlIdx]) || 0,
                    pnlPercent: parseFloat(row[pnlPctIdx]) || 0,
                    type: determineHoldingType(instrumentIdx >= 0 ? String(row[instrumentIdx] || '') : String(symbol)),
                    broker: 'zerodha'
                };

                holding.investedValue = holding.quantity * holding.avgPrice;
                holding.currentValue = holding.quantity * holding.currentPrice;

                if (holding.pnl === 0 && holding.investedValue > 0) {
                    holding.pnl = holding.currentValue - holding.investedValue;
                    holding.pnlPercent = (holding.pnl / holding.investedValue) * 100;
                }

                if (holding.quantity > 0) {
                    holdings.push(holding);
                }
            });

            return holdings;
        }

        function parseGrowwExcel(headers, dataRows) {
            const holdings = [];

            const symbolIdx = headers.findIndex(h => h.includes('symbol') || h.includes('stock') || h.includes('scheme') || h.includes('name'));
            const qtyIdx = headers.findIndex(h => h.includes('quantity') || h.includes('units') || h.includes('qty'));
            const avgPriceIdx = headers.findIndex(h => h.includes('avg') || h.includes('purchase') || h.includes('buy'));
            const currentPriceIdx = headers.findIndex(h => h.includes('current') || h.includes('nav') || h.includes('ltp') || h.includes('market'));
            const investedIdx = headers.findIndex(h => h.includes('invested'));
            const currentValueIdx = headers.findIndex(h => h.includes('current') && h.includes('value'));
            const pnlIdx = headers.findIndex(h => (h.includes('gain') || h.includes('p&l') || h.includes('profit') || h.includes('returns')) && !h.includes('%'));
            const pnlPctIdx = headers.findIndex(h => h.includes('%') || h.includes('return'));
            const typeIdx = headers.findIndex(h => h.includes('type') || h.includes('category'));

            dataRows.forEach(function(row) {
                if (!row || row.length < 3) return;

                const symbol = row[symbolIdx >= 0 ? symbolIdx : 0];
                if (!symbol) return;

                const quantity = parseFloat(row[qtyIdx]) || 0;
                const avgPrice = parseFloat(row[avgPriceIdx]) || 0;
                const currentPrice = parseFloat(row[currentPriceIdx]) || 0;

                const holding = {
                    symbol: String(symbol).trim(),
                    isin: '',
                    sector: '',
                    quantity: quantity,
                    avgPrice: avgPrice,
                    currentPrice: currentPrice,
                    investedValue: investedIdx >= 0 ? parseFloat(row[investedIdx]) || (quantity * avgPrice) : (quantity * avgPrice),
                    currentValue: currentValueIdx >= 0 ? parseFloat(row[currentValueIdx]) || (quantity * currentPrice) : (quantity * currentPrice),
                    pnl: parseFloat(row[pnlIdx]) || 0,
                    pnlPercent: parseFloat(row[pnlPctIdx]) || 0,
                    type: typeIdx >= 0 ? (String(row[typeIdx] || '').toLowerCase().includes('mutual') ? 'mutualfund' : 'equity') : determineHoldingType(String(symbol)),
                    broker: 'groww'
                };

                if (holding.pnl === 0 && holding.investedValue > 0) {
                    holding.pnl = holding.currentValue - holding.investedValue;
                    holding.pnlPercent = (holding.pnl / holding.investedValue) * 100;
                }

                if (holding.quantity > 0) {
                    holdings.push(holding);
                }
            });

            return holdings;
        }

        function parseCSVByBroker(csvText, broker) {
            const lines = csvText.split('\n').map(line => line.trim()).filter(line => line);
            if (lines.length < 2) return [];

            const headerLine = lines[0].toLowerCase();
            const dataLines = lines.slice(1);

            if (broker === 'zerodha') {
                return parseZerodhaCSV(headerLine, dataLines);
            } else if (broker === 'groww') {
                return parseGrowwCSV(headerLine, dataLines);
            }
            return [];
        }

        function parseZerodhaCSV(headerLine, dataLines) {
            const headers = parseCSVLine(headerLine);
            const holdings = [];

            // Map headers to indices
            const symbolIdx = headers.findIndex(h => h.includes('symbol') || h.includes('tradingsymbol'));
            const isinIdx = headers.findIndex(h => h.includes('isin'));
            const sectorIdx = headers.findIndex(h => h.includes('sector'));
            const qtyIdx = headers.findIndex(h => h.includes('quantity') || h.includes('qty'));
            const avgPriceIdx = headers.findIndex(h => h.includes('average') && h.includes('price'));
            const currentPriceIdx = headers.findIndex(h => h.includes('previous') || h.includes('closing') || h.includes('ltp') || h.includes('current'));
            const pnlIdx = headers.findIndex(h => h.includes('unrealized') && h.includes('p&l') && !h.includes('pct'));
            const pnlPctIdx = headers.findIndex(h => h.includes('pct') || h.includes('%'));
            const instrumentIdx = headers.findIndex(h => h.includes('instrument'));

            dataLines.forEach(line => {
                if (!line.trim()) return;
                const values = parseCSVLine(line);
                if (values.length < 3) return;

                const symbol = values[symbolIdx] || '';
                if (!symbol) return;

                const holding = {
                    symbol: symbol.replace(/"/g, '').trim(),
                    isin: values[isinIdx] ? values[isinIdx].replace(/"/g, '').trim() : '',
                    sector: values[sectorIdx] ? values[sectorIdx].replace(/"/g, '').trim() : '',
                    quantity: parseFloat(values[qtyIdx]) || 0,
                    avgPrice: parseFloat(values[avgPriceIdx]) || 0,
                    currentPrice: parseFloat(values[currentPriceIdx]) || 0,
                    pnl: parseFloat(values[pnlIdx]) || 0,
                    pnlPercent: parseFloat(values[pnlPctIdx]) || 0,
                    type: determineHoldingType(values[instrumentIdx] || symbol),
                    broker: 'zerodha'
                };

                // Calculate invested and current value
                holding.investedValue = holding.quantity * holding.avgPrice;
                holding.currentValue = holding.quantity * holding.currentPrice;

                // Recalculate P&L if not provided
                if (holding.pnl === 0 && holding.investedValue > 0) {
                    holding.pnl = holding.currentValue - holding.investedValue;
                    holding.pnlPercent = (holding.pnl / holding.investedValue) * 100;
                }

                holdings.push(holding);
            });

            return holdings;
        }

        function parseGrowwCSV(headerLine, dataLines) {
            const headers = parseCSVLine(headerLine);
            const holdings = [];

            // Groww CSV format - map headers
            const symbolIdx = headers.findIndex(h => h.includes('symbol') || h.includes('stock') || h.includes('scheme'));
            const qtyIdx = headers.findIndex(h => h.includes('quantity') || h.includes('units') || h.includes('qty'));
            const avgPriceIdx = headers.findIndex(h => h.includes('avg') || h.includes('purchase'));
            const currentPriceIdx = headers.findIndex(h => h.includes('current') || h.includes('nav') || h.includes('ltp'));
            const investedIdx = headers.findIndex(h => h.includes('invested'));
            const currentValueIdx = headers.findIndex(h => h.includes('current') && h.includes('value'));
            const pnlIdx = headers.findIndex(h => (h.includes('gain') || h.includes('p&l') || h.includes('profit')) && !h.includes('%'));
            const pnlPctIdx = headers.findIndex(h => h.includes('%') || h.includes('return'));
            const typeIdx = headers.findIndex(h => h.includes('type') || h.includes('category'));

            dataLines.forEach(line => {
                if (!line.trim()) return;
                const values = parseCSVLine(line);
                if (values.length < 3) return;

                const symbol = values[symbolIdx >= 0 ? symbolIdx : 0] || '';
                if (!symbol) return;

                const quantity = parseFloat(values[qtyIdx]) || 0;
                const avgPrice = parseFloat(values[avgPriceIdx]) || 0;
                const currentPrice = parseFloat(values[currentPriceIdx]) || 0;

                const holding = {
                    symbol: symbol.replace(/"/g, '').trim(),
                    isin: '',
                    sector: '',
                    quantity: quantity,
                    avgPrice: avgPrice,
                    currentPrice: currentPrice,
                    investedValue: investedIdx >= 0 ? parseFloat(values[investedIdx]) || (quantity * avgPrice) : (quantity * avgPrice),
                    currentValue: currentValueIdx >= 0 ? parseFloat(values[currentValueIdx]) || (quantity * currentPrice) : (quantity * currentPrice),
                    pnl: parseFloat(values[pnlIdx]) || 0,
                    pnlPercent: parseFloat(values[pnlPctIdx]) || 0,
                    type: typeIdx >= 0 ? (values[typeIdx] || '').toLowerCase().includes('mutual') ? 'mutualfund' : 'equity' : determineHoldingType(symbol),
                    broker: 'groww'
                };

                // Recalculate P&L if not provided
                if (holding.pnl === 0 && holding.investedValue > 0) {
                    holding.pnl = holding.currentValue - holding.investedValue;
                    holding.pnlPercent = (holding.pnl / holding.investedValue) * 100;
                }

                holdings.push(holding);
            });

            return holdings;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            return result;
        }

        function determineHoldingType(identifier) {
            const lower = (identifier || '').toLowerCase();
            if (lower.includes('mutual') || lower.includes('fund') || lower.includes('mf') || lower.includes('scheme')) {
                return 'mutualfund';
            }
            if (lower.includes('etf')) {
                return 'etf';
            }
            return 'equity';
        }

        function savePortfolioData(holdings) {
            const existingData = getPortfolioData();

            // Merge or replace holdings from the same broker
            const brokerHoldings = holdings[0]?.broker || selectedBroker;
            const otherBrokerHoldings = existingData.filter(h => h.broker !== brokerHoldings);
            const mergedHoldings = [...otherBrokerHoldings, ...holdings];

            localStorage.setItem(PORTFOLIO_STORAGE_KEY, JSON.stringify(mergedHoldings));
        }

        function getPortfolioData() {
            try {
                const data = localStorage.getItem(PORTFOLIO_STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                return [];
            }
        }

        function clearPortfolio() {
            if (!confirm('Clear all portfolio data?')) return;
            localStorage.removeItem(PORTFOLIO_STORAGE_KEY);
            renderPortfolioData();
            showSuccessMessage('Portfolio cleared');
            setTimeout(function() { loadDashboard(); }, 500);
        }

        function switchPortfolioTab(tab) {
            currentPortfolioTab = tab;
            document.querySelectorAll('.portfolio-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            renderPortfolioHoldings();
        }

        function renderPortfolioData() {
            const container = document.getElementById('portfolioDataSection');
            if (!container) return;

            const holdings = getPortfolioData();
            if (!holdings.length) {
                container.innerHTML = '';
                return;
            }

            // Calculate summary
            const summary = calculatePortfolioSummary(holdings);

            // Build HTML using string concatenation to avoid template literal issues
            let html = '<div class="portfolio-summary">';
            html += '<div class="summary-card"><div class="label">Invested Value</div><div class="value">' + formatCurrency(summary.investedValue) + '</div></div>';
            html += '<div class="summary-card"><div class="label">Current Value</div><div class="value">' + formatCurrency(summary.currentValue) + '</div></div>';
            html += '<div class="summary-card"><div class="label">Total P&L</div><div class="value ' + (summary.totalPnl >= 0 ? 'positive' : 'negative') + '">' + (summary.totalPnl >= 0 ? '+' : '') + formatCurrency(summary.totalPnl) + '</div></div>';
            html += '<div class="summary-card"><div class="label">Returns</div><div class="value ' + (summary.pnlPercent >= 0 ? 'positive' : 'negative') + '">' + (summary.pnlPercent >= 0 ? '+' : '') + summary.pnlPercent.toFixed(2) + '%</div></div>';
            html += '</div>';

            // Add tabs for filtering
            html += '<div class="portfolio-tabs">';
            html += '<button class="portfolio-tab' + (currentPortfolioTab === 'all' ? ' active' : '') + '" data-tab="all" onclick="switchPortfolioTab(\'all\')">All (' + holdings.length + ')</button>';

            const equityCount = holdings.filter(h => h.type === 'equity').length;
            const mfCount = holdings.filter(h => h.type === 'mutualfund').length;

            if (equityCount > 0) {
                html += '<button class="portfolio-tab' + (currentPortfolioTab === 'equity' ? ' active' : '') + '" data-tab="equity" onclick="switchPortfolioTab(\'equity\')">Equity (' + equityCount + ')</button>';
            }
            if (mfCount > 0) {
                html += '<button class="portfolio-tab' + (currentPortfolioTab === 'mutualfund' ? ' active' : '') + '" data-tab="mutualfund" onclick="switchPortfolioTab(\'mutualfund\')">Mutual Funds (' + mfCount + ')</button>';
            }
            html += '</div>';

            html += '<div class="holdings-section">';
            html += '<div class="holdings-header"><h4>Holdings</h4><button class="clear-portfolio-btn" onclick="clearPortfolio()"><i class="fas fa-trash"></i> Clear All</button></div>';
            html += '<div class="holdings-scroll" id="holdingsTableContainer"></div>';
            html += '</div>';

            container.innerHTML = html;
            renderPortfolioHoldings();
        }

        function renderPortfolioHoldings() {
            const container = document.getElementById('holdingsTableContainer');
            if (!container) return;

            const holdings = getPortfolioData();
            const filtered = currentPortfolioTab === 'all' ? holdings : holdings.filter(h => h.type === currentPortfolioTab);

            if (!filtered.length) {
                container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-secondary);">No holdings in this category</div>';
                return;
            }

            let html = '<table class="holdings-table"><thead><tr>';
            html += '<th>Symbol</th><th>Qty</th><th style="text-align: right;">Avg Price</th><th style="text-align: right;">Current</th><th style="text-align: right;">Invested</th><th style="text-align: right;">Current Value</th><th style="text-align: right;">P&L</th><th style="text-align: right;">P&L %</th>';
            html += '</tr></thead><tbody>';

            filtered.forEach(function(h) {
                const pnlClass = h.pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
                html += '<tr>';
                html += '<td><span class="symbol">' + h.symbol + '</span>';
                if (h.sector) {
                    html += '<br><span class="sector">' + h.sector + '</span>';
                }
                html += '</td>';
                html += '<td>' + h.quantity.toLocaleString('en-IN', {maximumFractionDigits: 4}) + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(h.avgPrice) + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(h.currentPrice) + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(h.investedValue) + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(h.currentValue) + '</td>';
                html += '<td style="text-align: right;" class="' + pnlClass + '">' + (h.pnl >= 0 ? '+' : '') + formatCurrency(h.pnl) + '</td>';
                html += '<td style="text-align: right;" class="' + pnlClass + '">' + (h.pnlPercent >= 0 ? '+' : '') + h.pnlPercent.toFixed(2) + '%</td>';
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function calculatePortfolioSummary(holdings) {
            const summary = {
                investedValue: 0,
                currentValue: 0,
                totalPnl: 0,
                pnlPercent: 0
            };

            holdings.forEach(function(h) {
                summary.investedValue += h.investedValue || 0;
                summary.currentValue += h.currentValue || 0;
            });

            summary.totalPnl = summary.currentValue - summary.investedValue;
            summary.pnlPercent = summary.investedValue > 0 ? (summary.totalPnl / summary.investedValue) * 100 : 0;

            return summary;
        }

        // Enhanced Features
        let currentTheme = 'light';
        let privacyModeEnabled = false;
        const USER_PROFILE_STORAGE_KEY = 'fintpe_profile_details';
        let userProfileData = null;

        function toggleTheme() {
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            currentTheme = theme;
            
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                if (theme === 'dark') {
                    themeToggle.classList.add('active');
                } else {
                    themeToggle.classList.remove('active');
                }
            }
            
            localStorage.setItem('fintpe_theme', theme);
            showSuccessMessage(`${theme === 'dark' ? 'Dark' : 'Light'} theme activated`);
        }

        function togglePrivacyMode() {
            setPrivacyMode(!privacyModeEnabled);
        }

        function setPrivacyMode(enabled) {
            privacyModeEnabled = enabled;
            
            const privacyToggle = document.getElementById('privacyToggle');
            if (privacyToggle) {
                if (enabled) {
                    privacyToggle.classList.add('active');
                } else {
                    privacyToggle.classList.remove('active');
                }
            }
            
            localStorage.setItem('fintpe_privacy', enabled);
            showSuccessMessage(`Privacy mode ${enabled ? 'enabled' : 'disabled'}`);
        }

        function initializeEnhancedFeatures() {
            const savedTheme = localStorage.getItem('fintpe_theme') || 'light';
            const savedPrivacy = localStorage.getItem('fintpe_privacy') === 'true';
            
            if (savedTheme === 'dark') {
                setTheme('dark');
            }
            
            if (savedPrivacy) {
                setPrivacyMode(true);
            }
        }

        function setUserInfo() {
            const nameElement = document.getElementById('profileDisplayName');
            const initialsElement = document.getElementById('avatarInitials');
            let displayName = 'User';
            let initials = 'U';

            if (userProfileData && userProfileData.fullName) {
                displayName = userProfileData.fullName.trim();
                const nameParts = displayName.split(' ').filter(Boolean);
                if (nameParts.length) {
                    initials = nameParts.slice(0, 2).map(part => part.charAt(0).toUpperCase()).join('');
                } else {
                    initials = displayName.charAt(0).toUpperCase();
                }
            } else if (currentUser) {
                const emailName = currentUser.split('@')[0];
                displayName = emailName.charAt(0).toUpperCase() + emailName.slice(1);
                initials = emailName.charAt(0).toUpperCase();
            }
            
            if (nameElement) nameElement.textContent = `Hi, ${displayName}`;
            if (initialsElement) initialsElement.textContent = initials || 'U';

            // Update navbar user menu
            const userMenuName = document.getElementById('userMenuName');
            if (userMenuName) userMenuName.textContent = displayName;
        }

        function loadStoredProfileDetails() {
            const storedProfile = localStorage.getItem(USER_PROFILE_STORAGE_KEY);
            if (storedProfile) {
                try {
                    userProfileData = JSON.parse(storedProfile);
                } catch (error) {
                    userProfileData = null;
                }
            } else {
                userProfileData = null;
            }
        }

        function setupProfileDetailsForm() {
            const form = document.getElementById('profileDetailsForm');
            if (!form) return;

            if (!userProfileData) {
                loadStoredProfileDetails();
            }

            const fields = ['fullName', 'email', 'phone', 'city', 'occupation', 'income', 'goals'];
            fields.forEach(field => {
                const element = form.elements[field];
                if (!element) return;
                const storedValue = userProfileData ? userProfileData[field] : '';
                if (storedValue) {
                    element.value = storedValue;
                } else if (field === 'email' && currentUser) {
                    element.value = currentUser;
                }
            });

            updateProfileDetailsDisplay();

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const formData = new FormData(form);
                const profile = {
                    fullName: (formData.get('fullName') || '').trim(),
                    email: (formData.get('email') || '').trim(),
                    phone: (formData.get('phone') || '').trim(),
                    city: (formData.get('city') || '').trim(),
                    occupation: (formData.get('occupation') || '').trim(),
                    income: formData.get('income') || '',
                    goals: (formData.get('goals') || '').trim()
                };

                userProfileData = profile;
                localStorage.setItem(USER_PROFILE_STORAGE_KEY, JSON.stringify(profile));
                updateProfileDetailsDisplay();
                setUserInfo();
                showSuccessMessage('Profile details updated!');
            });
        }

        function updateProfileDetailsDisplay() {
            const display = document.getElementById('profileDetailsDisplay');
            if (!display) return;

            if (!userProfileData || !userProfileData.fullName) {
                display.classList.add('empty');
                display.innerHTML = '<p>No details yet. Fill the form to see them here.</p>';
                return;
            }

            const details = [
                { label: 'Full Name', value: userProfileData.fullName },
                { label: 'Email', value: userProfileData.email },
                { label: 'Mobile Number', value: userProfileData.phone },
                { label: 'City', value: userProfileData.city },
                { label: 'Occupation', value: userProfileData.occupation },
                { label: 'Monthly Income', value: userProfileData.income },
                { label: 'Financial Goal', value: userProfileData.goals }
            ].filter(detail => detail.value);

            display.classList.remove('empty');
            display.innerHTML = '';

            details.forEach(detail => {
                const row = document.createElement('div');
                row.className = 'profile-detail-item';
                const label = document.createElement('span');
                label.className = 'profile-detail-label';
                label.textContent = detail.label;
                const value = document.createElement('span');
                value.className = 'profile-detail-value';
                value.textContent = detail.value;
                row.appendChild(label);
                row.appendChild(value);
                display.appendChild(row);
            });
        }

        function clearProfileDetails() {
            userProfileData = null;
            localStorage.removeItem(USER_PROFILE_STORAGE_KEY);

            const form = document.getElementById('profileDetailsForm');
            if (form) {
                form.reset();
                if (currentUser && form.elements['email']) {
                    form.elements['email'].value = currentUser;
                }
            }

            updateProfileDetailsDisplay();
            setUserInfo();
            showSuccessMessage('Profile details cleared');
        }

        function focusProfileDetailsSection() {
            const profileSection = document.querySelector('.profile-details-section');
            if (!profileSection) {
                alert('Open the My Account page to update your profile.');
                return;
            }
            
            profileSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            profileSection.classList.add('section-highlight');
            setTimeout(() => profileSection.classList.remove('section-highlight'), 1800);
        }

        // Utility Functions
        function formatCurrency(amount) {
            if (amount === 0) return '0';
            return '' + amount.toLocaleString('en-IN');
        }

        function getFinancialData() {
            // Calculate liquid balance from bank accounts
            const bankAccounts = JSON.parse(localStorage.getItem('fintpe_bank_accounts') || '[]');
            const liquidBalance = bankAccounts.reduce((sum, acc) => sum + (parseFloat(acc.balance) || 0), 0);

            // Calculate investments total from portfolio data
            const portfolio = JSON.parse(localStorage.getItem('fintpe_portfolio') || '[]');
            const totalInvestments = portfolio.reduce((sum, h) => sum + (parseFloat(h.currentValue) || 0), 0);

            // Calculate real estate and gold from assets
            const assets = JSON.parse(localStorage.getItem('fintpe_realestate_gold') || '[]');
            const realEstateValue = assets
                .filter(a => a.assetType === 'Real Estate')
                .reduce((sum, a) => sum + (parseFloat(a.currentValue) || 0), 0);
            const goldValue = assets
                .filter(a => a.assetType === 'Gold')
                .reduce((sum, a) => sum + (parseFloat(a.currentValue) || 0), 0);

            // Calculate total loans/liabilities
            const loans = JSON.parse(localStorage.getItem('fintpe_loans') || '[]');
            const totalLoans = loans.reduce((sum, loan) => sum + (parseFloat(loan.outstandingAmount) || 0), 0);
            const monthlyEmi = loans.reduce((sum, loan) => sum + (parseFloat(loan.emiAmount) || 0), 0);

            // Calculate ESOPs value (total and vested)
            const esops = JSON.parse(localStorage.getItem('fintpe_esops') || '[]');
            let esopsTotalValue = 0;
            let esopsVestedValue = 0;
            esops.forEach(esop => {
                const totalOptions = parseFloat(esop.totalOptions) || 0;
                const vestedOptions = parseFloat(esop.vestedOptions) || 0;
                const currentPrice = parseFloat(esop.currentPrice) || 0;
                const strikePrice = parseFloat(esop.strikePrice) || 0;
                const gain = Math.max(0, currentPrice - strikePrice);
                esopsTotalValue += totalOptions * gain;
                esopsVestedValue += vestedOptions * gain;
            });
            const esopsValue = esopsVestedValue; // For net worth, use vested value

            // Calculate NPS value
            const npsAccounts = JSON.parse(localStorage.getItem('fintpe_nps') || '[]');
            const npsValue = npsAccounts.reduce((sum, nps) => sum + (parseFloat(nps.currentValue) || 0), 0);

            // Calculate PPF value
            const ppfAccounts = JSON.parse(localStorage.getItem('fintpe_ppf') || '[]');
            const ppfValue = ppfAccounts.reduce((sum, ppf) => sum + (parseFloat(ppf.currentBalance) || 0), 0);

            // Total assets (include ESOPs, NPS, PPF)
            const totalAssets = liquidBalance + totalInvestments + realEstateValue + goldValue + esopsValue + npsValue + ppfValue;

            // Net worth = Assets - Liabilities
            const netWorth = totalAssets - totalLoans;

            return {
                liquidBalance,
                totalInvestments,
                realEstateValue,
                goldValue,
                totalLoans,
                monthlyEmi,
                totalAssets,
                netWorth,
                esopsValue,
                esopsTotalValue,
                npsValue,
                ppfValue
            };
        }

        function saveSession() {
            if (currentUser) {
                localStorage.setItem('fintpe_user_email', currentUser);
            }
        }

        function clearSession() {
            localStorage.removeItem('fintpe_user_email');
        }

        function showSuccessMessage(message) {
            const notification = document.createElement('div');
            notification.className = 'success-notification';
            notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        function resendOTP() {
            alert('OTP resent successfully! Use any 6 digits for demo.');
        }

        // Second logout is duplicate - removed in favor of first one

        // Family View Functions
        let dashboardFamilyViewEnabled = false;
        let accountFamilyViewEnabled = false;

        function toggleDashboardFamilyView() {
            dashboardFamilyViewEnabled = !dashboardFamilyViewEnabled;
            
            const individualView = document.getElementById('dashboardIndividualView');
            const familyView = document.getElementById('dashboardFamilyView');
            const toggleButton = document.getElementById('dashboardFamilyToggle');
            
            if (dashboardFamilyViewEnabled) {
                if (individualView) individualView.style.display = 'none';
                if (familyView) familyView.style.display = 'block';
                if (toggleButton) {
                    toggleButton.innerHTML = '<i class="fas fa-user"></i> Individual View';
                }
                showSuccessMessage('Switched to Family Dashboard View');
            } else {
                if (individualView) individualView.style.display = 'block';
                if (familyView) familyView.style.display = 'none';
                if (toggleButton) {
                    toggleButton.innerHTML = '<i class="fas fa-users"></i> Family View';
                }
                showSuccessMessage('Switched to Individual Dashboard View');
            }
        }

        function toggleFamilyView() {
            accountFamilyViewEnabled = !accountFamilyViewEnabled;
            
            const individualView = document.getElementById('individualDashboard');
            const familyView = document.getElementById('familyDashboard');
            const toggleButton = document.getElementById('familyViewToggle');
            
            if (accountFamilyViewEnabled) {
                if (individualView) individualView.style.display = 'none';
                if (familyView) {
                    familyView.style.display = 'block';
                    loadFamilyMembers();
                }
                if (toggleButton) toggleButton.textContent = 'Switch to Individual View';
                showSuccessMessage('Switched to Family Account View');
            } else {
                if (individualView) individualView.style.display = 'block';
                if (familyView) familyView.style.display = 'none';
                if (toggleButton) toggleButton.textContent = 'Switch to Family View';
                showSuccessMessage('Switched to Individual Account View');
            }
        }

        function loadFamilyMembers() {
            const familyContainer = document.getElementById('familyMembersContainer');
            if (!familyContainer) return;
            
            const familyMembers = [
                { name: 'John Doe', role: 'You', wealth: '7,85,920', avatar: 'JD' },
                { name: 'Jane Doe', role: 'Spouse', wealth: '3,25,470', avatar: 'JD' },
                { name: 'Alex Doe', role: 'Child', wealth: '34,500', avatar: 'AD' }
            ];
            
            familyContainer.innerHTML = familyMembers.map(member => `
                <div class="family-member-card">
                    <div class="family-member-avatar">${member.avatar}</div>
                    <div class="family-member-name">${member.name}</div>
                    <div class="family-member-role">${member.role}</div>
                    <div class="family-member-wealth" data-private="${member.wealth}" data-placeholder="">${member.wealth}</div>
                </div>
            `).join('');
            
            // Add invite member card
            familyContainer.innerHTML += `
                <div class="family-member-card add-family-member" onclick="inviteFamilyMember()" style="border: 2px dashed var(--border); cursor: pointer;">
                    <div style="color: var(--text-secondary); font-size: 2rem; margin-bottom: 1rem;">+</div>
                    <div class="family-member-name">Invite Member</div>
                    <div class="family-member-role">Add family member</div>
                </div>
            `;
            
            // Apply privacy mode if enabled
            if (privacyModeEnabled) {
                setTimeout(() => setPrivacyMode(true), 100);
            }
        }

        function inviteFamilyMember() {
            const email = prompt('Enter family member email:');
            if (email && email.includes('@')) {
                showSuccessMessage(`Invitation sent to ${email}`);
            } else if (email) {
                alert('Please enter a valid email address');
            }
        }

        // Settings & Preferences Modal with Profile Editing
        function openSettingsPreferences() {
            const profile = getUserProfile() || {};
            const settingsModal = document.createElement('div');
            settingsModal.className = 'modal';
            settingsModal.style.display = 'block';
            settingsModal.innerHTML = `
                <div class="modal-content" style="max-width: 650px;">
                    <div class="modal-header">
                        <span class="close" onclick="closeSettingsModal()">&times;</span>
                        <h2>Settings</h2>
                        <p>Manage your account and preferences</p>
                    </div>
                    <div class="modal-body" style="padding: 0;">
                        <!-- Settings Tabs -->
                        <div class="settings-tabs">
                            <button class="settings-tab active" onclick="switchSettingsTab('profile')">
                                <i class="fas fa-user"></i> Profile
                            </button>
                            <button class="settings-tab" onclick="switchSettingsTab('preferences')">
                                <i class="fas fa-sliders-h"></i> Preferences
                            </button>
                            <button class="settings-tab" onclick="switchSettingsTab('account')">
                                <i class="fas fa-shield-alt"></i> Account
                            </button>
                        </div>

                        <!-- Profile Tab -->
                        <div class="settings-tab-content" id="settingsTabProfile" style="padding: 1.5rem;">
                            <form id="editProfileForm" onsubmit="saveProfileChanges(event)">
                                <div class="form-section-title">Personal Information</div>
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" id="editProfileName" value="${profile.name || ''}" required>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Date of Birth</label>
                                        <input type="date" id="editProfileDOB" value="${profile.dateOfBirth || ''}">
                                    </div>
                                    <div class="form-group">
                                        <label>Gender</label>
                                        <select id="editProfileGender">
                                            <option value="">Select</option>
                                            <option value="male" ${profile.gender === 'male' ? 'selected' : ''}>Male</option>
                                            <option value="female" ${profile.gender === 'female' ? 'selected' : ''}>Female</option>
                                            <option value="other" ${profile.gender === 'other' ? 'selected' : ''}>Other</option>
                                            <option value="prefer-not" ${profile.gender === 'prefer-not' ? 'selected' : ''}>Prefer not to say</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" id="editProfilePhone" value="${profile.phone || ''}" placeholder="+91 98765 43210">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="${currentUser || ''}" disabled style="background: var(--light); cursor: not-allowed;">
                                    <small style="color: var(--text-muted);">Email cannot be changed</small>
                                </div>

                                <div class="form-section-title" style="margin-top: 1.5rem;">Financial Profile</div>
                                <div class="form-group">
                                    <label>Employment Status</label>
                                    <select id="editProfileEmployment">
                                        <option value="">Select</option>
                                        <option value="salaried" ${profile.employment === 'salaried' ? 'selected' : ''}>Salaried</option>
                                        <option value="self-employed" ${profile.employment === 'self-employed' ? 'selected' : ''}>Self Employed</option>
                                        <option value="business" ${profile.employment === 'business' ? 'selected' : ''}>Business Owner</option>
                                        <option value="freelancer" ${profile.employment === 'freelancer' ? 'selected' : ''}>Freelancer</option>
                                        <option value="student" ${profile.employment === 'student' ? 'selected' : ''}>Student</option>
                                        <option value="retired" ${profile.employment === 'retired' ? 'selected' : ''}>Retired</option>
                                        <option value="homemaker" ${profile.employment === 'homemaker' ? 'selected' : ''}>Homemaker</option>
                                        <option value="other" ${profile.employment === 'other' ? 'selected' : ''}>Other</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Monthly Income Range</label>
                                        <select id="editProfileIncome">
                                            <option value="">Select</option>
                                            <option value="0-25000" ${profile.incomeRange === '0-25000' ? 'selected' : ''}>Below 25,000</option>
                                            <option value="25000-50000" ${profile.incomeRange === '25000-50000' ? 'selected' : ''}>25,000 - 50,000</option>
                                            <option value="50000-100000" ${profile.incomeRange === '50000-100000' ? 'selected' : ''}>50,000 - 1,00,000</option>
                                            <option value="100000-250000" ${profile.incomeRange === '100000-250000' ? 'selected' : ''}>1,00,000 - 2,50,000</option>
                                            <option value="250000-500000" ${profile.incomeRange === '250000-500000' ? 'selected' : ''}>2,50,000 - 5,00,000</option>
                                            <option value="500000+" ${profile.incomeRange === '500000+' ? 'selected' : ''}>Above 5,00,000</option>
                                            <option value="prefer-not" ${profile.incomeRange === 'prefer-not' ? 'selected' : ''}>Prefer not to say</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Primary Currency</label>
                                        <select id="editProfileCurrency">
                                            <option value="INR" ${profile.currency === 'INR' ? 'selected' : ''}> INR</option>
                                            <option value="USD" ${profile.currency === 'USD' ? 'selected' : ''}>$ USD</option>
                                            <option value="EUR" ${profile.currency === 'EUR' ? 'selected' : ''}> EUR</option>
                                            <option value="GBP" ${profile.currency === 'GBP' ? 'selected' : ''}> GBP</option>
                                            <option value="AED" ${profile.currency === 'AED' ? 'selected' : ''}>. AED</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Risk Tolerance</label>
                                    <select id="editProfileRisk">
                                        <option value="conservative" ${profile.riskTolerance === 'conservative' ? 'selected' : ''}>Conservative</option>
                                        <option value="moderate" ${profile.riskTolerance === 'moderate' ? 'selected' : ''}>Moderate</option>
                                        <option value="aggressive" ${profile.riskTolerance === 'aggressive' ? 'selected' : ''}>Aggressive</option>
                                    </select>
                                </div>

                                <div class="form-section-title" style="margin-top: 1.5rem;">Financial Goals</div>
                                <div class="checkbox-group" id="editProfileGoals">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="track-expenses" ${profile.goals?.includes('track-expenses') ? 'checked' : ''}> Track daily expenses
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="build-savings" ${profile.goals?.includes('build-savings') ? 'checked' : ''}> Build emergency savings
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="invest" ${profile.goals?.includes('invest') ? 'checked' : ''}> Start/grow investments
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="debt-free" ${profile.goals?.includes('debt-free') ? 'checked' : ''}> Become debt-free
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="retirement" ${profile.goals?.includes('retirement') ? 'checked' : ''}> Plan for retirement
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="editGoals" value="net-worth" ${profile.goals?.includes('net-worth') ? 'checked' : ''}> Track net worth
                                    </label>
                                </div>

                                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; justify-content: center;">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </form>
                        </div>

                        <!-- Preferences Tab -->
                        <div class="settings-tab-content" id="settingsTabPreferences" style="display: none; padding: 1.5rem;">
                            <div class="settings-toggle-section" style="background: transparent; padding: 0; border: none; box-shadow: none;">
                                <div class="toggle-setting-item">
                                    <div class="toggle-setting-info">
                                        <h3>Privacy mode</h3>
                                        <p>Hide sensitive financial information with blur effect.</p>
                                    </div>
                                    <button class="ios-toggle" id="modalPrivacyToggle" onclick="togglePrivacyModeFromModal()">
                                        <div class="ios-toggle-slider"></div>
                                    </button>
                                </div>

                                <div class="toggle-setting-item">
                                    <div class="toggle-setting-info">
                                        <h3>Dark theme</h3>
                                        <p>Switch between light and dark theme.</p>
                                    </div>
                                    <button class="ios-toggle" id="modalThemeToggle" onclick="toggleThemeFromModal()">
                                        <div class="ios-toggle-slider"></div>
                                    </button>
                                </div>

                                <div class="toggle-setting-item">
                                    <div class="toggle-setting-info">
                                        <h3>Email notifications</h3>
                                        <p>Receive email notifications for account activities.</p>
                                    </div>
                                    <button class="ios-toggle active" id="modalEmailToggle" onclick="toggleEmailNotificationsFromModal()">
                                        <div class="ios-toggle-slider"></div>
                                    </button>
                                </div>

                                <div class="toggle-setting-item">
                                    <div class="toggle-setting-info">
                                        <h3>SMS alerts</h3>
                                        <p>Get SMS alerts for transactions and security.</p>
                                    </div>
                                    <button class="ios-toggle active" id="modalSmsToggle" onclick="toggleSmsAlertsFromModal()">
                                        <div class="ios-toggle-slider"></div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Account Tab -->
                        <div class="settings-tab-content" id="settingsTabAccount" style="display: none; padding: 1.5rem;">
                            <div class="form-section-title">Security</div>
                            <div class="account-action-item" onclick="showChangePasswordForm()">
                                <div class="action-icon"><i class="fas fa-key"></i></div>
                                <div class="action-info">
                                    <h4>Change Password</h4>
                                    <p>Update your account password</p>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="toggle-setting-item" style="margin-top: 1rem;">
                                <div class="toggle-setting-info">
                                    <h3>Biometric login</h3>
                                    <p>Enable fingerprint or face recognition.</p>
                                </div>
                                <button class="ios-toggle" id="modalBiometricToggle" onclick="toggleBiometricLogin()">
                                    <div class="ios-toggle-slider"></div>
                                </button>
                            </div>

                            <div class="form-section-title" style="margin-top: 2rem;">Data Management</div>
                            <div class="account-action-item" onclick="exportUserData()">
                                <div class="action-icon" style="background: #d1fae5; color: #10b981;"><i class="fas fa-download"></i></div>
                                <div class="action-info">
                                    <h4>Export Data</h4>
                                    <p>Download all your data as JSON</p>
                                </div>
                                <i class="fas fa-chevron-right"></i>
                            </div>

                            <div class="form-section-title" style="margin-top: 2rem; color: var(--danger);">Danger Zone</div>
                            <div class="account-action-item" onclick="confirmDeleteAccount()" style="border-color: #fee2e2;">
                                <div class="action-icon" style="background: #fee2e2; color: var(--danger);"><i class="fas fa-trash-alt"></i></div>
                                <div class="action-info">
                                    <h4 style="color: var(--danger);">Delete Account</h4>
                                    <p>Permanently delete your account and data</p>
                                </div>
                                <i class="fas fa-chevron-right" style="color: var(--danger);"></i>
                            </div>

                            <button class="btn btn-tertiary" style="width: 100%; margin-top: 2rem; justify-content: center; color: var(--danger);" onclick="logout(); closeSettingsModal();">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(settingsModal);
            settingsModal.id = 'settingsModal';

            // Sync toggle states
            setTimeout(() => {
                const savedTheme = localStorage.getItem('fintpe_theme');
                const savedPrivacy = localStorage.getItem('fintpe_privacy') === 'true';

                if (savedTheme === 'dark') {
                    const toggle = document.getElementById('modalThemeToggle');
                    if (toggle) toggle.classList.add('active');
                }
                if (savedPrivacy) {
                    const toggle = document.getElementById('modalPrivacyToggle');
                    if (toggle) toggle.classList.add('active');
                }
            }, 100);
        }

        function switchSettingsTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.settings-tab').forEach((t, i) => {
                t.classList.remove('active');
                if ((tab === 'profile' && i === 0) || (tab === 'preferences' && i === 1) || (tab === 'account' && i === 2)) {
                    t.classList.add('active');
                }
            });

            // Update tab content
            document.getElementById('settingsTabProfile').style.display = tab === 'profile' ? 'block' : 'none';
            document.getElementById('settingsTabPreferences').style.display = tab === 'preferences' ? 'block' : 'none';
            document.getElementById('settingsTabAccount').style.display = tab === 'account' ? 'block' : 'none';
        }

        function saveProfileChanges(event) {
            event.preventDefault();

            const goals = [];
            document.querySelectorAll('input[name="editGoals"]:checked').forEach(cb => {
                goals.push(cb.value);
            });

            const updatedProfile = {
                name: document.getElementById('editProfileName').value,
                dateOfBirth: document.getElementById('editProfileDOB').value,
                gender: document.getElementById('editProfileGender').value,
                phone: document.getElementById('editProfilePhone').value,
                employment: document.getElementById('editProfileEmployment').value,
                incomeRange: document.getElementById('editProfileIncome').value,
                currency: document.getElementById('editProfileCurrency').value,
                riskTolerance: document.getElementById('editProfileRisk').value,
                goals: goals,
                onboardingComplete: true,
                updatedAt: new Date().toISOString()
            };

            saveUserProfile(updatedProfile);
            updateNavigationForLogin();
            showMessage('Profile updated successfully!', 'success');
        }

        function exportUserData() {
            const profile = getUserProfile();
            const data = {
                email: currentUser,
                profile: profile,
                exportedAt: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fintpe-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showMessage('Data exported successfully!', 'success');
        }

        function confirmDeleteAccount() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                if (confirm('This will permanently delete all your data. Type "DELETE" to confirm.')) {
                    const users = getUsers();
                    delete users[currentUser];
                    saveUsers(users);
                    logout();
                    closeSettingsModal();
                    showMessage('Account deleted successfully', 'info');
                }
            }
        }

        function showChangePasswordForm() {
            const currentPassword = prompt('Enter your current password:');
            if (!currentPassword) return;

            const users = getUsers();
            if (users[currentUser].password !== currentPassword) {
                showMessage('Incorrect current password', 'error');
                return;
            }

            const newPassword = prompt('Enter new password (min 6 characters):');
            if (!newPassword || newPassword.length < 6) {
                showMessage('Password must be at least 6 characters', 'error');
                return;
            }

            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            users[currentUser].password = newPassword;
            saveUsers(users);
            showMessage('Password changed successfully!', 'success');
        }

        function closeSettingsModal() {
            const modal = document.getElementById('settingsModal');
            if (modal) {
                modal.remove();
            }
        }

        function togglePrivacyModeFromModal() {
            setPrivacyMode(!privacyModeEnabled);
        }

        function toggleThemeFromModal() {
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
        }

        function toggleEmailNotificationsFromModal() {
            const toggle = document.getElementById('modalEmailToggle');
            if (toggle) {
                toggle.classList.toggle('active');
                const enabled = toggle.classList.contains('active');
                showSuccessMessage(`Email notifications ${enabled ? 'enabled' : 'disabled'}`);
            }
        }

        function toggleSmsAlertsFromModal() {
            const toggle = document.getElementById('modalSmsToggle');
            if (toggle) {
                toggle.classList.toggle('active');
                const enabled = toggle.classList.contains('active');
                showSuccessMessage(`SMS alerts ${enabled ? 'enabled' : 'disabled'}`);
            }
        }

        // Calendar Modal Functions
        let selectedDate = new Date();
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        const upcomingEvents = {
            '2025-01-25': [
                { type: 'emi', title: 'Home Loan EMI', details: 'SBI Home Loan', amount: '22,450', status: 'pending' }
            ],
            '2025-01-28': [
                { type: 'sip', title: 'SIP Investment', details: 'Axis Bluechip Fund', amount: '15,000', status: 'auto' }
            ],
            '2025-02-02': [
                { type: 'insurance', title: 'Health Insurance', details: 'HDFC ERGO Premium', amount: '8,500', status: 'due' }
            ],
            '2025-02-05': [
                { type: 'bill', title: 'Postpaid Bill', details: 'Airtel Mobile', amount: '1,250', status: 'auto' }
            ],
            '2025-02-10': [
                { type: 'sip', title: 'SIP Investment', details: 'HDFC Top 100 Fund', amount: '10,000', status: 'auto' }
            ],
            '2025-02-12': [
                { type: 'emi', title: 'Car Loan EMI', details: 'HDFC Auto Loan', amount: '8,450', status: 'pending' }
            ],
            '2025-02-15': [
                { type: 'bill', title: 'Credit Card Bill', details: 'HDFC Regalia', amount: '15,670', status: 'due' },
                { type: 'bill', title: 'Electricity Bill', details: 'Maharashtra State', amount: '2,850', status: 'pending' }
            ]
        };

        function openCalendarModal() {
            const calendarModal = document.createElement('div');
            calendarModal.className = 'calendar-modal';
            calendarModal.style.display = 'block';
            calendarModal.id = 'calendarModal';

            const today = new Date();
            const todayKey = formatDateKey(today);
            selectedDate = today;

            calendarModal.innerHTML = `
                <div class="calendar-modal-content">
                    <div class="calendar-modal-header">
                        <span class="close" onclick="closeCalendarModal()">&times;</span>
                        <h2><i class="fas fa-calendar-alt"></i> Financial Calendar</h2>
                        <p>Track all your upcoming financial events and commitments</p>
                    </div>
                    <div class="calendar-modal-body">
                        <div class="calendar-container">
                            <div class="calendar-grid">
                                <div class="calendar-header">
                                    <button onclick="previousMonth()" class="calendar-nav-btn">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span id="monthYearDisplay">${getMonthName(currentMonth)} ${currentYear}</span>
                                    <button onclick="nextMonth()" class="calendar-nav-btn">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <div class="calendar-days">
                                    <div class="calendar-day-header">Sun</div>
                                    <div class="calendar-day-header">Mon</div>
                                    <div class="calendar-day-header">Tue</div>
                                    <div class="calendar-day-header">Wed</div>
                                    <div class="calendar-day-header">Thu</div>
                                    <div class="calendar-day-header">Fri</div>
                                    <div class="calendar-day-header">Sat</div>
                                    <div id="calendarDaysContainer">
                                        <!-- Calendar days will be generated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="calendar-events-panel">
                                <div class="selected-date-header" id="selectedDateHeader">
                                    Today - ${formatDisplayDate(today)}
                                </div>
                                <div class="event-list" id="eventsList">
                                    <!-- Events for selected date will appear here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(calendarModal);
            generateCalendarDays();
            updateEventsPanel(todayKey);
        }

        function closeCalendarModal() {
            const modal = document.getElementById('calendarModal');
            if (modal) {
                modal.remove();
            }
        }

        function generateCalendarDays() {
            const container = document.getElementById('calendarDaysContainer');
            if (!container) return;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            let daysHTML = '';
            const today = new Date();

            for (let i = 0; i < 42; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                
                const dateKey = formatDateKey(currentDate);
                const events = upcomingEvents[dateKey] || [];
                
                let classes = ['calendar-day'];
                if (currentDate.getMonth() !== currentMonth) {
                    classes.push('other-month');
                }
                if (currentDate.toDateString() === today.toDateString()) {
                    classes.push('today');
                }
                if (currentDate.toDateString() === selectedDate.toDateString()) {
                    classes.push('selected');
                }

                let eventDots = '';
                events.forEach(event => {
                    eventDots += `<span class="event-dot ${event.type}"></span>`;
                });

                daysHTML += `
                    <div class="${classes.join(' ')}" onclick="selectDate('${dateKey}')">
                        <div class="calendar-day-number">${currentDate.getDate()}</div>
                        <div>${eventDots}</div>
                    </div>
                `;
            }

            container.innerHTML = daysHTML;
        }

        function selectDate(dateKey) {
            const [year, month, day] = dateKey.split('-');
            selectedDate = new Date(year, month - 1, day);
            
            // Update visual selection
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            event.target.closest('.calendar-day').classList.add('selected');
            
            updateEventsPanel(dateKey);
        }

        function updateEventsPanel(dateKey) {
            const eventsContainer = document.getElementById('eventsList');
            const headerElement = document.getElementById('selectedDateHeader');
            
            if (!eventsContainer || !headerElement) return;

            const [year, month, day] = dateKey.split('-');
            const date = new Date(year, month - 1, day);
            headerElement.textContent = formatDisplayDate(date);

            const events = upcomingEvents[dateKey] || [];

            if (events.length === 0) {
                eventsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>No events scheduled for this date</p>
                    </div>
                `;
                return;
            }

            eventsContainer.innerHTML = events.map(event => `
                <div class="event-item" onclick="showEventDetails('${event.type}')">
                    <div class="event-title">
                        <span class="event-dot ${event.type}"></span>
                        ${event.title}
                    </div>
                    <div class="event-details">
                        <span>${event.details}</span>
                        <span class="event-amount" style="color: ${getEventColor(event.type)};">${event.amount}</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        Status: ${getStatusDisplay(event.status)}
                    </div>
                </div>
            `).join('');
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendarDisplay();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateCalendarDisplay();
        }

        function updateCalendarDisplay() {
            const monthYearDisplay = document.getElementById('monthYearDisplay');
            if (monthYearDisplay) {
                monthYearDisplay.textContent = `${getMonthName(currentMonth)} ${currentYear}`;
            }
            generateCalendarDays();
        }

        function formatDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatDisplayDate(date) {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            if (date.toDateString() === today.toDateString()) {
                return 'Today - ' + date.toLocaleDateString('en-IN', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return 'Tomorrow - ' + date.toLocaleDateString('en-IN', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } else {
                return date.toLocaleDateString('en-IN', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        }

        function getMonthName(monthIndex) {
            const months = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
            return months[monthIndex];
        }

        function getEventColor(eventType) {
            switch (eventType) {
                case 'emi': return 'var(--danger)';
                case 'sip': return 'var(--success)';
                case 'insurance': return 'var(--primary)';
                case 'bill': return 'var(--warning)';
                default: return 'var(--text-primary)';
            }
        }

        function getStatusDisplay(status) {
            switch (status) {
                case 'pending': return ' Pending Action';
                case 'auto': return ' Auto-pay Enabled';
                case 'due': return ' Due Soon';
                default: return status;
            }
        }

        function showEventDetails(eventType) {
            const eventDetails = {
                'emi': {
                    title: 'EMI Payment Details',
                    content: 'Home Loan EMI of 22,450 is due on January 25th. Auto-pay is disabled for this account. Please ensure sufficient balance or set up auto-pay to avoid late fees.'
                },
                'sip': {
                    title: 'SIP Investment Details',
                    content: 'Your SIP of 15,000 in Axis Bluechip Fund is scheduled for January 28th. Auto-pay is enabled from your savings account. This is your 18th installment.'
                },
                'insurance': {
                    title: 'Insurance Premium Details',
                    content: 'Health Insurance premium of 8,500 for HDFC ERGO is due on February 2nd. Annual premium with 15% discount applied. Coverage: 10 Lakhs.'
                },
                'bill': {
                    title: 'Bill Payment Details',
                    content: 'Airtel postpaid bill of 1,250 is due on February 5th. Includes unlimited calls, 75GB data, and OTT subscriptions. Auto-pay is enabled.'
                }
            };

            const details = eventDetails[eventType];
            if (details) {
                alert(`${details.title}\n\n${details.content}`);
            }
        }

        // Enhanced Family Insight Functions
        function openNetWorthInsights() {
            createInsightModal('Family Net Worth Analysis', 'Complete wealth breakdown and asset allocation', [
                {
                    title: 'Total Net Worth',
                    icon: 'fas fa-crown',
                    value: '2,45,67,890',
                    description: 'Total assets minus liabilities across all family members',
                    change: '+4,85,320 this quarter (+2.01%)'
                },
                {
                    title: 'Asset Breakdown',
                    icon: 'fas fa-chart-pie',
                    value: '2,67,89,450',
                    description: 'Real Estate: 32% | Investments: 48% | Gold: 5% | Cash: 15%',
                    progress: 85
                },
                {
                    title: 'Liabilities',
                    icon: 'fas fa-credit-card',
                    value: '22,21,560',
                    description: 'Home Loan: 18,50,000 | Credit Cards: 2,45,000 | Personal: 1,26,560'
                },
                {
                    title: 'Wealth Growth Rate',
                    icon: 'fas fa-trending-up',
                    value: '+18.5% YoY',
                    description: 'Consistent wealth building with diversified portfolio strategy'
                }
            ]);
        }

        function openRealEstateInsights() {
            createInsightModal('Real Estate Portfolio', 'Property investments and market analysis', [
                {
                    title: 'Total Property Value',
                    icon: 'fas fa-home',
                    value: '85,50,000',
                    description: 'Current market valuation of family properties',
                    change: '+8.5% appreciation this year'
                },
                {
                    title: 'Primary Residence',
                    icon: 'fas fa-house-user',
                    value: '65,00,000',
                    description: '3BHK apartment in Mumbai | Purchased: 52,00,000 (2019)',
                    progress: 76
                },
                {
                    title: 'Investment Property',
                    icon: 'fas fa-building',
                    value: '20,50,000',
                    description: '2BHK rental property | Monthly rent: 18,000',
                    progress: 24
                },
                {
                    title: 'Market Outlook',
                    icon: 'fas fa-chart-area',
                    value: 'Positive',
                    description: 'Properties in growth areas with 6-8% expected annual appreciation'
                }
            ]);
        }

        function openGoldInsights() {
            createInsightModal('Gold Holdings Portfolio', 'Precious metals investment tracking', [
                {
                    title: 'Total Gold Value',
                    icon: 'fas fa-coins',
                    value: '12,45,600',
                    description: 'Combined physical and digital gold investments',
                    change: '+12.8% vs average purchase price'
                },
                {
                    title: 'Physical Gold',
                    icon: 'fas fa-gem',
                    value: '185 grams',
                    description: 'Jewelry: 120g | Coins: 45g | Bars: 20g | Avg price: 5,200/g',
                    progress: 68
                },
                {
                    title: 'Digital Gold',
                    icon: 'fas fa-mobile-alt',
                    value: '55 grams',
                    description: 'Gold ETFs and digital gold platforms | Avg price: 5,450/g',
                    progress: 32
                },
                {
                    title: 'Gold Strategy',
                    icon: 'fas fa-shield-alt',
                    value: '5% Allocation',
                    description: 'Hedge against inflation | Target: 7-10% of total portfolio'
                }
            ]);
        }

        function openFamilyBalanceInsights() {
            createInsightModal('Liquid Assets Analysis', 'Cash and readily available funds', [
                {
                    title: 'Total Liquid Assets',
                    icon: 'fas fa-tint',
                    value: '18,45,890',
                    description: 'Immediately accessible funds across all accounts',
                    change: '+32,450 this month'
                },
                {
                    title: 'Emergency Fund',
                    icon: 'fas fa-shield-alt',
                    value: '6,50,000',
                    description: '6 months of expenses covered | Target achieved ',
                    progress: 100
                },
                {
                    title: 'Account Distribution',
                    icon: 'fas fa-university',
                    value: '5 Accounts',
                    description: 'Savings: 8,50,000 | Current: 4,95,890 | FD: 5,00,000'
                },
                {
                    title: 'Monthly Inflow',
                    icon: 'fas fa-arrow-down',
                    value: '1,27,000',
                    description: 'John: 85,000 | Jane: 42,000 | Interest: 2,500'
                }
            ]);
        }

        function openFamilyInvestmentInsights() {
            createInsightModal('Investment Portfolio Analysis', 'Comprehensive investment breakdown', [
                {
                    title: 'Total Investment Value',
                    icon: 'fas fa-chart-line',
                    value: '1,28,54,200',
                    description: 'Diversified investment portfolio across asset classes',
                    change: '+15.2% returns (YTD)'
                },
                {
                    title: 'Mutual Funds',
                    icon: 'fas fa-chart-area',
                    value: '85,20,000',
                    description: 'Equity: 60% | Debt: 30% | Hybrid: 10% | 22 active SIPs',
                    progress: 66
                },
                {
                    title: 'Direct Stocks',
                    icon: 'fas fa-chart-bar',
                    value: '32,50,000',
                    description: 'Blue-chip stocks and growth companies | 15 holdings',
                    progress: 25
                },
                {
                    title: 'Fixed Deposits',
                    icon: 'fas fa-piggy-bank',
                    value: '10,84,200',
                    description: 'Conservative allocation | Average return: 6.5% p.a.',
                    progress: 9
                }
            ]);
        }

        function openFamilySpendingInsights() {
            createInsightModal('Family Spending Analysis', 'Monthly expense breakdown and trends', [
                {
                    title: 'Monthly Family Spending',
                    icon: 'fas fa-credit-card',
                    value: '78,650',
                    description: 'Total family expenses this month',
                    change: '-5,200 vs last month (6.2% reduction)'
                },
                {
                    title: 'Housing & Utilities',
                    icon: 'fas fa-home',
                    value: '28,500',
                    description: 'Rent/EMI: 22,000 | Utilities: 4,500 | Maintenance: 2,000',
                    progress: 36
                },
                {
                    title: 'Food & Dining',
                    icon: 'fas fa-utensils',
                    value: '18,200',
                    description: 'Groceries: 12,000 | Dining out: 4,500 | Online orders: 1,700',
                    progress: 23
                },
                {
                    title: 'Transport & Travel',
                    icon: 'fas fa-car',
                    value: '12,450',
                    description: 'Fuel: 7,500 | Public transport: 2,950 | Maintenance: 2,000',
                    progress: 16
                }
            ]);
        }

        function openFamilyGoalsInsights() {
            createInsightModal('Family Financial Goals', 'Progress tracking for major objectives', [
                {
                    title: 'House Down Payment',
                    icon: 'fas fa-home',
                    value: '65,00,000',
                    description: 'Target: 80,00,000 for dream home | Timeline: 2 years',
                    progress: 81
                },
                {
                    title: 'Children Education Fund',
                    icon: 'fas fa-graduation-cap',
                    value: '18,50,000',
                    description: 'Target: 35,00,000 for Alex\'s higher education',
                    progress: 53
                },
                {
                    title: 'Retirement Corpus',
                    icon: 'fas fa-umbrella',
                    value: '85,00,000',
                    description: 'Target: 3,50,00,000 for comfortable retirement',
                    progress: 24
                },
                {
                    title: 'Emergency Fund',
                    icon: 'fas fa-shield-alt',
                    value: '6,50,000',
                    description: 'Target: 6,50,000 (6 months expenses) | Status: Complete ',
                    progress: 100
                }
            ]);
        }

        function openMemberInsights(memberName) {
            const memberData = {
                'john': {
                    name: 'John Doe',
                    role: 'Primary Account Holder',
                    insights: [
                        {
                            title: 'Personal Balance',
                            icon: 'fas fa-wallet',
                            value: '7,85,920',
                            description: 'Across 3 accounts: Savings, Salary, Investment',
                            change: '+12.5% growth this year'
                        },
                        {
                            title: 'Monthly Income',
                            icon: 'fas fa-hand-holding-usd',
                            value: '85,000',
                            description: 'Primary income source for family',
                        },
                        {
                            title: 'Investment Portfolio',
                            icon: 'fas fa-chart-line',
                            value: '5,85,000',
                            description: 'Mutual Funds: 3,50,000 | Stocks: 2,35,000',
                            progress: 65
                        },
                        {
                            title: 'Spending Pattern',
                            icon: 'fas fa-credit-card',
                            value: '35,200',
                            description: 'Monthly average: Housing 40% | Food 25% | Transport 15%'
                        }
                    ]
                },
                'jane': {
                    name: 'Jane Doe',
                    role: 'Spouse & Co-contributor',
                    insights: [
                        {
                            title: 'Personal Balance',
                            icon: 'fas fa-wallet',
                            value: '6,25,470',
                            description: 'Freelance earnings + savings account',
                            change: '+18.2% growth this year'
                        },
                        {
                            title: 'Freelance Income',
                            icon: 'fas fa-laptop',
                            value: '42,000',
                            description: 'Variable monthly income from consulting'
                        },
                        {
                            title: 'Investment Focus',
                            icon: 'fas fa-seedling',
                            value: 'SIP Focused',
                            description: '15,000 monthly SIP in diversified funds',
                            progress: 80
                        },
                        {
                            title: 'Spending Pattern',
                            icon: 'fas fa-shopping-cart',
                            value: '28,500',
                            description: 'Healthcare 30% | Education 25% | Personal 45%'
                        }
                    ]
                },
                'alex': {
                    name: 'Alex Doe',
                    role: 'Child - Education Fund',
                    insights: [
                        {
                            title: 'Education Fund',
                            icon: 'fas fa-graduation-cap',
                            value: '4,34,500',
                            description: 'Dedicated education savings account',
                            change: '+25.7% growth this year'
                        },
                        {
                            title: 'Monthly Contribution',
                            icon: 'fas fa-piggy-bank',
                            value: '8,000',
                            description: 'Regular contributions from both parents'
                        },
                        {
                            title: 'Future Target',
                            icon: 'fas fa-target',
                            value: '25,00,000',
                            description: 'Higher education fund target by age 18',
                            progress: 17
                        },
                        {
                            title: 'Investment Mix',
                            icon: 'fas fa-chart-pie',
                            value: 'Conservative',
                            description: 'Equity 40% | Debt 50% | Gold 10% (Age-appropriate)'
                        }
                    ]
                }
            };

            const member = memberData[memberName];
            if (member) {
                createInsightModal(`${member.name} - Financial Insights`, member.role, member.insights);
            }
        }

        function createInsightModal(title, subtitle, insights) {
            // Remove existing insight modal
            const existingModal = document.getElementById('insightModal');
            if (existingModal) {
                existingModal.remove();
            }

            const modal = document.createElement('div');
            modal.className = 'insight-modal';
            modal.style.display = 'block';
            modal.id = 'insightModal';

            modal.innerHTML = `
                <div class="insight-modal-content">
                    <div class="insight-modal-header">
                        <span class="close" onclick="closeInsightModal()">&times;</span>
                        <h2>${title}</h2>
                        <p>${subtitle}</p>
                    </div>
                    <div class="insight-modal-body">
                        <div class="insights-grid">
                            ${insights.map(insight => `
                                <div class="insight-card">
                                    <h4><i class="${insight.icon}"></i> ${insight.title}</h4>
                                    <div class="insight-value">${insight.value}</div>
                                    ${insight.change ? `<div style="color: var(--success); font-size: 0.9rem; margin-bottom: 0.5rem;">${insight.change}</div>` : ''}
                                    ${insight.progress ? `
                                        <div class="progress-bar-container">
                                            <div class="progress-bar-fill" style="width: ${insight.progress}%; background: linear-gradient(90deg, var(--primary), var(--success));"></div>
                                        </div>
                                    ` : ''}
                                    <div class="insight-description">${insight.description}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button onclick="exportInsights()" class="btn btn-secondary" style="margin-right: 1rem;">
                                <i class="fas fa-download"></i> Export Report
                            </button>
                            <button onclick="scheduleReview()" class="btn btn-primary">
                                <i class="fas fa-calendar-plus"></i> Schedule Review
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Animate progress bars
            setTimeout(() => {
                const progressBars = modal.querySelectorAll('.progress-bar-fill');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 300);
        }

        function closeInsightModal() {
            const modal = document.getElementById('insightModal');
            if (modal) {
                modal.remove();
            }
        }

        function exportInsights() {
            showSuccessMessage(' Insights report exported successfully!');
            closeInsightModal();
        }

        function scheduleReview() {
            showSuccessMessage(' Review meeting scheduled successfully!');
            closeInsightModal();
        }

        // Individual Dashboard Insight Functions
        function openIndividualNetWorthInsights() {
            createInsightModal('Your Personal Net Worth', 'Complete breakdown of your individual wealth', [
                {
                    title: 'Your Net Worth',
                    icon: 'fas fa-user-crown',
                    value: '1,25,85,920',
                    description: 'Your total assets minus liabilities',
                    change: '+2,15,450 this quarter (+1.8%)'
                },
                {
                    title: 'Asset Distribution',
                    icon: 'fas fa-chart-pie',
                    value: '1,42,50,920',
                    description: 'Investments: 46% | Real Estate: 32% | Gold: 5% | Cash: 17%',
                    progress: 88
                },
                {
                    title: 'Your Liabilities',
                    icon: 'fas fa-credit-card',
                    value: '16,65,000',
                    description: 'Home Loan: 12,50,000 | Car Loan: 3,15,000 | Credit Card: 1,00,000'
                },
                {
                    title: 'Wealth Ranking',
                    icon: 'fas fa-trophy',
                    value: 'Top 15%',
                    description: 'Among your peer group (30-35 years, IT professionals)'
                }
            ]);
        }

        function openIndividualBalanceInsights() {
            createInsightModal('Your Liquid Assets', 'Cash and readily available funds breakdown', [
                {
                    title: 'Total Liquid Balance',
                    icon: 'fas fa-wallet',
                    value: '9,85,920',
                    description: 'Immediately accessible funds across your accounts',
                    change: '+18,450 this month'
                },
                {
                    title: 'Primary Savings',
                    icon: 'fas fa-piggy-bank',
                    value: '5,50,000',
                    description: 'SBI Savings Account | Interest: 3.5% p.a.',
                    progress: 56
                },
                {
                    title: 'Salary Account',
                    icon: 'fas fa-briefcase',
                    value: '2,85,920',
                    description: 'HDFC Salary Account | Monthly inflow: 85,000',
                    progress: 29
                },
                {
                    title: 'Fixed Deposit',
                    icon: 'fas fa-certificate',
                    value: '1,50,000',
                    description: 'Emergency fund | 6.8% p.a. | Matures in 8 months',
                    progress: 15
                }
            ]);
        }

        function openIndividualInvestmentInsights() {
            createInsightModal('Your Investment Portfolio', 'Personal investment analysis and performance', [
                {
                    title: 'Total Investment Value',
                    icon: 'fas fa-chart-line',
                    value: '65,85,000',
                    description: 'Your personal investment portfolio',
                    change: '+14.2% returns (YTD)'
                },
                {
                    title: 'Mutual Funds',
                    icon: 'fas fa-chart-area',
                    value: '42,00,000',
                    description: 'Equity: 65% | Debt: 25% | Hybrid: 10% | 12 SIPs active',
                    progress: 64
                },
                {
                    title: 'Direct Stocks',
                    icon: 'fas fa-chart-bar',
                    value: '18,50,000',
                    description: 'Tech stocks: 60% | Banking: 25% | Pharma: 15%',
                    progress: 28
                },
                {
                    title: 'ELSS (Tax Saving)',
                    icon: 'fas fa-shield-alt',
                    value: '5,35,000',
                    description: 'Tax saving funds | 3-year lock-in | 1.5L limit utilized',
                    progress: 8
                }
            ]);
        }

        function openIndividualRealEstateInsights() {
            createInsightModal('Your Real Estate Holdings', 'Property investments and valuations', [
                {
                    title: 'Total Property Value',
                    icon: 'fas fa-home',
                    value: '45,50,000',
                    description: 'Current market value of your property share',
                    change: '+7.2% appreciation this year'
                },
                {
                    title: 'Primary Residence Share',
                    icon: 'fas fa-house-user',
                    value: '35,00,000',
                    description: '60% ownership in family home (Mumbai) | Co-owned with spouse',
                    progress: 77
                },
                {
                    title: 'Investment Plot',
                    icon: 'fas fa-map-marked',
                    value: '10,50,000',
                    description: '500 sq ft plot in Pune | Purchased 2021 | Ready for development',
                    progress: 23
                },
                {
                    title: 'Rental Potential',
                    icon: 'fas fa-key',
                    value: '0',
                    description: 'Primary residence occupied | Plot undeveloped'
                }
            ]);
        }

        function openIndividualGoldInsights() {
            createInsightModal('Your Gold Portfolio', 'Personal precious metals investment', [
                {
                    title: 'Total Gold Value',
                    icon: 'fas fa-coins',
                    value: '6,85,000',
                    description: 'Your share of family gold holdings',
                    change: '+11.5% vs average purchase price'
                },
                {
                    title: 'Physical Gold',
                    icon: 'fas fa-gem',
                    value: '95 grams',
                    description: 'Gold coins: 25g | Investment bars: 15g | Jewelry share: 55g',
                    progress: 68
                },
                {
                    title: 'Digital Gold',
                    icon: 'fas fa-mobile-alt',
                    value: '35 grams',
                    description: 'Gold ETF: 20g | Digital gold apps: 15g | Avg price: 5,450/g',
                    progress: 32
                },
                {
                    title: 'Portfolio Allocation',
                    icon: 'fas fa-percentage',
                    value: '4.8%',
                    description: 'Gold as % of total portfolio | Recommended: 5-10%'
                }
            ]);
        }

        function openIndividualSpendingInsights() {
            createInsightModal('Your Spending Analysis', 'Personal expense breakdown and patterns', [
                {
                    title: 'Monthly Personal Spending',
                    icon: 'fas fa-credit-card',
                    value: '35,450',
                    description: 'Your individual expenses this month',
                    change: '-2,100 vs last month (5.6% reduction)'
                },
                {
                    title: 'Food & Dining',
                    icon: 'fas fa-utensils',
                    value: '12,500',
                    description: 'Office lunches: 6,000 | Dinner/weekend: 4,500 | Coffee: 2,000',
                    progress: 35
                },
                {
                    title: 'Transportation',
                    icon: 'fas fa-car',
                    value: '8,200',
                    description: 'Fuel: 5,500 | Uber/Ola: 1,700 | Maintenance: 1,000',
                    progress: 23
                },
                {
                    title: 'Personal & Shopping',
                    icon: 'fas fa-shopping-bag',
                    value: '6,750',
                    description: 'Clothing: 3,500 | Electronics: 2,000 | Miscellaneous: 1,250',
                    progress: 19
                }
            ]);
        }

        function openIndividualLoansInsights() {
            createInsightModal('Your Loans & EMIs', 'Personal debt management and repayment schedule', [
                {
                    title: 'Total Outstanding',
                    icon: 'fas fa-hand-holding-usd',
                    value: '16,65,000',
                    description: 'Your total loan liabilities',
                    change: 'Monthly EMI: 28,450'
                },
                {
                    title: 'Home Loan',
                    icon: 'fas fa-home',
                    value: '12,50,000',
                    description: 'SBI Home Loan | 7.5% interest | 12 years remaining',
                    progress: 62
                },
                {
                    title: 'Car Loan',
                    icon: 'fas fa-car',
                    value: '3,15,000',
                    description: 'HDFC Auto Loan | 8.2% interest | 3.5 years remaining',
                    progress: 45
                },
                {
                    title: 'Credit Card Outstanding',
                    icon: 'fas fa-credit-card',
                    value: '1,00,000',
                    description: 'Total across 3 cards | Avg interest: 18% p.a. | Pay off recommended',
                    progress: 100
                }
            ]);
        }

        // Family Loans Insight Function
        function openFamilyLoansInsights() {
            createInsightModal('Family Loans Overview', 'Complete family debt management and EMI schedule', [
                {
                    title: 'Total Family Debt',
                    icon: 'fas fa-hand-holding-usd',
                    value: '22,21,560',
                    description: 'Combined loan liabilities across family',
                    change: 'Combined monthly EMI: 42,850'
                },
                {
                    title: 'Primary Home Loan',
                    icon: 'fas fa-home',
                    value: '18,50,000',
                    description: 'Joint home loan | 7.5% interest | 15 years remaining | John & Jane',
                    progress: 58
                },
                {
                    title: 'Vehicle Loans',
                    icon: 'fas fa-car',
                    value: '2,45,000',
                    description: 'John\'s car: 3,15,000 | Jane\'s scooter: 85,000 (remaining)',
                    progress: 32
                },
                {
                    title: 'Credit Cards',
                    icon: 'fas fa-credit-card',
                    value: '1,26,560',
                    description: 'John: 1,00,000 | Jane: 26,560 | Combined limit: 8,50,000',
                    progress: 15
                }
            ]);
        }

        // All the missing account management functions
        function openRealEstateGold() {
            openAccountManagementSection('realEstateGold');
        }

        function openCalendarReminders() {
            openAccountManagementSection('calendarReminders');
        }

        function openAuthorizations() {
            openAccountManagementSection('authorizations');
        }

        function openBankAccounts() {
            openAccountManagementSection('bankAccounts');
        }

        function openMyProfile() {
            const profile = getUserProfile() || {};
            const modal = document.getElementById('serviceModal');
            const title = document.getElementById('serviceModalTitle');
            const subtitle = document.getElementById('serviceModalSubtitle');
            const body = document.getElementById('serviceModalBody');

            title.textContent = 'My Profile';
            subtitle.textContent = 'Personal details & preferences';
            body.innerHTML = `
                <form id="myProfileForm" class="profile-form" style="max-width: 100%;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="mpFullName" value="${profile.name || ''}" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" value="${currentUser || ''}" disabled style="background: var(--light);">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" id="mpPhone" value="${profile.phone || ''}" placeholder="+91 98765 43210">
                    </div>
                    <div class="form-group">
                        <label>Date of Birth</label>
                        <input type="date" id="mpDOB" value="${profile.dateOfBirth || ''}">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="mpGender">
                            <option value="">Select</option>
                            <option value="male" ${profile.gender === 'male' ? 'selected' : ''}>Male</option>
                            <option value="female" ${profile.gender === 'female' ? 'selected' : ''}>Female</option>
                            <option value="other" ${profile.gender === 'other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Employment Status</label>
                        <select id="mpEmployment">
                            <option value="">Select</option>
                            <option value="salaried" ${profile.employment === 'salaried' ? 'selected' : ''}>Salaried</option>
                            <option value="self-employed" ${profile.employment === 'self-employed' ? 'selected' : ''}>Self Employed</option>
                            <option value="business" ${profile.employment === 'business' ? 'selected' : ''}>Business Owner</option>
                            <option value="freelancer" ${profile.employment === 'freelancer' ? 'selected' : ''}>Freelancer</option>
                            <option value="student" ${profile.employment === 'student' ? 'selected' : ''}>Student</option>
                            <option value="retired" ${profile.employment === 'retired' ? 'selected' : ''}>Retired</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Income Range</label>
                        <select id="mpIncome">
                            <option value="">Select</option>
                            <option value="0-25000" ${profile.incomeRange === '0-25000' ? 'selected' : ''}>Below 25,000</option>
                            <option value="25000-50000" ${profile.incomeRange === '25000-50000' ? 'selected' : ''}>25,000 - 50,000</option>
                            <option value="50000-100000" ${profile.incomeRange === '50000-100000' ? 'selected' : ''}>50,000 - 1,00,000</option>
                            <option value="100000-250000" ${profile.incomeRange === '100000-250000' ? 'selected' : ''}>1,00,000 - 2,50,000</option>
                            <option value="250000+" ${profile.incomeRange === '250000+' ? 'selected' : ''}>Above 2,50,000</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Save Profile
                    </button>
                </form>
            `;

            document.getElementById('myProfileForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const updatedProfile = {
                    ...profile,
                    name: document.getElementById('mpFullName').value,
                    phone: document.getElementById('mpPhone').value,
                    dateOfBirth: document.getElementById('mpDOB').value,
                    gender: document.getElementById('mpGender').value,
                    employment: document.getElementById('mpEmployment').value,
                    incomeRange: document.getElementById('mpIncome').value,
                    onboardingComplete: true,
                    updatedAt: new Date().toISOString()
                };
                saveUserProfile(updatedProfile);
                closeServiceModal();
                showMessage('Profile saved!', 'success');
                loadDashboard();
            });

            modal.style.display = 'block';
        }

        function openInsurance() {
            openAccountManagementSection('insurance');
        }

        function openPasswordSecurity() {
            openAccountManagementSection('passwordSecurity');
        }

        function openInvestments() {
            openAccountManagementSection('investments');
        }

        function openTaxServices() {
            openAccountManagementSection('taxServices');
        }

        function openLoans() {
            openAccountManagementSection('loans');
        }

        function exportAccountData() {
            showSuccessMessage(' Account data exported successfully!');
        }

        function openProfileSetupModal() {
            focusProfileDetailsSection();
            showSuccessMessage('Scroll down to complete your profile details');
        }

        function toggleBiometricLogin() {
            const toggle = document.getElementById('modalBiometricToggle');
            if (toggle) {
                toggle.classList.toggle('active');
                const enabled = toggle.classList.contains('active');
                showSuccessMessage(`Biometric login ${enabled ? 'enabled' : 'disabled'}`);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredProfileDetails();
            loadPage('landing');

            // Check for existing session
            const savedUser = localStorage.getItem('fintpe_current_user');
            if (savedUser) {
                const users = getUsers();
                if (users[savedUser]) {
                    isLoggedIn = true;
                    currentUser = savedUser;
                    updateNavigationForLogin();
                }
            }

            // Mobile Navigation
            const mobileToggle = document.getElementById('mobile-toggle');
            const navMenu = document.getElementById('nav-menu');

            if (mobileToggle && navMenu) {
                mobileToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                    const icon = mobileToggle.querySelector('i');
                    icon.classList.toggle('fa-bars');
                    icon.classList.toggle('fa-times');
                });
            }

            // Modal close handlers
            window.onclick = function(event) {
                const loginModal = document.getElementById('loginModal');
                const serviceModal = document.getElementById('serviceModal');
                if (event.target == loginModal) {
                    closeLoginModal();
                }
                if (event.target == serviceModal) {
                    closeServiceModal();
                }
            }

            // Scroll-triggered animations
            const observerOptions = {
                root: null,
                rootMargin: '0px 0px -80px 0px',
                threshold: 0.1
            };

            const animationObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');

                        // Stagger children animations
                        if (entry.target.classList.contains('animate-stagger')) {
                            const children = entry.target.children;
                            Array.from(children).forEach((child, index) => {
                                child.style.animationDelay = `${0.1 + index * 0.1}s`;
                            });
                        }
                    }
                });
            }, observerOptions);

            // Initialize scroll animations
            function initScrollAnimations() {
                document.querySelectorAll('.animate-on-scroll, .animate-stagger').forEach(el => {
                    animationObserver.observe(el);
                });
            }

            // Re-initialize on page load
            setTimeout(initScrollAnimations, 100);
        });
    </script>
</body>
</html>
